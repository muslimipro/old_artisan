import{B as ge,N as X,P as ee,o as n,c as f,W as ve,h as l,m as Q,b as G,a as se,e as W,r as b,E as ae,p as y,i as a,ab as _e,u as le,A as ye,G as we,D as c,j as s,k as L,t as d,q as B,U as j,w as te,L as oe,f as be,a1 as he,F as E,l as H}from"./index-AClBedbW.js";import{h as xe,z as M,s as $e}from"./index-trQ-RKwK.js";import{s as ke}from"./index-DuURa8kb.js";import{s as Ve}from"./index-amTonmdN.js";import{s as Ce}from"./index-CKslPvHa.js";import{s as ne}from"./index-BuhsEK-k.js";import{s as Se}from"./index-DiNPzNfC.js";import{s as Le}from"./index-CfTV9Mco.js";import{s as Be}from"./index-SQHY2uKR.js";import{_ as je}from"./MainHeader.vue_vue_type_script_setup_true_lang-Dh5SlZUY.js";import{s as Ue}from"./index-BqfOP99U.js";import{A as R}from"./language-DYQF8nnT.js";import{u as ze}from"./useLocaleStore-DNnxkFzn.js";import{u as Pe}from"./index-q1Nz5cPo.js";import"./index-D9lDRhj3.js";import"./index-DDx-e1KX.js";import"./index-EYPUebmY.js";import"./index-BJ1Lfis3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./logo-D1-3uCnC.js";import"./index-XWd1g6Xq.js";var Ie=function(t){var v=t.dt;return`
.p-overlaybadge {
    position: relative;
}

.p-overlaybadge .p-badge {
    position: absolute;
    inset-block-start: 0;
    inset-inline-end: 0;
    transform: translate(50%, -50%);
    transform-origin: 100% 0;
    margin: 0;
    outline-width: `.concat(v("overlaybadge.outline.width"),`;
    outline-style: solid;
    outline-color: `).concat(v("overlaybadge.outline.color"),`;
}

.p-overlaybadge .p-badge:dir(rtl) {
    transform: translate(-50%, -50%);
}
`)},Ae={root:"p-overlaybadge"},Ee=ge.extend({name:"overlaybadge",theme:Ie,classes:Ae}),Me={name:"OverlayBadge",extends:X,style:Ee,provide:function(){return{$pcOverlayBadge:this,$parentInstance:this}}},ie={name:"OverlayBadge",extends:Me,inheritAttrs:!1,components:{Badge:X}};function De(g,t,v,o,h,u){var p=ee("Badge");return n(),f("div",Q({class:g.cx("root")},g.ptmi("root")),[ve(g.$slots,"default"),l(p,Q(g.$props,{pt:g.ptm("pcBadge")}),null,16,["pt"])],16)}ie.render=De;const Ne=G({__name:"LocaleSelector",setup(g){const{locale:t}=se(),v=ze(),{selectedLang:o}=W(v),h=b(R.find(u=>u.locale===t.value)??R[0]);return ae(h,u=>{u&&(t.value=u.locale,o.value=u,localStorage.setItem("selectedLanguage",u.locale))}),(u,p)=>{const x=Ue;return n(),y(x,{modelValue:h.value,"onUpdate:modelValue":p[0]||(p[0]=_=>h.value=_),"dropdown-icon":"pi pi-globe",options:a(R),optionLabel:"label",checkmark:"",highlightOnSelect:!0,size:"small"},null,8,["modelValue","options"])}}}),Fe={class:"text-blue-500"},Te={class:"flex flex-col gap-1"},Oe={class:"flex gap-1 justify-end"},qe=G({__name:"VerifyEmailDialog",props:{modelValue:{type:Boolean,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(g){const t=_e(g,"modelValue"),v=le(),o=ye(),{user:h}=W(o),u=b(!1),p=b(0);let x;const _=()=>{p.value=60,x=setInterval(()=>{p.value>0?p.value--:clearInterval(x)},1e3)};async function D(){u.value=!0;try{const{data:m}=await j.sendVerificationEmail();v.add({severity:"success",summary:m.message,life:2e3}),_()}catch(m){v.add({severity:"error",summary:m.response.data.error,detail:m,life:2e3})}finally{u.value=!1}}return we(()=>{clearInterval(x)}),(m,U)=>{const N=ee("i18n-t"),F=te,V=ne,$=oe;return n(),y($,{visible:t.value,"onUpdate:visible":U[0]||(U[0]=w=>t.value=w),modal:"",draggable:!1,class:"m-4 max-w-md",header:m.$t("dialog.verifyYourEmail")},{footer:c(()=>[s("div",Te,[s("div",Oe,[l(F,{label:p.value>0?`${m.$t("pages.login.resendIn")} ${p.value}s`:m.$t("dialog.sendVerificationEmail"),onClick:D,loading:u.value,disabled:u.value||p.value>0},null,8,["label","loading","disabled"])]),p.value>0?(n(),y(V,{key:0,severity:"success"},{default:c(()=>[L(d(m.$t("pages.settings.weHaveSentLinkToVerifyEmail")),1)]),_:1})):B("",!0)])]),default:c(()=>[s("div",null,[l(N,{keypath:"dialog.confirmEmailAddress"},{email:c(()=>{var w;return[s("span",Fe,d((w=a(h))==null?void 0:w.email),1)]}),_:1})])]),_:1},8,["visible","header"])}}}),He={class:"flex flex-col items-center"},Re={class:"w-full flex max-w-[1280px] px-8 py-10 justify-start"},Ge={class:"text-heading-2-bold text-neutral900"},We={class:"w-full max-w-[1280px] px-8 pb-10"},Ye={key:1,class:"flex justify-center"},Ze={key:2,class:"flex flex-col gap-8"},Je={class:"flex flex-col md:flex-row p-6 md:p-10 lg:p-16 bg-white rounded-2xl gap-8 md:gap-12 lg:gap-16 items-start"},Ke={class:"flex-[4] flex flex-col gap-6 items-center w-full md:w-64 shrink-0"},Qe={class:"flex flex-wrap space-y-2 space-x-2 justify-center gap-2 h-fit max-w-full md:max-w-60"},Xe={class:"flex-[6] flex flex-col gap-6 w-full"},es={class:"flex flex-col gap-2 w-full"},ss={class:"text-gray-700 font-semibold"},as={class:"flex flex-col gap-2 w-full"},ls={class:"text-gray-700 font-semibold"},ts={key:0,class:"flex flex-col gap-2 w-full"},os={class:"text-gray-700 font-semibold"},ns={key:0,class:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-4 w-full"},is={key:1,class:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-4 w-full"},rs={class:"flex flex-col gap-2 w-full"},ds={class:"text-gray-700 font-semibold"},cs={class:"flex flex-col gap-4 w-full"},us={class:"text-gray-700 font-semibold"},ms={class:"flex flex-col gap-1"},ps={for:"old_password"},fs={class:"my-0 flex flex-col gap-1"},gs={class:"flex flex-col gap-1"},vs={for:"new_password"},_s={class:"my-0 flex flex-col gap-1"},ys={class:"flex flex-col gap-1"},ws={for:"confirm_password"},bs={class:"my-0 flex flex-col gap-1"},hs={class:"flex justify-between items-center mb-8"},xs={class:"flex justify-end gap-2"},Hs=G({__name:"SettingsPage",setup(g){const{t}=se(),v=be(),{userInfo:o,isUserInfoLoading:h,userLabel:u}=W(v),{loadUserInfo:p}=v,x=Pe(e=>{j.updateUserInfo(e),_.add({severity:"success",summary:t("pages.settings.successfullySaved"),life:2e3})},1e3,{maxWait:5e3});ae(o,async()=>{o.value&&x({name:o.value.name,school_name:o.value.school_name})},{deep:!0});const _=le(),D=he(),m=b(!1),U=b({old_password:"",new_password:""}),N=xe(M.object({old_password:M.string().min(1,{message:t("pages.login.oldPassRequired")}).max(100,{message:t("pages.login.max100chars")}),new_password:M.string().min(8,{message:t("pages.login.min8chars")}).max(100,{message:t("pages.login.max100chars")}).refine(e=>/[a-z]/.test(e),{message:t("pages.login.mustHaveLowercase")}).refine(e=>/[A-Z]/.test(e),{message:t("pages.login.mustHaveUppercase")}).refine(e=>/[0-9]/.test(e),{message:t("pages.login.mustHaveNumber")}),confirm_password:M.string()}).refine(e=>e.new_password===e.confirm_password,{message:t("pages.login.passMustMatch"),path:["confirm_password"]})),F=async e=>{if(!m.value&&e.valid){m.value=!0;try{const{data:i}=await j.changePassword(e.states.old_password.value,e.states.new_password.value);_.add({severity:"success",summary:i.message,life:2e3})}catch(i){_.add({severity:"error",summary:i.response.data.error,detail:i,life:2e3})}finally{m.value=!1}}},V=b(!1),$=b(""),w=b(!1),z=b(!1);async function re(){if($.value.length!=0){z.value=!0;try{const{data:e}=await j.joinClass($.value);w.value=!1,window.location.reload(),_.add({severity:"success",summary:e.message,life:2e3})}catch(e){_.add({severity:"error",summary:e.response.data.error,detail:e,life:2e3})}finally{z.value=!1}}}const P=b(!1);function de(){D.require({message:t("pages.settings.confirmLeaveClass"),header:t("pages.settings.confirmation"),icon:"pi pi-exclamation-triangle",rejectProps:{label:t("pages.settings.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:t("pages.settings.leave"),severity:"danger"},accept:()=>{ce()}})}async function ce(){P.value=!0;try{const{data:e}=await j.leaveClass();await p(),_.add({severity:"success",summary:e.message,life:2e3})}catch(e){_.add({severity:"error",summary:e.response.data.error,detail:e,life:2e3})}finally{P.value=!1}}return(e,i)=>{const ue=Be,Y=Le,T=Se,I=ne,k=te,me=ie,A=Ce,O=Ve,q=ke,pe=$e,fe=oe;return n(),f(E,null,[s("div",He,[l(a(je)),s("div",Re,[s("div",Ge,d(e.$t("header.menu.settings")),1)]),s("div",We,[a(h)?(n(),y(ue,{key:0,class:"flex justify-center"})):a(o)?(n(),f("div",Ze,[s("div",Je,[s("div",Ke,[a(o).large_avatar_url?(n(),y(Y,{key:0,class:"w-24 h-24 md:w-32 md:h-32 lg:w-40 lg:h-40",shape:"circle",image:a(o).large_avatar_url},null,8,["image"])):(n(),y(Y,{key:1,label:a(u),class:"w-24 h-24 md:w-32 md:h-32 lg:w-40 lg:h-40 text-xl md:text-2xl lg:text-3xl",shape:"circle"},null,8,["label"])),s("div",Qe,[l(T,{severity:"secondary",class:"w-fit"},{default:c(()=>[L(d(a(o).email),1)]),_:1}),l(T,{severity:"info",class:"w-fit"},{default:c(()=>[L(d(a(o).user_type),1)]),_:1}),l(T,{severity:"danger",class:"w-fit"},{default:c(()=>[L(d(a(o).access_type),1)]),_:1})]),a(o).verified?(n(),y(I,{key:2,severity:"success",size:"small",class:"w-fit"},{default:c(()=>[L(d(e.$t("pages.settings.verified")),1)]),_:1})):(n(),y(me,{key:3,severity:"danger"},{default:c(()=>[l(k,{label:e.$t("pages.settings.verifyYourEmail"),onClick:i[0]||(i[0]=r=>V.value=!0),variant:"outlined",size:"small",severity:"warn"},null,8,["label"])]),_:1}))]),s("div",Xe,[s("div",es,[s("div",ss,d(e.$t("pages.settings.name")),1),l(A,{id:"name",modelValue:a(o).name,"onUpdate:modelValue":i[1]||(i[1]=r=>a(o).name=r),autocomplete:"off",variant:"filled",placeholder:e.$t("pages.settings.name"),size:"small",class:"w-full"},null,8,["modelValue","placeholder"])]),s("div",as,[s("div",ls,d(e.$t("pages.settings.school")),1),l(A,{id:"school",modelValue:a(o).school_name,"onUpdate:modelValue":i[2]||(i[2]=r=>a(o).school_name=r),autocomplete:"off",variant:"filled",class:"w-full",placeholder:e.$t("pages.settings.school"),size:"small",disabled:a(o).class_name!=null||a(o).user_type!="student"},null,8,["modelValue","placeholder","disabled"])]),a(o).user_type=="student"?(n(),f("div",ts,[s("div",os,d(e.$t("pages.settings.class")),1),a(o).class_name==null?(n(),f("div",ns,[l(k,{label:e.$t("pages.settings.joinClass"),icon:"pi pi-user-plus",size:"small",variant:"outlined",class:"w-full sm:w-auto",onClick:i[3]||(i[3]=r=>w.value=!0)},null,8,["label"])])):(n(),f("div",is,[l(A,{id:"class",modelValue:a(o).class_name,"onUpdate:modelValue":i[4]||(i[4]=r=>a(o).class_name=r),autocomplete:"off",variant:"filled",placeholder:e.$t("pages.settings.class"),size:"small",class:"w-full",disabled:""},null,8,["modelValue","placeholder"]),l(k,{label:e.$t("pages.settings.leaveClass"),icon:"pi pi-user-minus",size:"small",variant:"outlined",severity:"danger",class:"w-full",onClick:de,loading:P.value,disabled:P.value},null,8,["label","loading","disabled"])]))])):B("",!0),s("div",rs,[s("div",ds,d(e.$t("language")),1),l(a(Ne),{class:"w-full"})]),s("div",cs,[s("div",us,d(e.$t("pages.settings.changePassword")),1),l(pe,{initialValues:U.value,resolver:a(N),onSubmit:F,class:"flex flex-col gap-4"},{default:c(r=>{var Z,J,K;return[s("div",ms,[l(q,{variant:"on"},{default:c(()=>[l(O,{id:"old_password",name:"old_password",feedback:!1,toggleMask:"",fluid:"",class:"w-full"}),s("label",ps,d(e.$t("pages.settings.oldPassword")),1)]),_:1}),(Z=r.old_password)!=null&&Z.invalid?(n(),y(I,{key:0,severity:"error",size:"small",variant:"simple"},{default:c(()=>[s("ul",fs,[(n(!0),f(E,null,H(r.old_password.errors,(C,S)=>(n(),f("li",{key:S},d(C.message),1))),128))])]),_:2},1024)):B("",!0)]),s("div",gs,[l(q,{variant:"on"},{default:c(()=>[l(O,{id:"new_password",name:"new_password",feedback:!1,toggleMask:"",fluid:"",class:"w-full"}),s("label",vs,d(e.$t("pages.settings.newPassword")),1)]),_:1}),(J=r.new_password)!=null&&J.invalid?(n(),y(I,{key:0,severity:"error",size:"small",variant:"simple"},{default:c(()=>[s("ul",_s,[(n(!0),f(E,null,H(r.new_password.errors,(C,S)=>(n(),f("li",{key:S},d(C.message),1))),128))])]),_:2},1024)):B("",!0)]),s("div",ys,[l(q,{variant:"on"},{default:c(()=>[l(O,{id:"confirm_password",name:"confirm_password",feedback:!1,toggleMask:"",fluid:"",class:"w-full"}),s("label",ws,d(e.$t("pages.settings.confirmPassword")),1)]),_:1}),(K=r.confirm_password)!=null&&K.invalid?(n(),y(I,{key:0,severity:"error",size:"small",variant:"simple"},{default:c(()=>[s("ul",bs,[(n(!0),f(E,null,H(r.confirm_password.errors,(C,S)=>(n(),f("li",{key:S},d(C.message),1))),128))])]),_:2},1024)):B("",!0)]),l(k,{type:"submit",label:e.$t("pages.settings.savePassword"),class:"w-fit",size:"small",loading:m.value,disabled:m.value},null,8,["label","loading","disabled"])]}),_:1},8,["initialValues","resolver"])])])])])):(n(),f("div",Ye,"No user"))])]),l(qe,{modelValue:V.value,"onUpdate:modelValue":i[5]||(i[5]=r=>V.value=r)},null,8,["modelValue"]),l(fe,{visible:w.value,"onUpdate:visible":i[8]||(i[8]=r=>w.value=r),modal:"",header:a(t)("pages.settings.joinClassByCode"),closable:!1},{default:c(()=>[s("div",hs,[l(A,{type:"text",modelValue:$.value,"onUpdate:modelValue":i[6]||(i[6]=r=>$.value=r),placeholder:a(t)("pages.settings.enterCode"),class:"w-full"},null,8,["modelValue","placeholder"])]),s("div",xs,[l(k,{type:"button",label:a(t)("pages.settings.cancel"),severity:"secondary",onClick:i[7]||(i[7]=r=>w.value=!1)},null,8,["label"]),l(k,{type:"button",label:a(t)("pages.settings.join"),onClick:re,loading:z.value,disabled:z.value},null,8,["label","loading","disabled"])])]),_:1},8,["visible","header"])],64)}}});export{Hs as default};
