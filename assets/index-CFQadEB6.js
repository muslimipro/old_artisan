import{T as He}from"./index-BjTXdGTl.js";import{s as ct}from"./index-_swAczI0.js";import{s as Pe}from"./index-C4TRSEyf.js";import{s as dt}from"./index-CAA1rma3.js";import{b as X,a as vt,u as We,r as p,x as H,o as n,c as r,j as i,t as N,z as pt,q as j,n as ft,F as ee,l as ve,h as x,g as _e,E as oe,p as U,D as q,C as Be,w as be,S as gt,d as ht,A as Ie,e as pe,G as Ne,H as we,V as mt,i as s,W as Ye,y as Oe,R as Ce,k as Se,T as Ae,I as ue,K as yt,v as wt}from"./index-BNOYZ_6B.js";import{u as Te,a as Ue}from"./store-DTC7bVf7.js";import{S as _t}from"./SimulationView-C13y6_Wx.js";import{e as Me,c as bt}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-DPho1RON.js";import{_ as xt}from"./CodeViewer.vue_vue_type_script_setup_true_lang-C9XRut4D.js";import{_ as kt}from"./EditLocaleSelector.vue_vue_type_script_setup_true_lang-LTQc_kWP.js";import{u as Ke}from"./useLocaleStore-DrFpjh-G.js";import{L as $t}from"./lessonApi-DJ332M2h.js";import{m as Ct}from"./mapLessonFromDto-CG19vVOp.js";import{m as Ge,i as St}from"./mapUnitFromDto-DJ2zlrQL.js";import{U as de}from"./unitApi-CO-UTFqE.js";import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Ee,a as Tt,b as Et,c as Lt,d as At}from"./TeacherReviseViewer.vue_vue_type_style_index_0_scoped_b98b9a0f_lang-CVQydLSn.js";import{_ as Pt,a as Bt,b as It}from"./SubmitImageReviseViewer.vue_vue_type_script_setup_true_lang-D223-FK7.js";import{_ as zt}from"./TinkercadViewer.vue_vue_type_script_setup_true_lang-71bxKeIX.js";import{s as Dt}from"./index-C__XJ6ti.js";import{C as jt}from"./cloudStorageApi-DS2KYLed.js";import{u as Je}from"./index-fSFpeyui.js";import"./index-DlyffbqJ.js";import"./index-CNPyJFLZ.js";import"./index-nGXgVu-X.js";import"./index-SW19hvKn.js";import"./index-DRhII8mO.js";import"./index-EmM3D-m5.js";import"./language-DYQF8nnT.js";import"./transformUnitDtosToPages-4blM3N0G.js";import"./index-Ym3p4DeK.js";import"./index-B1Mvx7RV.js";import"./index-CFd-0ZWH.js";import"./index-BTepqiGI.js";import"./index-DgBnIJKd.js";import"./index-BZSE8JAR.js";const Rt={class:"border border-purple-200 rounded-xl bg-gradient-to-r from-purple-50 to-pink-50"},Ut={class:"flex items-center gap-3"},Mt={class:"font-semibold text-purple-900"},Gt={class:"flex items-center gap-2"},Vt=["title"],qt={key:0,class:"px-4 pb-4"},Ft={key:0},Ht={class:"rounded-xl overflow-clip p-4 bg-white border border-purple-100 shadow-sm"},Wt={key:1,class:"flex gap-2 flex-wrap"},Nt={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Yt={key:2},Ot={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Kt={key:3},Jt={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Qt=X({__name:"TeacherAnswerViewer",props:{unitType:{},unitContent:{}},setup(L){const e=L,{t:u}=vt(),f=We(),o=p(!1),_=()=>{o.value=!o.value},k=async()=>{try{let l="";e.unitType==="open"?l=e.unitContent.answer:e.unitType==="options"?l=C.value.map(w=>w.text).join(`
`):(e.unitType==="code"||e.unitType==="pibody")&&(l=e.unitContent.answer),await navigator.clipboard.writeText(l),f.add({severity:"success",summary:u("pages.teacher.answerCopied"),detail:u("pages.teacher.answerCopiedDetail"),life:2e3})}catch(l){console.log(l),f.add({severity:"error",summary:u("pages.teacher.copyError"),detail:u("pages.teacher.copyErrorDetail"),life:2e3})}},C=H(()=>{var l;return!((l=e.unitContent)!=null&&l.options)||!e.unitContent.answer?[]:e.unitContent.options.filter(w=>e.unitContent.answer.includes(w.id))});return(l,w)=>(n(),r("div",Rt,[i("div",{onClick:_,class:"flex items-center justify-between cursor-pointer hover:bg-purple-100/50 p-4 rounded-xl transition-all duration-200"},[i("div",Ut,[w[0]||(w[0]=i("div",{class:"flex items-center justify-center w-6 h-6 text-purple-500"},[i("i",{class:"pi pi-crown","aria-hidden":"true"})],-1)),i("span",Mt,N(o.value?l.$t("pages.teacher.hideAnswer"):l.$t("pages.teacher.showAnswer")),1)]),i("div",Gt,[o.value?(n(),r("button",{key:0,onClick:pt(k,["stop"]),class:"flex items-center justify-center w-8 h-8 text-purple-600 hover:bg-purple-200 rounded-lg transition-colors",title:l.$t("pages.teacher.copyAnswer")},w[1]||(w[1]=[i("i",{class:"pi pi-copy","aria-hidden":"true"},null,-1)]),8,Vt)):j("",!0),(n(),r("svg",{class:ft(["w-5 h-5 transition-transform duration-200 text-purple-600",{"rotate-180":o.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},w[2]||(w[2]=[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))])]),o.value?(n(),r("div",qt,[e.unitType=="open"?(n(),r("div",Ft,[i("div",Ht,N(e.unitContent.answer),1)])):e.unitType=="options"?(n(),r("div",Wt,[i("div",Nt,[(n(!0),r(ee,null,ve(C.value,a=>(n(),r("div",{key:a.id},[x(Ee,{text:a.text},null,8,["text"])]))),128))])])):e.unitType=="code"?(n(),r("div",Yt,[i("div",Ot,[x(Ee,{text:` \`\`\`python
${e.unitContent.answer}
\`\`\` `},null,8,["text"])])])):e.unitType=="pibody"?(n(),r("div",Kt,[i("div",Jt,[x(Ee,{text:` \`\`\`python
${e.unitContent.answer}
\`\`\` `},null,8,["text"])])])):j("",!0)])):j("",!0)]))}}),Xt={class:"flex flex-wrap justify-between items-center flex-1 gap-4"},Zt={class:"w-full flex justify-between"},es={class:"flex gap-2"},ts={key:0,class:"relative w-full flex justify-between items-center p-8 rounded-border border border-surface gap-4"},ss=["alt","src"],ns={class:"flex flex-col gap-1"},as={class:"font-semibold text-ellipsis max-w-60 whitespace-nowrap overflow-hidden"},os={class:"absolute top-0 right-0"},ls=X({__name:"SubmitImageViewer",props:{state:{},unitId:{}},emits:["save-answer"],setup(L,{emit:e}){const u=L,f=e,o=Be(),_=p("");_e(()=>{_.value=u.state.answer.url}),oe(_,()=>{f("save-answer",{url:_.value})});const k=async C=>{C.files.length>1&&(C.files.length=1);const l=C.files[0],w=new FormData;w.append("file",l);try{const{data:a}=await jt.submitImage(w,Number(o.params.id),u.unitId);_.value=a.source_url}catch(a){console.log(a)}};return(C,l)=>{const w=be,a=gt,A=Dt;return n(),U(A,{name:"submit-image",mode:"advanced",multiple:!1,accept:"image/*",maxFileSize:1e6,onSelect:k,auto:!0},{header:q(({chooseCallback:c,files:$,uploadedFiles:m})=>[i("div",Xt,[i("div",Zt,[i("div",es,[x(w,{onClick:v=>c(),icon:"pi pi-plus",label:"Choose & upload",size:"small",disabled:$&&$.length>0||m&&m.length>0},null,8,["onClick","disabled"])])])])]),content:q(({uploadedFiles:c,removeUploadedFileCallback:$})=>[c.length>0?(n(),r("div",ts,[i("div",null,[i("img",{role:"presentation",alt:c[0].name,src:c[0].objectURL,width:"100",height:"50"},null,8,ss)]),i("div",ns,[i("span",as,N(c[0].name),1),i("div",null,N(c[0].size)+" bytes",1),x(a,{value:"Uploaded",class:"w-fit self-end"})]),i("div",os,[x(w,{icon:"pi pi-times",onClick:m=>$(0),variant:"text",rounded:"",severity:"danger"},null,8,["onClick"])])])):j("",!0)]),empty:q(()=>l[0]||(l[0]=[i("div",{class:"flex items-center justify-center flex-col"},[i("i",{class:"pi pi-cloud-upload !border-2 !rounded-full !p-8 !text-4xl !text-muted-color"}),i("p",{class:"mt-6 mb-0"},"Drag and drop image here to upload.")],-1)])),_:1})}}});async function Le(L){if(L=="")return"";const u=new TextEncoder().encode(L),f=await crypto.subtle.digest("SHA-256",u);return Array.from(new Uint8Array(f)).map(k=>k.toString(16).padStart(2,"0")).join("")}function is(L){let e="",u=!1;for(let f=0;f<L.length;f++){const o=L[f];if(o==="#"&&(u=!0),u)if(o===`
`)u=!1;else continue;o!==" "&&o!=="	"&&o!==`
`&&o!=="\r"&&(e+=o)}return e}function rs(L,e){if(L.length!==e.length)return!1;const u=[...L].sort(),f=[...e].sort();return u.every((o,_)=>o===f[_])}const xe=ht("lesson-store",()=>{const L=We(),e=p(null),u=p(!1),f=p(!1),o=p(!1),_=p(!1),k=p(!1),C=p(0),l=p(0),w=p(0),a=p([]),A=p([]),c=p(0),$=p(new Map),m=p(new Map),v=p(new Map),z=p([]),P=p("continue"),Z=p(!1),D=p(!1),W=p(!1),O=p(!0),K=p(!1),b=p(""),S=p(0),E=p(null),M=p(null),B=p([]),F=p([]),fe=Ie(),ke=Ke(),{lang:te}=pe(ke),Y=p(void 0),le=H(()=>{var t;return W.value&&(((t=E.value)==null?void 0:t.modulesWerePut)??!0)&&O.value});async function ge(t,g){try{u.value=!0,$.value.clear(),m.value.clear(),v.value.clear(),Y.value=fe.userRole==="editor"?te.value:void 0;const{data:d}=await $t.getLessonById(t,g,Y.value);e.value=Ct(d),e.value.stage=="published"&&he()}catch(d){L.add({severity:"error",summary:d.response.data.error,life:2e3})}finally{u.value=!1}}async function he(){if(e.value)try{k.value=!0,C.value=0,$.value.clear();const t=[];e.value.pages.forEach(y=>{y.groups.forEach(T=>{T.units.forEach(G=>{t.push({id:G.id,lessonId:e.value.id})})})});const g=t.length,d=5;for(let y=0;y<t.length;y+=d){const G=t.slice(y,y+d).map(async({id:re,lessonId:ut})=>{try{const{data:$e}=await de.getUnitByIdandLessonId(re,ut,Y.value);$.value.set(re,$e)}catch($e){console.warn(`Failed to preload unit ${re}:`,$e)}});await Promise.all(G),C.value=Math.round(Math.min(y+d,g)/g*100)}}catch(t){console.error("Error preloading units:",t)}finally{k.value=!1}}async function se(t,g){if($.value.has(t))return $.value.get(t);try{f.value=!0;const{data:d}=await de.getUnitByIdandLessonId(t,g,Y.value);return $.value.set(t,d),d}catch(d){L.add({severity:"error",summary:d.response.data.error,life:2e3})}finally{f.value=!1}}async function I(){if(e.value!=null){o.value=!0,a.value=[],A.value=[],l.value=0,w.value=0,c.value=0,z.value=[],b.value="",F.value=[],D.value=!1;for(let t=0;t<e.value.pages.length;t++)z.value.push(0);P.value="continue",ye(),a.value.push(e.value.pages[l.value].groups[c.value]),await J(e.value.id),o.value=!1}}function h(t,g){var y,T;S.value=g.id,b.value==""&&(b.value=`emulator-${S.value}`);const d=g.content.starting;K.value=d!="",M.value=Te(b.value),M.value.setCode(d),t=="pibody"&&(E.value=Ue(b.value),(y=E.value)==null||y.clearSlots(),(T=E.value)==null||T.reset(),B.value=g.data.neededModules,E.value.addNeededModules(B.value),F.value=[])}function V(){var y;if(b.value=="")return;Me.getSharedEmulator().stop();const g=a.value[c.value].units.find(T=>T.id===S.value),d=(g==null?void 0:g.content.starting)??"";d!=""&&(M.value=Te(b.value),M.value.setCode(d),(g==null?void 0:g.unitType)=="pibody"&&(E.value=Ue(b.value),(y=E.value)==null||y.clearSlots(),F.value=[]))}function ne(){if(b.value=="")return;Me.getSharedEmulator().stop()}async function J(t){W.value=!1,Z.value=!1,K.value=!1;for(let g=0;g<a.value[c.value].units.length;g++){const d=a.value[c.value].units[g];["options","open","code","pibody","submit-image"].includes(d.unitType)&&(P.value="check",Z.value=!0);const y=await se(d.id,t);if(y){const T=Ge(y);a.value[c.value].units[g].content=T==null?void 0:T.content,a.value[c.value].units[g].data=T==null?void 0:T.data,a.value[c.value].units[g].studentState=T==null?void 0:T.studentState,["code","pibody"].includes(d.unitType)&&(W.value=!0,T.content.answer==""&&T.data.tests.lenght==0||(O.value=!1),h(d.unitType,T))}}P.value=="continue"&&await ie()}async function ie(){if(e.value!=null)try{_.value=!0,D.value=!1;for(const t of a.value[a.value.length-1].units){if(m.value.set(t.id,t.studentState.answer),["code","pibody"].includes(t.unitType)){const g=Te(b.value).code.value;if(t.data.tests.length>0){const d=await bt(b.value,g,t.data.tests,t.data.includedCommands);D.value=d.correct}else if(!t.content.hashed_answer)D.value=!0;else{const d=is(g),y=await Le(d);D.value=t.content.hashed_answer===y}}else if(t.unitType=="open"){const d=String(t.studentState.answer.open??"").replace(/ /g,"").toLowerCase(),y=await Le(d);D.value=!t.content.hashed_answer||t.content.hashed_answer===y}else if(t.unitType=="options"){const g=t.studentState.answer.options,d=[];for(const y of g)d.push(await Le(y));D.value=t.content.hashed_answer.length==0||rs(t.content.hashed_answer,d)}else if(t.unitType=="submit-image"){const g=String(t.studentState.answer.url??"");D.value=g.length>0}else D.value=!0;if(D.value==!1)break}a.value[a.value.length-1].units.length||(D.value=!0),D.value?(z.value[l.value]++,c.value>=e.value.pages[l.value].groups.length-1?l.value<e.value.pages.length-1?P.value="continue":P.value="finish":P.value="continue"):P.value="try-again"}finally{_.value=!1}}async function me(){if(e.value!=null){if(ne(),c.value>=e.value.pages[l.value].groups.length-1){await Re(),je();return}o.value=!0,c.value++,a.value.push(e.value.pages[l.value].groups[c.value]),await J(e.value.id),o.value=!1}}async function R(t){const g=a.value[a.value.length-1].id;P.value="continue",z.value[l.value]--,c.value--,a.value.pop(),g==t?l.value==0&&a.value.length==0?await I():await me():await R(t)}function ye(){if(!e.value)return;let t=0;for(const g of e.value.pages)if(g.groups.every(y=>y.units.every(T=>T.studentStatus==="completed")))t!=e.value.pages.length-1&&(z.value[t]=g.groups.length,t++);else break;l.value=t,w.value=l.value-1}function Qe(){l.value!=0&&(z.value[l.value]=0,z.value[l.value-1]=0,l.value-=2,je())}async function Xe(){if(!e.value)return!1;try{if(o.value=!0,w.value<0)return o.value=!1,!1;const g=[...e.value.pages[w.value].groups];for(const d of g)for(let y=0;y<d.units.length;y++){const T=await se(d.units[y].id,e.value.id);if(T){const G=Ge(T);if(d.units[y].content=G==null?void 0:G.content,d.units[y].data=G==null?void 0:G.data,d.units[y].studentState=G==null?void 0:G.studentState,v.value.has(d.units[y].id)){const re=St(v.value.get(d.units[y].id),d.units[y].unitType);d.units[y].studentState=re}}}return A.value=[...g,...A.value],w.value-=1,!0}catch(t){return console.error("Error loading previous page:",t),!1}finally{o.value=!1}}function De(t,g){if(e.value!=null){for(const[d,y]of a.value.entries())for(const[T,G]of y.units.entries())if(G.id==t){a.value[d].units[T].studentState.answer=g;break}}}async function Ze(){e.value!=null&&(P.value="check")}async function et(){e.value!=null&&(await Re(),P.value="completed")}function tt(){$.value.clear(),C.value=0,k.value=!1}async function je(){e.value!=null&&(o.value=!0,l.value-1==w.value?w.value++:A.value=[...A.value,...a.value],l.value++,a.value=[],c.value=0,P.value="continue",a.value.push(e.value.pages[l.value].groups[c.value]),await J(e.value.id),o.value=!1)}function st(t){W.value=t}function nt(){O.value=!0}async function at(t){b.value!=""&&(t.code=M.value.code,De(S.value,t),await de.saveUnitByIdandLessonId(S.value,e.value.id,{answer:t}))}async function Re(){if(o.value=!0,e.value==null)return;const t=Array.from(m.value.entries()).map(([d,y])=>({id:d,student_answer:y})),{data:g}=await de.submitUnitsByLessonId(e.value.id,t);D.value=g.correct,v.value=new Map([...v.value,...m.value]),m.value=new Map,o.value=!1}const Q=H(()=>e.value?e.value.pages[l.value]??null:null),ae=H(()=>Q.value?Q.value.groups[c.value]??null:null),ot=H({get:()=>{var t;return((t=ae.value)==null?void 0:t.pibodyDrawerVisible)??!1},set:t=>{ae.value&&(ae.value.pibodyDrawerVisible=t)}}),lt=H({get:()=>{var t;return((t=ae.value)==null?void 0:t.codeDrawerVisible)??!1},set:t=>{ae.value&&(ae.value.codeDrawerVisible=t)}}),it=H({get:()=>{var t;return((t=Q.value)==null?void 0:t.showPibody)??!1},set:t=>{Q.value&&(Q.value.showPibody=t)}}),rt=H({get:()=>{var t;return((t=Q.value)==null?void 0:t.showCode)??!1},set:t=>{Q.value&&(Q.value.showCode=t)}});return{selectedLesson:e,isLessonLoading:u,isUnitLoading:f,groups:a,finishedGroups:A,groupIndex:c,isGroupLoading:o,isSubmitLoading:_,isPreloadingUnits:k,preloadingProgress:C,groupStatus:P,submitExist:Z,correct:D,submitEnabled:le,pageProgress:z,pageIndex:l,previousPageIndex:w,emulatorID:b,neededModules:B,slots:F,pibodyDrawerVisible:ot,codeDrawerVisible:lt,showPibody:it,showCode:rt,answersCache:m,startingCodeExist:K,setSubmitable:st,loadLessonById:ge,loadUnitByIdandLessonId:se,preloadAllUnits:he,clearUnitsCache:tt,loadInitialGroup:I,submitGroup:ie,nextGroup:me,saveAnswer:De,tryAgain:Ze,finishLesson:et,runCodePressed:nt,saveStudentIdeState:at,resetGroup:R,pageBack:Qe,loadPreviousPage:Xe,resetEmulator:V}}),us={class:"ptr-wrapper"},cs={key:0,class:"flex flex-col justify-center items-center"},ds={key:1,class:"flex gap-2 items-center"},ce=70,Ve=180,vs=X({__name:"PullToRefresh",props:{onRefresh:{type:Function},enabled:{type:Boolean}},setup(L){const e=L,u=H(()=>e.enabled??!0),f=p(null),o=p("idle"),_=p(0),k=p(0);let C=0;async function l(){if(o.value!=="loading"){o.value="loading",_.value=ce,k.value=1;try{await new Promise(v=>setTimeout(v,500)),await e.onRefresh()}finally{setTimeout(()=>{C=0,_.value=0,k.value=0,o.value="idle"},150)}}}function w(v){u.value&&f.value&&(f.value.scrollTop>0||o.value==="loading"||v.deltaY<0&&(v.preventDefault(),C=Math.min(Ve,C-v.deltaY),_.value=C,k.value=Math.min(1,C/ce),C>=ce&&l()))}let a=0,A=!1;function c(v){f.value&&(f.value.scrollTop>0||!u.value||!A||o.value==="loading"||(a=v.touches[0].clientY,A=!0))}function $(v){if(!u.value)return;const P=v.touches[0].clientY-a;P<=0||(v.preventDefault(),C=Math.min(Ve,P),_.value=C,k.value=Math.min(1,C/ce),C>=ce&&l())}function m(){u.value&&(A=!1,C=0,o.value!=="loading"&&(_.value=0,k.value=0))}return _e(()=>{const v=f.value;v&&(v.style.overscrollBehavior="contain",v.addEventListener("wheel",w,{passive:!1}),v.addEventListener("touchstart",c),v.addEventListener("touchmove",$,{passive:!1}),v.addEventListener("touchend",m))}),Ne(()=>{const v=f.value;v&&(v.removeEventListener("wheel",w),v.removeEventListener("touchstart",c),v.removeEventListener("touchmove",$),v.removeEventListener("touchend",m))}),(v,z)=>(n(),r("div",us,[u.value?(n(),r("div",{key:0,class:"ptr-indicator",style:we({height:`${_.value}px`,opacity:k.value})},[o.value==="idle"?(n(),r("div",cs,z[0]||(z[0]=[i("i",{class:"pi pi-angle-double-down",style:{"font-size":"1rem"}},null,-1)]))):(n(),r("div",ds,[z[1]||(z[1]=i("i",{class:"pi pi-sync",style:{"font-size":"0.7rem"}},null,-1)),i("div",null,N(v.$t("pages.schedule.loading")),1)]))],4)):j("",!0),i("div",{class:"ptr-content",ref_key:"contentRef",ref:f},[mt(v.$slots,"default",{},void 0,!0)],512)]))}}),ps=ze(vs,[["__scopeId","data-v-214e9b3a"]]),fs={key:1,class:"px-4 py-2"},gs={key:4},hs=X({__name:"UnitCard",props:{unit:{},loading:{type:Boolean},revise:{type:Boolean}},setup(L){const e=L,u=Be(),f=xe(),{saveAnswer:o,setSubmitable:_}=f;function k(a){e.unit.unitType=="options"?_(a.options.length>0):e.unit.unitType=="open"?_(a.open.length>0):e.unit.unitType=="submit-image"&&_(a.url.length>0),o(e.unit.id,a),C(a)}const C=Je(a=>{l(a)},1e3,{maxWait:5e3});async function l(a){await de.saveUnitByIdandLessonId(e.unit.id,Number(u.params.id),{answer:a})}const w=H(()=>{var a;return(a=e.unit.content)!=null&&a.answer?Array.isArray(e.unit.content.answer)?e.unit.content.answer.length>0:typeof e.unit.content.answer=="string"?e.unit.content.answer.trim()!=="":!0:!1});return(a,A)=>{const c=Pe;return n(),r("div",null,[a.loading?(n(),U(c,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),r("div",fs,[e.unit.unitType=="article"?(n(),U(s(Tt),{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="options"?(n(),U(s(Et),{key:1,"options-data":e.unit.content,state:e.unit.studentState,onSaveAnswer:k},null,8,["options-data","state"])):e.unit.unitType=="open"?(n(),U(s(Lt),{key:2,state:e.unit.studentState,onSaveAnswer:k},null,8,["state"])):e.unit.unitType=="video"?(n(),U(s(At),{key:3,video:e.unit.content},null,8,["video"])):e.unit.unitType=="submit-image"?(n(),r("div",gs,[e.revise?(n(),U(s(Pt),{key:0,state:e.unit.studentState},null,8,["state"])):(n(),U(s(ls),{key:1,state:e.unit.studentState,"unit-id":e.unit.id,onSaveAnswer:k},null,8,["state","unit-id"]))])):e.unit.unitType=="tinkercad"?(n(),U(s(zt),{key:5,tinkercad:e.unit.content},null,8,["tinkercad"])):e.revise&&e.unit.unitType=="code"?(n(),U(s(Bt),{key:6,state:e.unit.studentState},null,8,["state"])):e.revise&&e.unit.unitType=="pibody"?(n(),U(s(It),{key:7,state:e.unit.studentState},null,8,["state"])):j("",!0),w.value?(n(),U(s(Qt),{key:8,unitType:e.unit.unitType,unitContent:e.unit.content},null,8,["unitType","unitContent"])):j("",!0)]))])}}}),ms={key:1,class:"flex flex-col h-full w-full"},ys={class:"flex-grow flex flex-col gap-4 px-4 py-2"},qe=X({__name:"GroupCard",props:{group:{},loading:{type:Boolean},revise:{type:Boolean}},setup(L){const e=L,u=p(null);return oe(()=>e.loading,f=>{f===!1&&u.value&&requestAnimationFrame(()=>{var o;(o=u.value)==null||o.scrollIntoView({behavior:"smooth",block:"start"})})}),(f,o)=>{const _=Pe;return n(),r("div",{ref_key:"groupRef",ref:u},[f.loading?(n(),U(_,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),r("div",ms,[i("div",ys,[(n(!0),r(ee,null,ve(f.group.units,k=>(n(),U(hs,{key:k.id,unit:k,revise:e.revise},null,8,["unit","revise"]))),128))])]))],512)}}}),ws={key:0,class:"absolute right-0"},Fe=10,_s=X({__name:"UnitsView",props:{pages:{}},setup(L){const e=xe(),{groups:u,isGroupLoading:f,previousPageIndex:o,finishedGroups:_}=pe(e),{loadInitialGroup:k,resetGroup:C,loadPreviousPage:l}=e,w=Ie(),a=p(null),A=p(null),c=p(0),$=p(!1),m=p(null),v=p(!1);function z(b){let S=b;for(;S&&S.parentElement;){const E=S.parentElement,B=getComputedStyle(E).overflowY;if(B==="auto"||B==="scroll")return E;S=E}return null}async function P(){await Ce();const b=z(a.value),S=A.value;if(!b||!S){c.value=0;return}const E=b.clientHeight,M=S.getBoundingClientRect().height,B=Math.max(0,E-M-16);c.value=B,v.value&&b&&(await Ce(),await new Promise(F=>requestAnimationFrame(F)),b.scrollTo({top:10,behavior:"smooth"}),v.value=!1)}function Z(b,S){var B;const E=(B=u.value[u.value.length-1])==null?void 0:B.id;let M=null;b&&(b instanceof Element?M=b:b.$el instanceof Element&&(M=b.$el)),A.value=S.id===E?M:null}_e(()=>{k(),P(),window.addEventListener("resize",P),m.value=z(a.value),m.value&&(m.value.addEventListener("scroll",O),m.value.scrollHeight<=m.value.clientHeight&&(D.value=!0,W.value=Fe))}),Ye(()=>{window.removeEventListener("resize",P),m.value&&m.value.removeEventListener("scroll",O)}),oe(()=>u.value.length,async()=>{await P()}),oe(()=>f.value,async(b,S)=>{S===!0&&b===!1&&await P()});const D=p(!1),W=p(-40);function O(){if(!m.value)return;const b=m.value.scrollTop,S=5;if(b<=S&&o.value>=0){D.value=!0;const E=40;W.value=Math.min(Fe,-E+E*(S-b)/S)}else D.value=!1,W.value=-40}async function K(){if($.value||!m.value)return;$.value=!0,v.value=!0;const b=m.value;try{await l()?(await Ce(),await new Promise(E=>requestAnimationFrame(E)),await new Promise(E=>requestAnimationFrame(E)),v.value&&(b.scrollTo({top:0,behavior:"smooth"}),v.value=!1)):v.value=!1}finally{$.value=!1}}return(b,S)=>{const E=be,M=He;return n(),r("div",{ref_key:"rootEl",ref:a,class:"flex flex-col gap-2"},[x(ps,{"on-refresh":K,enabled:D.value},{default:q(()=>[(n(!0),r(ee,null,ve(s(_),B=>(n(),r("div",{key:B.id,class:"relative"},[x(qe,{group:B,revise:!0,loading:s(f)&&B.id==s(_)[s(_).length-1].id},null,8,["group","loading"])]))),128)),(n(!0),r(ee,null,ve(s(u),B=>(n(),r("div",{key:B.id,ref_for:!0,ref:F=>Z(F,B),class:"relative"},[!s(f)&&s(w).userRole=="editor"?(n(),r("div",ws,[Oe((n(),U(E,{type:"button",class:"w-9 h-9 mr-8 mt-2",rounded:"",severity:"secondary",variant:"text",onClick:F=>s(C)(B.id)},{default:q(()=>S[0]||(S[0]=[i("span",{class:"material-icons"},"restart_alt",-1)])),_:2},1032,["onClick"])),[[M,"Reset step",void 0,{left:!0}]])])):j("",!0),x(qe,{group:B,loading:s(f)&&B.id==s(u)[s(u).length-1].id},null,8,["group","loading"])]))),128)),i("div",{style:we({height:c.value+"px"})},null,4)]),_:1},8,["enabled"])],512)}}}),bs=ze(_s,[["__scopeId","data-v-1d2aa5dc"]]),xs={key:0,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},ks={key:1},$s={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},Cs={class:"text-lg font-bold flex items-center gap-2"},Ss={key:"incorrect",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-red-100"},Ts={key:"no-submit",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Es={key:"try-again",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-gray-50"},Ls={class:"text-lg font-bold flex items-center gap-2"},As={key:2},Ps={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},Bs={class:"text-lg font-bold flex items-center gap-2"},Is={key:1,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},zs=X({__name:"NavigationBar",setup(L){const e=xe(),{isSubmitLoading:u,groupStatus:f,isGroupLoading:o,submitExist:_,correct:k,submitEnabled:C}=pe(e),{submitGroup:l,nextGroup:w,tryAgain:a,finishLesson:A}=e;return(c,$)=>{const m=be;return n(),r(ee,null,[s(f)=="check"?(n(),r("div",xs,[x(m,{label:c.$t("check").toUpperCase(),icon:"pi pi-check","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(l),loading:s(u),disabled:s(u)||!s(C)},null,8,["label","onClick","loading","disabled"])])):j("",!0),s(f)=="continue"?(n(),r("div",ks,[x(Ae,{name:"pop",appear:"",mode:"out-in"},{default:q(()=>[s(_)&&s(k)?(n(),r("div",$s,[i("div",Cs,[$[0]||($[0]=i("span",{class:"text-3xl"},"üéâ",-1)),Se(" "+N(c.$t("correct"))+"! ",1)]),x(m,{label:c.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(w),loading:s(o),disabled:s(o)},null,8,["label","onClick","loading","disabled"])])):s(_)&&!s(k)?(n(),r("div",Ss,[x(m,{label:c.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(w),loading:s(o),disabled:s(o)},null,8,["label","onClick","loading","disabled"])])):(n(),r("div",Ts,[x(m,{label:c.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(w),loading:s(o),disabled:s(o)},null,8,["label","onClick","loading","disabled"])]))]),_:1})])):j("",!0),x(Ae,{name:"shake",appear:""},{default:q(()=>[s(f)=="try-again"?(n(),r("div",Es,[i("div",Ls,[$[1]||($[1]=i("span",{class:"text-3xl"},"‚ö†Ô∏è",-1)),Se(" "+N(c.$t("incorrect"))+"! ",1)]),x(m,{label:c.$t("tryAgain").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(a)},null,8,["label","onClick"])])):j("",!0)]),_:1}),s(f)=="finish"?(n(),r("div",As,[s(_)&&s(k)?(n(),r("div",Ps,[i("div",Bs,[$[2]||($[2]=i("span",{class:"text-3xl"},"üéâ",-1)),Se(" "+N(c.$t("correct"))+"!",1)]),x(m,{label:c.$t("finish").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(A),loading:s(o),disabled:s(o)},null,8,["label","onClick","loading","disabled"])])):(n(),r("div",Is,[x(m,{label:c.$t("finish").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(A)},null,8,["label","onClick"])]))])):j("",!0)],64)}}}),Ds=ze(zs,[["__scopeId","data-v-4f5f4e6c"]]),js={key:0,class:"h-screen bg-white flex flex-col items-center overflow-hidden relative"},Rs={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 max-w-[1920px] mx-auto"},Us={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},Ms={class:"flex items-center gap-4"},Gs={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},Vs={class:"flex-1 overflow-y-auto mt-16 mb-24 w-full"},qs={key:1,class:"flex justify-center"},Fs={key:2},Hs={key:3,class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-[1000] border border-gray-200 flex flex-col items-center gap-4"},Ws={key:4,class:"fixed top-20 right-4 bg-white rounded-lg shadow-md z-50 border border-gray-200 p-4 min-w-64"},Ns={class:"flex items-center gap-3 mb-2"},Ys={class:"fixed bottom-0 left-0 right-0 z-50 bg-transparent shadow-md max-w-[1920px] mx-auto"},Os={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},Ks={class:"relative h-full"},Js={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},Qs={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},Xs={class:"relative h-full"},Zs={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},en={key:0,class:"absolute right-0 top-0 z-10 h-[38px] p-[1px]"},tn={key:0,class:"h-screen flex flex-col items-center justify-center overflow-hidden gap-10"},sn={class:"flex flex-col items-center"},nn={class:"text-4xl font-bold mb-8"},an={class:"text-md text-gray-500"},qn=X({__name:"LessonPage",setup(L){const e=Be(),u=wt(),f=Ie(),o=Ke(),{lang:_}=pe(o);oe(_,async(I,h)=>{I!==h&&l.value&&await K(Number(e.params.id),(e.query.route_id??"").toString())});const k=xe(),{isLessonLoading:C,selectedLesson:l,pageProgress:w,groupStatus:a,emulatorID:A,neededModules:c,slots:$,pibodyDrawerVisible:m,codeDrawerVisible:v,showPibody:z,showCode:P,isPreloadingUnits:Z,preloadingProgress:D,answersCache:W,startingCodeExist:O}=pe(k),{loadLessonById:K,runCodePressed:b,saveStudentIdeState:S,pageBack:E,resetEmulator:M}=k;function B(I){var V;const h=((V=l.value)==null?void 0:V.pages.reduce((ne,J)=>ne+J.groups.length,0))||1;return I/h*100}function F(){var I;((I=l.value)==null?void 0:I.lessonType)=="module"?u.push("/v2/docs"):e.query.route_id&&e.query.route_id!=""?u.push("/v2/route/"+e.query.route_id):f.userRole=="editor"?u.push("/v2/routes"):u.push("/v2/home")}oe($,()=>{fe({slots:$.value})});const fe=Je(I=>{S(I)},1e3,{maxWait:5e3});function ke(I){fe({slots:$.value})}const te=p(window.innerWidth),Y=p(16);function le(){if(te.value=window.innerWidth,te.value<=1300){Y.value=16;return}const h=452-(te.value-1024)/2;Y.value=h>16?h:16}_e(async()=>{var I,h;a.value="continue",le(),await K(Number(e.params.id),(e.query.route_id??"").toString()),((I=l.value)==null?void 0:I.lessonType)=="project"&&u.push({path:e.path.replace("/lesson/","/project/"),query:e.query}),((h=l.value)==null?void 0:h.studentProgress)==100&&f.userRole!="editor"&&u.push({path:`${e.path}/revise`,query:e.query}),window.addEventListener("resize",le),window.addEventListener("beforeunload",se)}),Ne(()=>{window.removeEventListener("resize",le)});const ge=H(()=>te.value<=1920?{}:"calc((-100vw + 1920px) / 2)"),he=()=>{u.push(`${e.path}/edit`)};Ye(()=>{window.removeEventListener("beforeunload",se)});function se(I){if(a.value!="completed"&&W.value.size>0)return I.preventDefault(),!0}return(I,h)=>{const V=be,ne=dt,J=Pe,ie=ct,me=He;return n(),r(ee,null,[s(a)!="completed"?(n(),r("div",js,[i("div",Rs,[i("div",Us,[i("div",Ms,[x(V,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:F})]),s(l)?(n(),r("div",Gs,[(n(!0),r(ee,null,ve(s(l).pages,(R,ye)=>(n(),r("div",{key:ye,class:"h-full",style:we({width:B(R.groups.length)+"%"})},[x(ne,{value:s(w)[ye]/R.groups.length*100,"show-value":!1,class:"w-full rounded-full h-3"},null,8,["value"])],4))),128))])):j("",!0),h[9]||(h[9]=i("div",{class:"w-10"},null,-1))])]),i("div",Vs,[i("div",{class:"w-full h-full max-w-screen-lg mx-auto",style:we({paddingLeft:Y.value+"px",paddingRight:Y.value+"px"})},[s(C)?(n(),U(J,{key:0,class:"flex justify-center"})):s(l)?(n(),r("div",Fs,[x(bs,{pages:s(l).pages},null,8,["pages"])])):(n(),r("div",qs,"No lesson found")),s(f).userRole=="editor"?(n(),r("div",Hs,[x(s(kt)),x(V,{icon:"pi pi-pencil",variant:"text",severity:"contrast",onClick:he}),x(V,{variant:"text",severity:"contrast",onClick:s(E)},{default:q(()=>h[10]||(h[10]=[i("span",{class:"material-icons"},"swipe_left_alt",-1)])),_:1},8,["onClick"])])):j("",!0),s(Z)?(n(),r("div",Ws,[i("div",Ns,[x(J,{style:{width:"20px",height:"20px"}}),h[11]||(h[11]=i("span",{class:"text-sm font-medium"},"Preloading units...",-1))]),x(ne,{value:s(D),"show-value":!0,class:"h-2"},null,8,["value"])])):j("",!0)],4)]),i("div",Ys,[x(Ds)]),s(z)?(n(),r("div",Os,[x(V,{icon:"pi pi-microchip",severity:"secondary",onClick:h[0]||(h[0]=R=>m.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),x(ie,{visible:s(m),"onUpdate:visible":h[4]||(h[4]=R=>ue(m)?m.value=R:null),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${ge.value}`}}},{header:q(()=>h[12]||(h[12]=[i("div",null,null,-1)])),container:q(()=>[i("div",Ks,[i("div",Js,[x(V,{icon:"pi pi-chevron-left",severity:"secondary",onClick:h[1]||(h[1]=R=>m.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(n(),U(s(_t),{id:s(A),key:s(A),slots:s($),"onUpdate:slots":h[2]||(h[2]=R=>ue($)?$.value=R:null),neededModules:s(c),"onUpdate:neededModules":h[3]||(h[3]=R=>ue(c)?c.value=R:null),class:"w-full",horizontal:!1,autoPut:!0},null,8,["id","slots","neededModules"]))])]),_:1},8,["visible","pt"])])):j("",!0),s(P)?(n(),r("div",Qs,[x(V,{icon:"pi pi-code",severity:"secondary",onClick:h[5]||(h[5]=R=>v.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),x(ie,{visible:s(v),"onUpdate:visible":h[8]||(h[8]=R=>ue(v)?v.value=R:null),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${ge.value}`}}},{header:q(()=>h[13]||(h[13]=[i("div",null,null,-1)])),container:q(()=>[i("div",Xs,[i("div",Zs,[x(V,{icon:"pi pi-chevron-right",severity:"secondary",onClick:h[6]||(h[6]=R=>v.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),s(O)?(n(),r("div",en,[Oe(x(V,{icon:"pi pi-replay",variant:"link",onClick:s(M),class:"h-[36px] rounded-lg text-sm"},null,8,["onClick"]),[[me,I.$t("revertToStartingCode")]])])):j("",!0),(n(),U(yt,null,[(n(),U(s(xt),{id:s(A),key:s(A),connectbuttons:s(z),"onUpdate:connectbuttons":h[7]||(h[7]=R=>ue(z)?z.value=R:null),onRun:s(b),onSaveAnswer:ke},null,8,["id","connectbuttons","onRun"]))],1024))])]),_:1},8,["visible","pt"])])):j("",!0)])):j("",!0),x(Ae,{"enter-active-class":"transition duration-500 ease-out","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-300 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:q(()=>[s(a)=="completed"?(n(),r("div",tn,[h[14]||(h[14]=i("div",{class:"text-5xl"},"‚ö°Ô∏è",-1)),i("div",sn,[i("div",nn,N(I.$t("goodWork")),1),i("div",an,N(I.$t("keepLearning")),1)]),i("div",null,[x(V,{label:I.$t("continue"),class:"rounded-full w-56 text-xl",onClick:F},null,8,["label"])])])):j("",!0)]),_:1})],64)}}});export{qn as default};
