import{s as q,a as R}from"./index-CuTemcOB.js";import{a as H,b as K}from"./index-Dc-zD-v2.js";import{s as D}from"./index-C_i3kvzb.js";import{b as N,aa as G,u as M,ab as J,r as c,E as Q,o as p,p as x,D as s,j as i,h as t,w as E,L as W,f as X,e as Y,g as Z,c as B,t as z,q as F,i as C,k as I,F as ee,v as ae,aH as te}from"./index-DKpYZndv.js";import{O as S}from"./organizationApi-Bj5QuJ36.js";import{s as oe}from"./index-Cu1qPd4j.js";import"./index-OdaeILGb.js";import"./index-CdXgfwks.js";import"./index-CQW4Wi6y.js";import"./index-BPXX-HAT.js";import"./index-BHdrZhke.js";import"./index-DG5KcTt3.js";import"./index-CRjM1jwi.js";import"./index-D9s7_hLW.js";import"./index-C0_NxIx7.js";const le={class:"flex flex-col gap-1"},ne={class:"flex flex-col gap-2"},se={class:"flex gap-2 justify-end"},ie=N({__name:"EditOrganizationDialog",props:G({selectedOrganization:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(V){const v=M(),m=J(V,"modelValue"),d=V,l=c("");Q(()=>d.selectedOrganization,a=>{l.value="",a&&(l.value=a.name)},{immediate:!0});const r=c(!1);async function h(){r.value=!0;try{const{data:a}=await S.createOrganization(l.value);v.add({severity:"success",summary:a.message,life:2e3}),window.location.reload(),m.value=!1}catch(a){v.add({severity:"error",summary:a.response.data.error,detail:a,life:2e3})}finally{r.value=!1}}async function $(){if(d.selectedOrganization!=null){r.value=!0;try{const{data:a}=await S.updateOrganizationById(d.selectedOrganization.id,l.value);v.add({severity:"success",summary:a.message,life:2e3}),window.location.reload(),m.value=!1}catch(a){v.add({severity:"error",summary:a.response.data.error,detail:a,life:2e3})}finally{r.value=!1}}}return(a,n)=>{const w=D,O=oe,u=E,_=W;return p(),x(_,{visible:m.value,"onUpdate:visible":n[2]||(n[2]=f=>m.value=f),modal:"",draggable:!1,class:"m-4 max-w-md",header:d.selectedOrganization?"Edit organization":"Add organization"},{default:s(()=>[i("div",le,[i("div",ne,[n[3]||(n[3]=i("div",{class:"font-bold text-sm"},"Organization name",-1)),t(w,{key:"name",type:"text",modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=f=>l.value=f)},null,8,["modelValue"])]),t(O),i("div",se,[t(u,{label:"Cancel",severity:"secondary",onClick:n[1]||(n[1]=f=>m.value=!1)}),d.selectedOrganization==null?(p(),x(u,{key:0,label:"Create",onClick:h,loading:r.value,disabled:r.value},null,8,["loading","disabled"])):(p(),x(u,{key:1,label:"Save",onClick:$,loading:r.value,disabled:r.value},null,8,["loading","disabled"]))])])]),_:1},8,["visible","header"])}}}),re={class:"flex-grow min-w-0 pb-4 mb-4 bg-white rounded-md border"},de={class:"flex items-center"},ue={class:"flex-grow flex gap-2 items-center"},ce={key:0,class:"text-2xl"},me={class:"w-44"},pe={class:"flex gap-2"},Fe=N({__name:"OrganizationsPage",setup(V){const v=M(),m=ae(),d=c(),l=c();(()=>{l.value={global:{value:null,matchMode:te.CONTAINS}}})();const h=()=>{d.value.exportCSV()},$=X(),{userInfo:a}=Y($),n=c(!1),w=c(null);function O(g){n.value=!0,w.value=g}const u=c([]),_=c(!1);async function f(){try{_.value=!0;const{data:g}=await S.getOrganizations();u.value=g??[]}catch(g){v.add({severity:"error",summary:g.response.data.error,life:2e3})}finally{_.value=!1}}return Z(()=>{f()}),(g,o)=>{const k=E,U=H,A=D,P=K,y=q,L=R;return p(),B(ee,null,[i("div",re,[t(L,{ref_key:"dt",ref:d,filters:l.value,"onUpdate:filters":o[2]||(o[2]=e=>l.value=e),value:u.value,dataKey:"id",loading:_.value,scrollable:"",globalFilterFields:["id","name","created_at"],class:"rounded-md overflow-hidden w-full",paginator:"",rows:10,rowsPerPageOptions:[5,10,25]},{header:s(()=>{var e;return[i("div",de,[i("div",ue,[u.value?(p(),B("div",ce,"Organizations - "+z(u.value.length),1)):F("",!0)]),((e=C(a))==null?void 0:e.user_type)=="super_admin"?(p(),x(k,{key:0,label:"Add",icon:"pi pi-plus",severity:"success",variant:"outlined",class:"mr-2",onClick:o[0]||(o[0]=b=>O(null))})):F("",!0),t(k,{label:"Export",icon:"pi pi-upload",severity:"info",variant:"outlined",class:"mr-2",onClick:h}),t(P,null,{default:s(()=>[t(U,null,{default:s(()=>o[4]||(o[4]=[i("i",{class:"pi pi-search"},null,-1)])),_:1}),t(A,{modelValue:l.value.global.value,"onUpdate:modelValue":o[1]||(o[1]=b=>l.value.global.value=b),placeholder:"Search"},null,8,["modelValue"])]),_:1})])]}),empty:s(()=>o[5]||(o[5]=[I(" No organizations found. ")])),loading:s(()=>o[6]||(o[6]=[I(" Loading organizations data. Please wait. ")])),default:s(()=>[t(y,{field:"id",header:"ID",sortable:""},{body:s(({data:e})=>[I(z(e.id),1)]),_:1}),t(y,{field:"name",header:"Name",sortable:""},{body:s(({data:e})=>[i("div",null,z(`${e.name}`),1)]),_:1}),t(y,{header:"Schools",sortable:""},{body:s(({data:e})=>[i("div",null,z(e.school_count),1)]),_:1}),t(y,{field:"created_at",header:"Created time",sortable:""},{body:s(({data:e})=>[i("div",me,z(e.created_at.split("T")[0]+" "+e.created_at.split(".")[0].split("T")[1]),1)]),_:1}),t(y,{frozen:!0,alignFrozen:"right",exportable:!1},{body:s(({data:e})=>{var b;return[i("div",pe,[((b=C(a))==null?void 0:b.user_type)=="super_admin"?(p(),x(k,{key:0,icon:"pi pi-pencil",outlined:"",rounded:"",severity:"warn",onClick:j=>O(e)},null,8,["onClick"])):F("",!0),t(k,{icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:j=>{var T;return C(m).push({name:((T=C(a))==null?void 0:T.user_type)=="super_admin"?"admin-organization":"supervisor-organization",params:{id:e.id}})}},null,8,["onClick"])])]}),_:1})]),_:1},8,["filters","value","loading"])]),t(ie,{modelValue:n.value,"onUpdate:modelValue":o[3]||(o[3]=e=>n.value=e),"selected-organization":w.value},null,8,["modelValue","selected-organization"])],64)}}});export{Fe as default};
