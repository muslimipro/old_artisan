import{s as R,a as H}from"./index-D3-Aahhv.js";import{a as J,b as K}from"./index-DNFUUiYx.js";import{s as N}from"./index-ClLqLFXa.js";import{b as U,aa as L,ab as z,u as E,r as c,D as G,o as f,p as C,y as o,j as r,t as u,h as l,w as S,J as Q,f as W,e as X,g as Y,c as T,q as D,i as w,k as M,v as Z,aH as ee}from"./index-B13zA5hA.js";import{C as F,m as ae}from"./mapClassFromDto-B_NG-Lai.js";import{s as se}from"./index-DJD13zKY.js";import"./index-Dnjq2QHo.js";import"./index-DlvIKnHl.js";import"./index-CCY17VSZ.js";import"./index-D42dtyNF.js";import"./index-BcEWowBB.js";import"./index-DglSVEhR.js";import"./index-BAuR1ElB.js";import"./index-BsBj4sJw.js";import"./index-B3vcjevN.js";const le={class:"flex flex-col gap-1"},te={class:"flex flex-col"},oe={class:"font-bold text-sm mb-1"},re={class:"flex gap-2 justify-end"},ne=U({__name:"EditClassDialog",props:L({selectedClass:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(k){const p=z(k,"modelValue"),m=k,g=E(),t=c(""),i=c(!1);G(()=>m.selectedClass,e=>{t.value="",e&&(t.value=e.name)},{immediate:!0});async function V(){i.value=!0;try{const{data:e}=await F.createClass(t.value);window.location.reload(),g.add({severity:"success",summary:e.message,life:2e3}),p.value=!1}catch(e){g.add({severity:"error",summary:e.response.data.error,detail:e,life:2e3})}finally{i.value=!1}}async function h(){if(m.selectedClass){i.value=!0;try{const{data:e}=await F.updateClassById(m.selectedClass.id,t.value);window.location.reload(),g.add({severity:"success",summary:e.message,life:2e3}),p.value=!1}catch(e){g.add({severity:"error",summary:e.response.data.error,detail:e,life:2e3})}finally{i.value=!1}}}return(e,d)=>{const _=N,y=se,v=S,x=Q;return f(),C(x,{visible:p.value,"onUpdate:visible":d[2]||(d[2]=a=>p.value=a),modal:"",draggable:!1,class:"m-4 max-w-md",header:m.selectedClass?e.$t("pages.teacher.editClass"):e.$t("pages.teacher.addClass")},{default:o(()=>[r("div",le,[r("div",te,[r("div",oe,u(e.$t("pages.teacher.name")),1),l(_,{type:"text",modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=a=>t.value=a)},null,8,["modelValue"])]),l(y),r("div",re,[l(v,{label:e.$t("pages.teacher.cancel"),severity:"secondary",onClick:d[1]||(d[1]=a=>p.value=!1)},null,8,["label"]),m.selectedClass==null?(f(),C(v,{key:0,label:e.$t("pages.teacher.create"),onClick:V,loading:i.value,disabled:i.value},null,8,["label","loading","disabled"])):(f(),C(v,{key:1,label:e.$t("pages.teacher.save"),onClick:h,loading:i.value,disabled:i.value},null,8,["label","loading","disabled"]))])])]),_:1},8,["visible","header"])}}}),ie={class:"flex-grow min-w-0 pb-4 mb-4 bg-white rounded-md border"},de={class:"flex items-center"},ue={class:"flex-grow flex gap-2 items-center"},ce={key:0,class:"text-2xl"},pe={class:"flex gap-2"},De=U({__name:"ClassesPage",setup(k){const p=E(),m=Z(),g=c(),t=c();(()=>{t.value={global:{value:null,matchMode:ee.CONTAINS}}})();const V=W(),{userInfo:h}=X(V),e=c(!1),d=c(null);function _(a){e.value=!0,d.value=a}const y=c([]),v=c(!1);async function x(){try{v.value=!0;const{data:a}=await F.getClasses();y.value=(a==null?void 0:a.map(ae))??[]}catch(a){p.add({severity:"error",summary:a.response.data.error,life:2e3})}finally{v.value=!1}}return Y(()=>{x()}),(a,n)=>{const B=S,P=J,j=N,q=K,$=R,A=H;return f(),T("div",ie,[l(A,{ref_key:"dt",ref:g,filters:t.value,"onUpdate:filters":n[2]||(n[2]=s=>t.value=s),value:y.value,dataKey:"id",loading:v.value,scrollable:"",globalFilterFields:["name","email"],class:"rounded-md overflow-hidden w-full",paginator:"",rows:10,rowsPerPageOptions:[5,10,25]},{header:o(()=>{var s;return[r("div",de,[r("div",ue,[y.value?(f(),T("div",ce,u(a.$t("pages.teacher.classes"))+" - "+u(y.value.length),1)):D("",!0)]),((s=w(h))==null?void 0:s.user_type)=="teacher"?(f(),C(B,{key:0,label:a.$t("pages.teacher.addClass"),icon:"pi pi-plus",variant:"outlined",class:"mr-2",onClick:n[0]||(n[0]=b=>_(null))},null,8,["label"])):D("",!0),l(q,null,{default:o(()=>[l(P,null,{default:o(()=>n[4]||(n[4]=[r("i",{class:"pi pi-search"},null,-1)])),_:1}),l(j,{modelValue:t.value.global.value,"onUpdate:modelValue":n[1]||(n[1]=b=>t.value.global.value=b),placeholder:a.$t("pages.teacher.search")},null,8,["modelValue","placeholder"])]),_:1})])]}),empty:o(()=>[M(u(a.$t("pages.teacher.noClassesFound")),1)]),loading:o(()=>[M(u(a.$t("pages.teacher.loadingClasses")),1)]),default:o(()=>[l($,{field:"name",header:a.$t("pages.teacher.name"),sortable:""},{body:o(({data:s})=>[r("div",null,u(`${s.name}`),1)]),_:1},8,["header"]),l($,{field:"creator_name",header:a.$t("pages.teacher.classTeacher"),sortable:""},{body:o(({data:s})=>[r("div",null,u(`${s.creatorName??s.creatorEmail}`),1)]),_:1},8,["header"]),l($,{field:"student_count",header:a.$t("pages.teacher.students"),sortable:""},{body:o(({data:s})=>[r("div",null,u(`${s.studentCount}`),1)]),_:1},8,["header"]),l($,{exportable:!1},{body:o(({data:s})=>{var b;return[r("div",pe,[((b=w(h))==null?void 0:b.user_type)=="teacher"?(f(),C(B,{key:0,icon:"pi pi-pencil",outlined:"",rounded:"",severity:"warn",onClick:O=>_(s)},null,8,["onClick"])):D("",!0),l(B,{icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:O=>{var I;return w(m).push({name:((I=w(h))==null?void 0:I.user_type)=="teacher"?"teacher-class":"school-class",params:{id:s.id}})}},null,8,["onClick"])])]}),_:1})]),_:1},8,["filters","value","loading"]),l(ne,{"model-value":e.value,"onUpdate:modelValue":n[3]||(n[3]=s=>e.value=s),"selected-class":d.value},null,8,["model-value","selected-class"])])}}});export{De as default};
