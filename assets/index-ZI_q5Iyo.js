import{T as We}from"./index-B2H5Bafp.js";import{s as vt}from"./index-DX3gV9xs.js";import{s as Pe}from"./index-3shJJ7Ww.js";import{s as pt}from"./index-IRxqCVSs.js";import{b as X,a as ft,u as Ne,r as v,x as N,o as n,c as u,j as i,t as F,z as gt,q as j,n as ht,F as ee,l as ge,h as k,g as be,E as ie,p as R,D as H,C as Ie,w as _e,S as mt,d as yt,A as Be,e as he,G as Ye,H as we,V as wt,i as s,W as Oe,y as Ke,R as Se,k as de,T as Ae,I as ve,K as bt,v as _t}from"./index-CrrKimau.js";import{u as Te,a as Me}from"./store-DDrSlhXQ.js";import{S as xt}from"./SimulationView-CLcAnmTU.js";import{e as Ge,c as kt}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-2mdW5fKD.js";import{_ as $t}from"./CodeViewer.vue_vue_type_script_setup_true_lang-voeCvP9r.js";import{_ as Ct}from"./EditLocaleSelector.vue_vue_type_script_setup_true_lang-C4tuFDpf.js";import{u as Je}from"./useLocaleStore-Bf2xWCbY.js";import{L as St}from"./lessonApi-Bh_eeZwv.js";import{m as Tt}from"./mapLessonFromDto-CG19vVOp.js";import{m as Ve,i as Et}from"./mapUnitFromDto-DJ2zlrQL.js";import{U as fe}from"./unitApi-BOhLLp80.js";import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Ee,a as Lt,b as At,c as Pt,d as It}from"./TeacherReviseViewer.vue_vue_type_style_index_0_scoped_b98b9a0f_lang-BnxIVwFl.js";import{_ as Bt,a as zt,b as Dt}from"./SubmitImageReviseViewer.vue_vue_type_script_setup_true_lang-Ccm2NNfL.js";import{_ as jt}from"./TinkercadViewer.vue_vue_type_script_setup_true_lang-CbdhF4Mm.js";import{s as Rt}from"./index-Ep6EqYqe.js";import{C as Ut}from"./cloudStorageApi-B5fLbtkp.js";import{u as Qe}from"./index-M8gq5o1h.js";import"./index-D_2waQsa.js";import"./index-DL1ViM7W.js";import"./index-Cxw2yqN5.js";import"./index-DgmsQzkT.js";import"./index-4_fBhWkb.js";import"./index-rLSFooqB.js";import"./index-Cc4fZZVN.js";import"./language-DYQF8nnT.js";import"./transformUnitDtosToPages-4blM3N0G.js";import"./index-gprwKlQi.js";import"./index-DxuAR6go.js";import"./index-DU7DOYFv.js";import"./index-B93GKCIf.js";import"./index-CSMgnqNq.js";import"./index-sf2f6Ydm.js";const Mt={class:"border border-purple-200 rounded-xl bg-gradient-to-r from-purple-50 to-pink-50"},Gt={class:"flex items-center gap-3"},Vt={class:"font-semibold text-purple-900"},qt={class:"flex items-center gap-2"},Ft=["title"],Ht={key:0,class:"px-4 pb-4"},Wt={key:0},Nt={class:"rounded-xl overflow-clip p-4 bg-white border border-purple-100 shadow-sm"},Yt={key:1,class:"flex gap-2 flex-wrap"},Ot={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Kt={key:2},Jt={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Qt={key:3},Xt={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Zt=X({__name:"TeacherAnswerViewer",props:{unitType:{},unitContent:{}},setup(L){const e=L,{t:c}=ft(),p=Ne(),l=v(!1),_=()=>{l.value=!l.value},C=async()=>{try{let o="";e.unitType==="open"?o=e.unitContent.answer:e.unitType==="options"?o=b.value.map(x=>x.text).join(`
`):(e.unitType==="code"||e.unitType==="pibody")&&(o=e.unitContent.answer),await navigator.clipboard.writeText(o),p.add({severity:"success",summary:c("pages.teacher.answerCopied"),detail:c("pages.teacher.answerCopiedDetail"),life:2e3})}catch(o){console.log(o),p.add({severity:"error",summary:c("pages.teacher.copyError"),detail:c("pages.teacher.copyErrorDetail"),life:2e3})}},b=N(()=>{var o;return!((o=e.unitContent)!=null&&o.options)||!e.unitContent.answer?[]:e.unitContent.options.filter(x=>e.unitContent.answer.includes(x.id))});return(o,x)=>(n(),u("div",Mt,[i("div",{onClick:_,class:"flex items-center justify-between cursor-pointer hover:bg-purple-100/50 p-4 rounded-xl transition-all duration-200"},[i("div",Gt,[x[0]||(x[0]=i("div",{class:"flex items-center justify-center w-6 h-6 text-purple-500"},[i("i",{class:"pi pi-crown","aria-hidden":"true"})],-1)),i("span",Vt,F(l.value?o.$t("pages.teacher.hideAnswer"):o.$t("pages.teacher.showAnswer")),1)]),i("div",qt,[l.value?(n(),u("button",{key:0,onClick:gt(C,["stop"]),class:"flex items-center justify-center w-8 h-8 text-purple-600 hover:bg-purple-200 rounded-lg transition-colors",title:o.$t("pages.teacher.copyAnswer")},x[1]||(x[1]=[i("i",{class:"pi pi-copy","aria-hidden":"true"},null,-1)]),8,Ft)):j("",!0),(n(),u("svg",{class:ht(["w-5 h-5 transition-transform duration-200 text-purple-600",{"rotate-180":l.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},x[2]||(x[2]=[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))])]),l.value?(n(),u("div",Ht,[e.unitType=="open"?(n(),u("div",Wt,[i("div",Nt,F(e.unitContent.answer),1)])):e.unitType=="options"?(n(),u("div",Yt,[i("div",Ot,[(n(!0),u(ee,null,ge(b.value,a=>(n(),u("div",{key:a.id},[k(Ee,{text:a.text},null,8,["text"])]))),128))])])):e.unitType=="code"?(n(),u("div",Kt,[i("div",Jt,[k(Ee,{text:` \`\`\`python
${e.unitContent.answer}
\`\`\` `},null,8,["text"])])])):e.unitType=="pibody"?(n(),u("div",Qt,[i("div",Xt,[k(Ee,{text:` \`\`\`python
${e.unitContent.answer}
\`\`\` `},null,8,["text"])])])):j("",!0)])):j("",!0)]))}}),es={class:"flex flex-wrap justify-between items-center flex-1 gap-4"},ts={class:"w-full flex justify-between"},ss={class:"flex gap-2"},ns={key:0,class:"relative w-full flex justify-between items-center p-8 rounded-border border border-surface gap-4"},as=["alt","src"],ls={class:"flex flex-col gap-1"},os={class:"font-semibold text-ellipsis max-w-60 whitespace-nowrap overflow-hidden"},is={class:"absolute top-0 right-0"},rs={class:"flex items-center justify-center flex-col"},us={class:"mt-6 mb-0"},cs=X({__name:"SubmitImageViewer",props:{state:{},unitId:{}},emits:["save-answer"],setup(L,{emit:e}){const c=L,p=e,l=Ie(),_=v("");be(()=>{_.value=c.state.answer.url}),ie(_,()=>{p("save-answer",{url:_.value})});const C=async b=>{b.files.length>1&&(b.files.length=1);const o=b.files[0],x=new FormData;x.append("file",o);try{const{data:a}=await Ut.submitImage(x,Number(l.params.id),c.unitId);_.value=a.source_url}catch(a){console.log(a)}};return(b,o)=>{const x=_e,a=mt,I=Rt;return n(),R(I,{name:"submit-image",mode:"advanced",multiple:!1,accept:"image/*",maxFileSize:1e6,onSelect:C,auto:!0},{header:H(({chooseCallback:m,files:y,uploadedFiles:g})=>[i("div",es,[i("div",ts,[i("div",ss,[k(x,{onClick:r=>m(),icon:"pi pi-plus",label:b.$t("choose"),size:"small",disabled:y&&y.length>0||g&&g.length>0},null,8,["onClick","label","disabled"])])])])]),content:H(({uploadedFiles:m,removeUploadedFileCallback:y})=>[m.length>0?(n(),u("div",ns,[i("div",null,[i("img",{role:"presentation",alt:m[0].name,src:m[0].objectURL,width:"100",height:"50"},null,8,as)]),i("div",ls,[i("span",os,F(m[0].name),1),i("div",null,F(m[0].size)+" "+F(b.$t("bytes")),1),k(a,{value:b.$t("uploaded"),class:"w-fit self-end"},null,8,["value"])]),i("div",is,[k(x,{icon:"pi pi-times",onClick:g=>y(0),variant:"text",rounded:"",severity:"danger"},null,8,["onClick"])])])):j("",!0)]),empty:H(()=>[i("div",rs,[o[0]||(o[0]=i("i",{class:"pi pi-cloud-upload !border-2 !rounded-full !p-8 !text-4xl !text-muted-color"},null,-1)),i("p",us,F(b.$t("dragAndDropImageToUpload")),1)])]),_:1})}}});async function Le(L){if(L=="")return"";const c=new TextEncoder().encode(L),p=await crypto.subtle.digest("SHA-256",c);return Array.from(new Uint8Array(p)).map(C=>C.toString(16).padStart(2,"0")).join("")}function ds(L){let e="",c=!1;for(let p=0;p<L.length;p++){const l=L[p];if(l==="#"&&(c=!0),c)if(l===`
`)c=!1;else continue;l!==" "&&l!=="	"&&l!==`
`&&l!=="\r"&&(e+=l)}return e}function vs(L,e){if(L.length!==e.length)return!1;const c=[...L].sort(),p=[...e].sort();return c.every((l,_)=>l===p[_])}const xe=yt("lesson-store",()=>{const L=Ne(),e=v(null),c=v(!1),p=v(!1),l=v(!1),_=v(!1),C=v(!1),b=v(0),o=v(0),x=v(0),a=v([]),I=v([]),m=v(0),y=v(new Map),g=v(new Map),r=v(new Map),z=v([]),B=v("continue"),O=v(!1),D=v(!1),G=v(!1),Y=v(!1),K=v(!0),T=v(!1),$=v(""),A=v(0),U=v(null),E=v(null),W=v([]),Z=v([]),ke=Be(),te=Je(),{lang:se}=he(te),J=v(void 0),me=N(()=>{var t;return Y.value&&(((t=U.value)==null?void 0:t.modulesWerePut)??!0)&&K.value});async function $e(t,f){try{c.value=!0,y.value.clear(),g.value.clear(),r.value.clear(),J.value=ke.userRole==="editor"?se.value:void 0;const{data:d}=await St.getLessonById(t,f,J.value);e.value=Tt(d),e.value.stage=="published"&&re()}catch(d){L.add({severity:"error",summary:d.response.data.error,life:2e3})}finally{c.value=!1}}async function re(){if(e.value)try{C.value=!0,b.value=0,y.value.clear();const t=[];e.value.pages.forEach(w=>{w.groups.forEach(S=>{S.units.forEach(V=>{t.push({id:V.id,lessonId:e.value.id})})})});const f=t.length,d=5;for(let w=0;w<t.length;w+=d){const V=t.slice(w,w+d).map(async({id:ce,lessonId:dt})=>{try{const{data:Ce}=await fe.getUnitByIdandLessonId(ce,dt,J.value);y.value.set(ce,Ce)}catch(Ce){console.warn(`Failed to preload unit ${ce}:`,Ce)}});await Promise.all(V),b.value=Math.round(Math.min(w+d,f)/f*100)}}catch(t){console.error("Error preloading units:",t)}finally{C.value=!1}}async function P(t,f){if(y.value.has(t))return y.value.get(t);try{p.value=!0;const{data:d}=await fe.getUnitByIdandLessonId(t,f,J.value);return y.value.set(t,d),d}catch(d){L.add({severity:"error",summary:d.response.data.error,life:2e3})}finally{p.value=!1}}async function h(){if(e.value!=null){l.value=!0,a.value=[],I.value=[],o.value=0,x.value=0,m.value=0,z.value=[],$.value="",Z.value=[],D.value=!1,G.value=!1;for(let t=0;t<e.value.pages.length;t++)z.value.push(0);B.value="continue",Xe(),a.value.push(e.value.pages[o.value].groups[m.value]),await le(e.value.id),l.value=!1}}function q(t,f){var w,S;A.value=f.id,$.value==""&&($.value=`emulator-${A.value}`);const d=f.content.starting;T.value=d!="",E.value=Te($.value),E.value.setCode(d),t=="pibody"&&(U.value=Me($.value),(w=U.value)==null||w.clearSlots(),(S=U.value)==null||S.reset(),W.value=f.data.neededModules,U.value.addNeededModules(W.value),Z.value=[])}function ne(){var w;if($.value=="")return;Ge.getSharedEmulator().stop();const f=a.value[m.value].units.find(S=>S.id===A.value),d=(f==null?void 0:f.content.starting)??"";d!=""&&(E.value=Te($.value),E.value.setCode(d),(f==null?void 0:f.unitType)=="pibody"&&(U.value=Me($.value),(w=U.value)==null||w.clearSlots(),Z.value=[]))}function ae(){if($.value=="")return;Ge.getSharedEmulator().stop()}async function le(t){Y.value=!1,O.value=!1,T.value=!1;for(let f=0;f<a.value[m.value].units.length;f++){const d=a.value[m.value].units[f];["options","open","code","pibody","submit-image"].includes(d.unitType)&&(B.value="check",O.value=!0);const w=await P(d.id,t);if(w){const S=Ve(w);a.value[m.value].units[f].content=S==null?void 0:S.content,a.value[m.value].units[f].data=S==null?void 0:S.data,a.value[m.value].units[f].studentState=S==null?void 0:S.studentState,["code","pibody"].includes(d.unitType)&&(Y.value=!0,S.content.answer==""&&S.data.tests.lenght==0||(K.value=!1),q(d.unitType,S))}}O.value&&M(),B.value=="continue"&&await ye()}async function ye(){if(e.value!=null)try{_.value=!0,D.value=!1;for(const t of a.value[a.value.length-1].units){if(g.value.set(t.id,t.studentState.answer),["code","pibody"].includes(t.unitType)){const f=Te($.value).code.value;if(t.data.tests.length>0){const d=await kt($.value,f,t.data.tests,t.data.includedCommands);D.value=d.correct}else if(!t.content.hashed_answer)D.value=!0;else{const d=ds(f),w=await Le(d);D.value=t.content.hashed_answer===w}}else if(t.unitType=="open"){const d=String(t.studentState.answer.open??"").replace(/ /g,"").toLowerCase(),w=await Le(d);D.value=!t.content.hashed_answer||t.content.hashed_answer===w}else if(t.unitType=="options"){const f=t.studentState.answer.options,d=[];for(const w of f)d.push(await Le(w));D.value=t.content.hashed_answer.length==0||vs(t.content.hashed_answer,d)}else if(t.unitType=="submit-image"){const f=String(t.studentState.answer.url??"");D.value=f.length>0}else D.value=!0;if(D.value==!1)break}a.value[a.value.length-1].units.length||(D.value=!0),D.value?(z.value[o.value]++,m.value>=e.value.pages[o.value].groups.length-1?o.value<e.value.pages.length-1?B.value="continue":B.value="finish":B.value="continue"):B.value="try-again"}finally{_.value=!1}}async function M(){if(e.value!=null){G.value=!0;for(const t of a.value[a.value.length-1].units)g.value.set(t.id,t.studentState.answer),t.unitType=="open"?G.value&&(G.value=!t.content.hashed_answer):t.unitType=="options"?G.value&&(G.value=t.content.hashed_answer.length==0):t.unitType=="submit-image"&&G.value&&(G.value=!0)}}async function ue(){if(e.value!=null){if(ae(),m.value>=e.value.pages[o.value].groups.length-1){await Ue(),Re();return}l.value=!0,m.value++,a.value.push(e.value.pages[o.value].groups[m.value]),await le(e.value.id),l.value=!1}}async function De(t){const f=a.value[a.value.length-1].id;B.value="continue",z.value[o.value]--,m.value--,a.value.pop(),f==t?o.value==0&&a.value.length==0?await h():await ue():await De(t)}function Xe(){if(!e.value)return;let t=0;for(const f of e.value.pages)if(f.groups.every(w=>w.units.every(S=>S.studentStatus==="completed")))t!=e.value.pages.length-1&&(z.value[t]=f.groups.length,t++);else break;o.value=t,x.value=o.value-1}function Ze(){o.value!=0&&(z.value[o.value]=0,z.value[o.value-1]=0,o.value-=2,Re())}async function et(){if(!e.value)return!1;try{if(l.value=!0,x.value<0)return l.value=!1,!1;const f=[...e.value.pages[x.value].groups];for(const d of f)for(let w=0;w<d.units.length;w++){const S=await P(d.units[w].id,e.value.id);if(S){const V=Ve(S);if(d.units[w].content=V==null?void 0:V.content,d.units[w].data=V==null?void 0:V.data,d.units[w].studentState=V==null?void 0:V.studentState,r.value.has(d.units[w].id)){const ce=Et(r.value.get(d.units[w].id),d.units[w].unitType);d.units[w].studentState=ce}}}return I.value=[...f,...I.value],x.value-=1,!0}catch(t){return console.error("Error loading previous page:",t),!1}finally{l.value=!1}}function je(t,f){if(e.value!=null){for(const[d,w]of a.value.entries())for(const[S,V]of w.units.entries())if(V.id==t){a.value[d].units[S].studentState.answer=f;break}}}async function tt(){e.value!=null&&(B.value="check")}async function st(){e.value!=null&&(await Ue(),B.value="completed")}function nt(){y.value.clear(),b.value=0,C.value=!1}async function Re(){e.value!=null&&(l.value=!0,o.value-1==x.value?x.value++:I.value=[...I.value,...a.value],o.value++,a.value=[],m.value=0,B.value="continue",a.value.push(e.value.pages[o.value].groups[m.value]),await le(e.value.id),l.value=!1)}function at(t){Y.value=t}function lt(){K.value=!0}async function ot(t){$.value!=""&&(t.code=E.value.code,je(A.value,t),await fe.saveUnitByIdandLessonId(A.value,e.value.id,{answer:t}))}async function Ue(){if(l.value=!0,e.value==null)return;const t=Array.from(g.value.entries()).map(([d,w])=>({id:d,student_answer:w})),{data:f}=await fe.submitUnitsByLessonId(e.value.id,t);D.value=f.correct,r.value=new Map([...r.value,...g.value]),g.value=new Map,l.value=!1}const Q=N(()=>e.value?e.value.pages[o.value]??null:null),oe=N(()=>Q.value?Q.value.groups[m.value]??null:null),it=N({get:()=>{var t;return((t=oe.value)==null?void 0:t.pibodyDrawerVisible)??!1},set:t=>{oe.value&&(oe.value.pibodyDrawerVisible=t)}}),rt=N({get:()=>{var t;return((t=oe.value)==null?void 0:t.codeDrawerVisible)??!1},set:t=>{oe.value&&(oe.value.codeDrawerVisible=t)}}),ut=N({get:()=>{var t;return((t=Q.value)==null?void 0:t.showPibody)??!1},set:t=>{Q.value&&(Q.value.showPibody=t)}}),ct=N({get:()=>{var t;return((t=Q.value)==null?void 0:t.showCode)??!1},set:t=>{Q.value&&(Q.value.showCode=t)}});return{selectedLesson:e,isLessonLoading:c,isUnitLoading:p,groups:a,finishedGroups:I,groupIndex:m,isGroupLoading:l,isSubmitLoading:_,isPreloadingUnits:C,preloadingProgress:b,groupStatus:B,submitExist:O,correct:D,isAccept:G,submitEnabled:me,pageProgress:z,pageIndex:o,previousPageIndex:x,emulatorID:$,neededModules:W,slots:Z,pibodyDrawerVisible:it,codeDrawerVisible:rt,showPibody:ut,showCode:ct,answersCache:g,startingCodeExist:T,setSubmitable:at,loadLessonById:$e,loadUnitByIdandLessonId:P,preloadAllUnits:re,clearUnitsCache:nt,loadInitialGroup:h,submitGroup:ye,nextGroup:ue,saveAnswer:je,tryAgain:tt,finishLesson:st,runCodePressed:lt,saveStudentIdeState:ot,resetGroup:De,pageBack:Ze,loadPreviousPage:et,resetEmulator:ne}}),ps={class:"ptr-wrapper"},fs={key:0,class:"flex flex-col justify-center items-center"},gs={key:1,class:"flex gap-2 items-center"},pe=70,qe=180,hs=X({__name:"PullToRefresh",props:{onRefresh:{type:Function},enabled:{type:Boolean}},setup(L){const e=L,c=N(()=>e.enabled??!0),p=v(null),l=v("idle"),_=v(0),C=v(0);let b=0;async function o(){if(l.value!=="loading"){l.value="loading",_.value=pe,C.value=1;try{await new Promise(r=>setTimeout(r,500)),await e.onRefresh()}finally{setTimeout(()=>{b=0,_.value=0,C.value=0,l.value="idle"},150)}}}function x(r){c.value&&p.value&&(p.value.scrollTop>0||l.value==="loading"||r.deltaY<0&&(r.preventDefault(),b=Math.min(qe,b-r.deltaY),_.value=b,C.value=Math.min(1,b/pe),b>=pe&&o()))}let a=0,I=!1;function m(r){p.value&&(p.value.scrollTop>0||!c.value||!I||l.value==="loading"||(a=r.touches[0].clientY,I=!0))}function y(r){if(!c.value)return;const B=r.touches[0].clientY-a;B<=0||(r.preventDefault(),b=Math.min(qe,B),_.value=b,C.value=Math.min(1,b/pe),b>=pe&&o())}function g(){c.value&&(I=!1,b=0,l.value!=="loading"&&(_.value=0,C.value=0))}return be(()=>{const r=p.value;r&&(r.style.overscrollBehavior="contain",r.addEventListener("wheel",x,{passive:!1}),r.addEventListener("touchstart",m),r.addEventListener("touchmove",y,{passive:!1}),r.addEventListener("touchend",g))}),Ye(()=>{const r=p.value;r&&(r.removeEventListener("wheel",x),r.removeEventListener("touchstart",m),r.removeEventListener("touchmove",y),r.removeEventListener("touchend",g))}),(r,z)=>(n(),u("div",ps,[c.value?(n(),u("div",{key:0,class:"ptr-indicator",style:we({height:`${_.value}px`,opacity:C.value})},[l.value==="idle"?(n(),u("div",fs,z[0]||(z[0]=[i("i",{class:"pi pi-angle-double-down",style:{"font-size":"1rem"}},null,-1)]))):(n(),u("div",gs,[z[1]||(z[1]=i("i",{class:"pi pi-sync",style:{"font-size":"0.7rem"}},null,-1)),i("div",null,F(r.$t("pages.schedule.loading")),1)]))],4)):j("",!0),i("div",{class:"ptr-content",ref_key:"contentRef",ref:p},[wt(r.$slots,"default",{},void 0,!0)],512)]))}}),ms=ze(hs,[["__scopeId","data-v-214e9b3a"]]),ys={key:1,class:"px-4 py-2"},ws={key:4},bs=X({__name:"UnitCard",props:{unit:{},loading:{type:Boolean},revise:{type:Boolean}},setup(L){const e=L,c=Ie(),p=xe(),{saveAnswer:l,setSubmitable:_}=p;function C(a){e.unit.unitType=="options"?_(a.options.length>0):e.unit.unitType=="open"?_(a.open.length>0):e.unit.unitType=="submit-image"&&_(a.url.length>0),l(e.unit.id,a),b(a)}const b=Qe(a=>{o(a)},1e3,{maxWait:5e3});async function o(a){await fe.saveUnitByIdandLessonId(e.unit.id,Number(c.params.id),{answer:a})}const x=N(()=>{var a;return(a=e.unit.content)!=null&&a.answer?Array.isArray(e.unit.content.answer)?e.unit.content.answer.length>0:typeof e.unit.content.answer=="string"?e.unit.content.answer.trim()!=="":!0:!1});return(a,I)=>{const m=Pe;return n(),u("div",null,[a.loading?(n(),R(m,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),u("div",ys,[e.unit.unitType=="article"?(n(),R(s(Lt),{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="options"?(n(),R(s(At),{key:1,"options-data":e.unit.content,state:e.unit.studentState,onSaveAnswer:C},null,8,["options-data","state"])):e.unit.unitType=="open"?(n(),R(s(Pt),{key:2,state:e.unit.studentState,onSaveAnswer:C},null,8,["state"])):e.unit.unitType=="video"?(n(),R(s(It),{key:3,video:e.unit.content},null,8,["video"])):e.unit.unitType=="submit-image"?(n(),u("div",ws,[e.revise?(n(),R(s(Bt),{key:0,state:e.unit.studentState},null,8,["state"])):(n(),R(s(cs),{key:1,state:e.unit.studentState,"unit-id":e.unit.id,onSaveAnswer:C},null,8,["state","unit-id"]))])):e.unit.unitType=="tinkercad"?(n(),R(s(jt),{key:5,tinkercad:e.unit.content},null,8,["tinkercad"])):e.revise&&e.unit.unitType=="code"?(n(),R(s(zt),{key:6,state:e.unit.studentState},null,8,["state"])):e.revise&&e.unit.unitType=="pibody"?(n(),R(s(Dt),{key:7,state:e.unit.studentState},null,8,["state"])):j("",!0),x.value?(n(),R(s(Zt),{key:8,unitType:e.unit.unitType,unitContent:e.unit.content},null,8,["unitType","unitContent"])):j("",!0)]))])}}}),_s={key:1,class:"flex flex-col h-full w-full"},xs={class:"flex-grow flex flex-col gap-4 px-4 py-2"},Fe=X({__name:"GroupCard",props:{group:{},loading:{type:Boolean},revise:{type:Boolean}},setup(L){const e=L,c=v(null);return ie(()=>e.loading,p=>{p===!1&&c.value&&requestAnimationFrame(()=>{var l;(l=c.value)==null||l.scrollIntoView({behavior:"smooth",block:"start"})})}),(p,l)=>{const _=Pe;return n(),u("div",{ref_key:"groupRef",ref:c},[p.loading?(n(),R(_,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),u("div",_s,[i("div",xs,[(n(!0),u(ee,null,ge(p.group.units,C=>(n(),R(bs,{key:C.id,unit:C,revise:e.revise},null,8,["unit","revise"]))),128))])]))],512)}}}),ks={key:0,class:"absolute right-0"},He=10,$s=X({__name:"UnitsView",props:{pages:{}},setup(L){const e=xe(),{groups:c,isGroupLoading:p,previousPageIndex:l,finishedGroups:_}=he(e),{loadInitialGroup:C,resetGroup:b,loadPreviousPage:o}=e,x=Be(),a=v(null),I=v(null),m=v(0),y=v(!1),g=v(null),r=v(!1);function z(T){let $=T;for(;$&&$.parentElement;){const A=$.parentElement,E=getComputedStyle(A).overflowY;if(E==="auto"||E==="scroll")return A;$=A}return null}async function B(){await Se();const T=z(a.value),$=I.value;if(!T||!$){m.value=0;return}const A=T.clientHeight,U=$.getBoundingClientRect().height,E=Math.max(0,A-U-16);m.value=E,r.value&&T&&(await Se(),await new Promise(W=>requestAnimationFrame(W)),T.scrollTo({top:10,behavior:"smooth"}),r.value=!1)}function O(T,$){var E;const A=(E=c.value[c.value.length-1])==null?void 0:E.id;let U=null;T&&(T instanceof Element?U=T:T.$el instanceof Element&&(U=T.$el)),I.value=$.id===A?U:null}be(()=>{C(),B(),window.addEventListener("resize",B),g.value=z(a.value),g.value&&(g.value.addEventListener("scroll",Y),g.value.scrollHeight<=g.value.clientHeight&&(D.value=!0,G.value=He))}),Oe(()=>{window.removeEventListener("resize",B),g.value&&g.value.removeEventListener("scroll",Y)}),ie(()=>c.value.length,async()=>{await B()}),ie(()=>p.value,async(T,$)=>{$===!0&&T===!1&&await B()});const D=v(!1),G=v(-40);function Y(){if(!g.value)return;const T=g.value.scrollTop,$=5;if(T<=$&&l.value>=0){D.value=!0;const A=40;G.value=Math.min(He,-A+A*($-T)/$)}else D.value=!1,G.value=-40}async function K(){if(y.value||!g.value)return;y.value=!0,r.value=!0;const T=g.value;try{await o()?(await Se(),await new Promise(A=>requestAnimationFrame(A)),await new Promise(A=>requestAnimationFrame(A)),r.value&&(T.scrollTo({top:0,behavior:"smooth"}),r.value=!1)):r.value=!1}finally{y.value=!1}}return(T,$)=>{const A=_e,U=We;return n(),u("div",{ref_key:"rootEl",ref:a,class:"flex flex-col gap-2"},[k(ms,{"on-refresh":K,enabled:D.value},{default:H(()=>[(n(!0),u(ee,null,ge(s(_),E=>(n(),u("div",{key:E.id,class:"relative"},[k(Fe,{group:E,revise:!0,loading:s(p)&&E.id==s(_)[s(_).length-1].id},null,8,["group","loading"])]))),128)),(n(!0),u(ee,null,ge(s(c),E=>(n(),u("div",{key:E.id,ref_for:!0,ref:W=>O(W,E),class:"relative"},[!s(p)&&s(x).userRole=="editor"?(n(),u("div",ks,[Ke((n(),R(A,{type:"button",class:"w-9 h-9 mr-8 mt-2",rounded:"",severity:"secondary",variant:"text",onClick:W=>s(b)(E.id)},{default:H(()=>$[0]||($[0]=[i("span",{class:"material-icons"},"restart_alt",-1)])),_:2},1032,["onClick"])),[[U,"Reset step",void 0,{left:!0}]])])):j("",!0),k(Fe,{group:E,loading:s(p)&&E.id==s(c)[s(c).length-1].id},null,8,["group","loading"])]))),128)),i("div",{style:we({height:m.value+"px"})},null,4)]),_:1},8,["enabled"])],512)}}}),Cs=ze($s,[["__scopeId","data-v-1d2aa5dc"]]),Ss={key:0,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Ts={key:1},Es={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},Ls={key:0,class:"text-lg font-bold flex items-center gap-2"},As={key:1,class:"text-lg font-bold flex items-center gap-2"},Ps={key:"incorrect",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-red-100"},Is={key:"no-submit",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Bs={key:"try-again",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-gray-50"},zs={class:"text-lg font-bold flex items-center gap-2"},Ds={key:2},js={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},Rs={key:0,class:"text-lg font-bold flex items-center gap-2"},Us={key:1,class:"text-lg font-bold flex items-center gap-2"},Ms={key:1,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Gs=X({__name:"NavigationBar",setup(L){const e=xe(),{isSubmitLoading:c,groupStatus:p,isGroupLoading:l,submitExist:_,correct:C,isAccept:b,submitEnabled:o}=he(e),{submitGroup:x,nextGroup:a,tryAgain:I,finishLesson:m}=e;return(y,g)=>{const r=_e;return n(),u(ee,null,[s(p)=="check"?(n(),u("div",Ss,[k(r,{label:s(b)?y.$t("submit"):y.$t("check").toUpperCase(),icon:"pi pi-check","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(x),loading:s(c),disabled:s(c)||!s(o)},null,8,["label","onClick","loading","disabled"])])):j("",!0),s(p)=="continue"?(n(),u("div",Ts,[k(Ae,{name:"pop",appear:"",mode:"out-in"},{default:H(()=>[s(_)&&s(C)?(n(),u("div",Es,[s(b)?(n(),u("div",Ls,[g[0]||(g[0]=i("span",{class:"text-3xl"},"‚úÖ",-1)),de(" "+F(y.$t("accepted"))+"!",1)])):(n(),u("div",As,[g[1]||(g[1]=i("span",{class:"text-3xl"},"üéâ",-1)),de(" "+F(y.$t("correct"))+"!",1)])),k(r,{label:y.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(a),loading:s(l),disabled:s(l)},null,8,["label","onClick","loading","disabled"])])):s(_)&&!s(C)?(n(),u("div",Ps,[k(r,{label:y.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(a),loading:s(l),disabled:s(l)},null,8,["label","onClick","loading","disabled"])])):(n(),u("div",Is,[k(r,{label:y.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(a),loading:s(l),disabled:s(l)},null,8,["label","onClick","loading","disabled"])]))]),_:1})])):j("",!0),k(Ae,{name:"shake",appear:""},{default:H(()=>[s(p)=="try-again"?(n(),u("div",Bs,[i("div",zs,[g[2]||(g[2]=i("span",{class:"text-3xl"},"‚ö†Ô∏è",-1)),de(" "+F(y.$t("incorrect"))+"! ",1)]),k(r,{label:y.$t("tryAgain").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(I)},null,8,["label","onClick"])])):j("",!0)]),_:1}),s(p)=="finish"?(n(),u("div",Ds,[s(_)&&s(C)?(n(),u("div",js,[s(b)?(n(),u("div",Rs,[g[3]||(g[3]=i("span",{class:"text-3xl"},"‚úÖ",-1)),de(" "+F(y.$t("accepted"))+"!",1)])):(n(),u("div",Us,[g[4]||(g[4]=i("span",{class:"text-3xl"},"üéâ",-1)),de(" "+F(y.$t("correct"))+"!",1)])),k(r,{label:y.$t("finish").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(m),loading:s(l),disabled:s(l)},null,8,["label","onClick","loading","disabled"])])):(n(),u("div",Ms,[k(r,{label:y.$t("finish").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(m)},null,8,["label","onClick"])]))])):j("",!0)],64)}}}),Vs=ze(Gs,[["__scopeId","data-v-39035ee6"]]),qs={key:0,class:"h-screen bg-white flex flex-col items-center overflow-hidden relative"},Fs={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 max-w-[1920px] mx-auto"},Hs={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},Ws={class:"flex items-center gap-4"},Ns={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},Ys={class:"flex-1 overflow-y-auto mt-16 mb-24 w-full"},Os={key:1,class:"flex justify-center"},Ks={key:2},Js={key:3,class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-[1000] border border-gray-200 flex flex-col items-center gap-4"},Qs={key:4,class:"fixed top-20 right-4 bg-white rounded-lg shadow-md z-50 border border-gray-200 p-4 min-w-64"},Xs={class:"flex items-center gap-3 mb-2"},Zs={class:"fixed bottom-0 left-0 right-0 z-50 bg-transparent shadow-md max-w-[1920px] mx-auto"},en={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},tn={class:"relative h-full"},sn={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},nn={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},an={class:"relative h-full"},ln={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},on={key:0,class:"absolute right-0 top-0 z-10 h-[38px] p-[1px]"},rn={key:0,class:"h-screen flex flex-col items-center justify-center overflow-hidden gap-10"},un={class:"flex flex-col items-center"},cn={class:"text-4xl font-bold mb-8"},dn={class:"text-md text-gray-500"},Kn=X({__name:"LessonPage",setup(L){const e=Ie(),c=_t(),p=Be(),l=Je(),{lang:_}=he(l);ie(_,async(P,h)=>{P!==h&&o.value&&await K(Number(e.params.id),(e.query.route_id??"").toString())});const C=xe(),{isLessonLoading:b,selectedLesson:o,pageProgress:x,groupStatus:a,emulatorID:I,neededModules:m,slots:y,pibodyDrawerVisible:g,codeDrawerVisible:r,showPibody:z,showCode:B,isPreloadingUnits:O,preloadingProgress:D,answersCache:G,startingCodeExist:Y}=he(C),{loadLessonById:K,runCodePressed:T,saveStudentIdeState:$,pageBack:A,resetEmulator:U}=C;function E(P){var q;const h=((q=o.value)==null?void 0:q.pages.reduce((ne,ae)=>ne+ae.groups.length,0))||1;return P/h*100}function W(){var P;((P=o.value)==null?void 0:P.lessonType)=="module"?c.push("/v2/docs"):e.query.route_id&&e.query.route_id!=""?c.push("/v2/route/"+e.query.route_id):p.userRole=="editor"?c.push("/v2/routes"):c.push("/v2/home")}ie(y,()=>{Z({slots:y.value})});const Z=Qe(P=>{$(P)},1e3,{maxWait:5e3});function ke(P){Z({slots:y.value})}const te=v(window.innerWidth),se=v(16);function J(){if(te.value=window.innerWidth,te.value<=1300){se.value=16;return}const h=452-(te.value-1024)/2;se.value=h>16?h:16}be(async()=>{var P,h;a.value="continue",J(),await K(Number(e.params.id),(e.query.route_id??"").toString()),((P=o.value)==null?void 0:P.lessonType)=="project"&&c.push({path:e.path.replace("/lesson/","/project/"),query:e.query}),((h=o.value)==null?void 0:h.studentProgress)==100&&p.userRole!="editor"&&c.push({path:`${e.path}/revise`,query:e.query}),window.addEventListener("resize",J),window.addEventListener("beforeunload",re)}),Ye(()=>{window.removeEventListener("resize",J)});const me=N(()=>te.value<=1920?{}:"calc((-100vw + 1920px) / 2)"),$e=()=>{c.push(`${e.path}/edit`)};Oe(()=>{window.removeEventListener("beforeunload",re)});function re(P){if(a.value!="completed"&&G.value.size>0)return P.preventDefault(),!0}return(P,h)=>{const q=_e,ne=pt,ae=Pe,le=vt,ye=We;return n(),u(ee,null,[s(a)!="completed"?(n(),u("div",qs,[i("div",Fs,[i("div",Hs,[i("div",Ws,[k(q,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:W})]),s(o)?(n(),u("div",Ns,[(n(!0),u(ee,null,ge(s(o).pages,(M,ue)=>(n(),u("div",{key:ue,class:"h-full",style:we({width:E(M.groups.length)+"%"})},[k(ne,{value:s(x)[ue]/M.groups.length*100,"show-value":!1,class:"w-full rounded-full h-3"},null,8,["value"])],4))),128))])):j("",!0),h[9]||(h[9]=i("div",{class:"w-10"},null,-1))])]),i("div",Ys,[i("div",{class:"w-full h-full max-w-screen-lg mx-auto",style:we({paddingLeft:se.value+"px",paddingRight:se.value+"px"})},[s(b)?(n(),R(ae,{key:0,class:"flex justify-center"})):s(o)?(n(),u("div",Ks,[k(Cs,{pages:s(o).pages},null,8,["pages"])])):(n(),u("div",Os,"No lesson found")),s(p).userRole=="editor"?(n(),u("div",Js,[k(s(Ct)),k(q,{icon:"pi pi-pencil",variant:"text",severity:"contrast",onClick:$e}),k(q,{variant:"text",severity:"contrast",onClick:s(A)},{default:H(()=>h[10]||(h[10]=[i("span",{class:"material-icons"},"swipe_left_alt",-1)])),_:1},8,["onClick"])])):j("",!0),s(O)?(n(),u("div",Qs,[i("div",Xs,[k(ae,{style:{width:"20px",height:"20px"}}),h[11]||(h[11]=i("span",{class:"text-sm font-medium"},"Preloading units...",-1))]),k(ne,{value:s(D),"show-value":!0,class:"h-2"},null,8,["value"])])):j("",!0)],4)]),i("div",Zs,[k(Vs)]),s(z)?(n(),u("div",en,[k(q,{icon:"pi pi-microchip",severity:"secondary",onClick:h[0]||(h[0]=M=>g.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),k(le,{visible:s(g),"onUpdate:visible":h[4]||(h[4]=M=>ve(g)?g.value=M:null),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${me.value}`}}},{header:H(()=>h[12]||(h[12]=[i("div",null,null,-1)])),container:H(()=>[i("div",tn,[i("div",sn,[k(q,{icon:"pi pi-chevron-left",severity:"secondary",onClick:h[1]||(h[1]=M=>g.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(n(),R(s(xt),{id:s(I),key:s(I),slots:s(y),"onUpdate:slots":h[2]||(h[2]=M=>ve(y)?y.value=M:null),neededModules:s(m),"onUpdate:neededModules":h[3]||(h[3]=M=>ve(m)?m.value=M:null),class:"w-full",horizontal:!1,autoPut:!0},null,8,["id","slots","neededModules"]))])]),_:1},8,["visible","pt"])])):j("",!0),s(B)?(n(),u("div",nn,[k(q,{icon:"pi pi-code",severity:"secondary",onClick:h[5]||(h[5]=M=>r.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),k(le,{visible:s(r),"onUpdate:visible":h[8]||(h[8]=M=>ve(r)?r.value=M:null),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${me.value}`}}},{header:H(()=>h[13]||(h[13]=[i("div",null,null,-1)])),container:H(()=>[i("div",an,[i("div",ln,[k(q,{icon:"pi pi-chevron-right",severity:"secondary",onClick:h[6]||(h[6]=M=>r.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),s(Y)?(n(),u("div",on,[Ke(k(q,{icon:"pi pi-replay",variant:"link",onClick:s(U),class:"h-[36px] rounded-lg text-sm"},null,8,["onClick"]),[[ye,P.$t("revertToStartingCode")]])])):j("",!0),(n(),R(bt,null,[(n(),R(s($t),{id:s(I),key:s(I),connectbuttons:s(z),"onUpdate:connectbuttons":h[7]||(h[7]=M=>ve(z)?z.value=M:null),onRun:s(T),onSaveAnswer:ke},null,8,["id","connectbuttons","onRun"]))],1024))])]),_:1},8,["visible","pt"])])):j("",!0)])):j("",!0),k(Ae,{"enter-active-class":"transition duration-500 ease-out","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-300 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:H(()=>[s(a)=="completed"?(n(),u("div",rn,[h[14]||(h[14]=i("div",{class:"text-5xl"},"‚ö°Ô∏è",-1)),i("div",un,[i("div",cn,F(P.$t("goodWork")),1),i("div",dn,F(P.$t("keepLearning")),1)]),i("div",null,[k(q,{label:P.$t("continue"),class:"rounded-full w-56 text-xl",onClick:W},null,8,["label"])])])):j("",!0)]),_:1})],64)}}});export{Kn as default};
