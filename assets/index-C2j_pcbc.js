import{s as ve}from"./index-DX3gV9xs.js";import{s as se}from"./index-3shJJ7Ww.js";import{s as fe}from"./index-IRxqCVSs.js";import{d as me,u as ye,r as i,A as oe,e as O,x as N,b as M,o,c as u,F as G,l as ne,h as r,z as ge,p as w,i as s,q as k,C as le,D as E,j as a,k as he,t as X,T as ae,v as ie,w as re,E as ee,g as _e,G as we,H as be,I as Q,K as xe}from"./index-CrrKimau.js";import{u as te,a as ke}from"./store-DDrSlhXQ.js";import{S as $e}from"./SimulationView-CLcAnmTU.js";import{c as Se}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-2mdW5fKD.js";import{_ as Ce}from"./CodeViewer.vue_vue_type_script_setup_true_lang-voeCvP9r.js";import{_ as Le}from"./EditLocaleSelector.vue_vue_type_script_setup_true_lang-C4tuFDpf.js";import{u as ue}from"./useLocaleStore-Bf2xWCbY.js";import{L as je}from"./lessonApi-Bh_eeZwv.js";import{P as Pe}from"./projectApi-Cl-YM23g.js";import{m as Ue}from"./mapLessonFromDto-CG19vVOp.js";import{m as Be}from"./mapUnitFromDto-DJ2zlrQL.js";import{U as Y}from"./unitApi-BOhLLp80.js";import{_ as Ie,a as Ae,b as Ee,c as ze,d as Ve}from"./TeacherReviseViewer.vue_vue_type_style_index_0_scoped_b98b9a0f_lang-BnxIVwFl.js";import{s as De}from"./index-gprwKlQi.js";import{_ as Te}from"./TinkercadViewer.vue_vue_type_script_setup_true_lang-CbdhF4Mm.js";import{u as ce}from"./index-M8gq5o1h.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-D_2waQsa.js";import"./index-B2H5Bafp.js";import"./index-DL1ViM7W.js";import"./index-Cxw2yqN5.js";import"./index-DgmsQzkT.js";import"./index-4_fBhWkb.js";import"./index-rLSFooqB.js";import"./index-Cc4fZZVN.js";import"./language-DYQF8nnT.js";import"./transformUnitDtosToPages-4blM3N0G.js";import"./index-DU7DOYFv.js";import"./index-DxuAR6go.js";const de=me("project-store",()=>{const C=ye(),e=i(null),v=i(!1),p=i(!1),m=i(!1),b=i(!1),c=i(0),f=i([]),y=i({}),d=i("submit"),x=i(!0),g=i(""),$=i(0),L=i(null),z=i(null),U=i([]),V=i([]),K=oe(),R=ue(),{lang:W}=O(R),D=i(void 0);async function H(n,_){try{v.value=!0,y.value={},D.value=K.userRole==="editor"?W.value:void 0;const{data:l}=await je.getLessonById(n,_,D.value);e.value=Ue(l),e.value.studentProgress==100?d.value="revise":d.value="submit",await j()}catch(l){C.add({severity:"error",summary:l.response.data.error,life:2e3})}finally{v.value=!1}}async function j(){if(e.value)try{f.value=[];const n=[];e.value.pages.forEach(l=>{l.groups.forEach(P=>{P.units.forEach(q=>{n.push(q.id)})})});const{data:_}=await Y.getUnitsByIdsandLessonId(n,e.value.id,D.value);for(const l of _)f.value.push(Be(l)),["code","pibody"].includes(l.unit_type)&&T(l.unit_type,f.value[f.value.length-1])}catch(n){console.error("Error preloading units:",n)}}async function B(){if(e.value!=null)try{b.value=!0;for(const[n,_]of f.value.entries())if(_.unitType=="checklist"){const l=te(g.value).code.value;for(const Z of _.data.checks){const pe=await Se(g.value,l,Z.tests);y.value[Z.id]=pe.correct}const{data:P}=await Pe.submitProject(e.value.id,{checklist:y.value}),q=P.progress;f.value[n].studentState={answer:{checklist:P.checklist}},e.value.studentProgress=q,q==100?d.value="finish":d.value="try-again"}}catch(n){console.log(n)}finally{b.value=!1}}async function I(){e.value!=null&&(d.value="submit")}async function A(){e.value!=null&&(d.value="completed")}function T(n,_){var P;$.value=_.id,g.value==""&&(g.value=`emulator-${$.value}`);const l=_.content.starting;z.value=te(g.value),z.value.setCode(l),n=="pibody"&&(L.value=ke(g.value),(P=L.value)==null||P.clearSlots(),U.value=_.data.neededModules,L.value.addNeededModules(U.value),V.value=[])}function F(){x.value=!0}async function h(n){g.value!=""&&(n.code=z.value.code,await Y.saveUnitByIdandLessonId($.value,e.value.id,{answer:n}))}const t=N(()=>e.value?e.value.pages[c.value]??null:null),S=N({get:()=>{var n;return((n=t.value)==null?void 0:n.showPibody)??!1},set:n=>{t.value&&(t.value.showPibody=n)}}),J=N({get:()=>{var n;return((n=t.value)==null?void 0:n.showCode)??!1},set:n=>{t.value&&(t.value.showCode=n)}});return{selectedLesson:e,isLessonLoading:v,isUnitLoading:p,units:f,isGroupLoading:m,isSubmitLoading:b,projectStatus:d,emulatorID:g,neededModules:U,slots:V,showPibody:S,showCode:J,submitProject:B,tryAgain:I,finishLesson:A,loadLessonById:H,loadAllUnits:j,runCodePressed:F,saveStudentIdeState:h}}),Me={class:"flex flex-col gap-2"},Re=M({__name:"ChecklistViewer",props:{checklist:{},state:{}},setup(C){const e=C,v=N(()=>{var p;return((p=e.state.answer)==null?void 0:p.checklist)??{}});return(p,m)=>{const b=De;return o(),u("div",Me,[(o(!0),u(G,null,ne(e.checklist.options,c=>(o(),u("div",{key:c.id,class:"flex gap-4 items-center"},[r(b,{modelValue:v.value[c.id],"onUpdate:modelValue":f=>v.value[c.id]=f,binary:!0,onClick:m[0]||(m[0]=ge(()=>{},["stop","prevent"]))},null,8,["modelValue","onUpdate:modelValue"]),r(Ie,{text:c.text},null,8,["text"])]))),128))])}}}),We={key:1,class:"px-4 py-2"},Fe=M({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(C){const e=C,v=le();function p(c){m(c)}const m=ce(c=>{b(c)},1e3,{maxWait:5e3});async function b(c){await Y.saveUnitByIdandLessonId(e.unit.id,Number(v.params.id),{answer:c})}return(c,f)=>{const y=se;return o(),u("div",null,[c.loading?(o(),w(y,{key:0,class:"flex justify-center items-center w-10 h-full"})):(o(),u("div",We,[e.unit.unitType=="article"?(o(),w(s(Ae),{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="checklist"?(o(),w(s(Re),{key:1,checklist:e.unit.content,state:e.unit.studentState},null,8,["checklist","state"])):e.unit.unitType=="options"?(o(),w(s(Ee),{key:2,"options-data":e.unit.content,state:e.unit.studentState,onSaveAnswer:p},null,8,["options-data","state"])):e.unit.unitType=="open"?(o(),w(s(ze),{key:3,state:e.unit.studentState,onSaveAnswer:p},null,8,["state"])):e.unit.unitType=="video"?(o(),w(s(Ve),{key:4,video:e.unit.content},null,8,["video"])):e.unit.unitType=="tinkercad"?(o(),w(s(Te),{key:5,tinkercad:e.unit.content},null,8,["tinkercad"])):k("",!0)]))])}}}),qe={ref:"rootEl",class:"flex flex-col gap-8"},Oe=M({__name:"UnitsView",props:{units:{}},setup(C){return(e,v)=>(o(),u("div",qe,[(o(!0),u(G,null,ne(e.units,p=>(o(),w(Fe,{key:p.id,unit:p},null,8,["unit"]))),128))],512))}}),Ge={key:0,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Ke={key:"try-again",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-gray-50"},He={class:"text-lg font-bold flex items-center gap-2"},Je={key:1},Qe={class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Xe={key:2},Ye={class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Ze=M({__name:"NavigationBar",setup(C){const e=ie(),v=de(),{isSubmitLoading:p,projectStatus:m}=O(v),{submitProject:b,tryAgain:c,finishLesson:f}=v;return(y,d)=>{const x=re;return o(),u(G,null,[s(m)=="submit"?(o(),u("div",Ge,[r(x,{label:y.$t("submit").toUpperCase(),icon:"pi pi-check","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(b),loading:s(p),disabled:s(p)},null,8,["label","onClick","loading","disabled"])])):k("",!0),r(ae,{name:"shake",appear:""},{default:E(()=>[s(m)=="try-again"?(o(),u("div",Ke,[a("div",He,[d[1]||(d[1]=a("span",{class:"text-3xl"},"⚠️",-1)),he(" "+X(y.$t("incorrect"))+"! ",1)]),r(x,{label:y.$t("tryAgain").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(c)},null,8,["label","onClick"])])):k("",!0)]),_:1}),s(m)=="finish"?(o(),u("div",Je,[a("div",Qe,[r(x,{label:y.$t("finish").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(f)},null,8,["label","onClick"])])])):k("",!0),s(m)=="revise"?(o(),u("div",Xe,[a("div",Ye,[r(x,{label:y.$t("close").toUpperCase(),icon:"pi pi-sign-out","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:d[0]||(d[0]=g=>s(e).push({name:"projects2"}))},null,8,["label"])])])):k("",!0)],64)}}}),et=Ne(Ze,[["__scopeId","data-v-ee895426"]]),tt={key:0,class:"h-screen bg-white flex flex-col items-center overflow-hidden relative"},st={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 max-w-[1920px] mx-auto"},ot={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},nt={class:"flex items-center gap-4"},lt={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},at={class:"flex-1 overflow-y-auto mt-16 mb-24 w-full"},it={key:1,class:"flex justify-center"},rt={key:2},ut={key:3,class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-[1000] border border-gray-200 flex flex-col items-center gap-4"},ct={class:"fixed bottom-0 left-0 right-0 z-50 bg-transparent shadow-md max-w-[1920px] mx-auto"},dt={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},pt={class:"relative h-full"},vt={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},ft={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},mt={class:"relative h-full"},yt={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},gt={key:0,class:"h-screen flex flex-col items-center justify-center overflow-hidden gap-10"},ht={class:"flex flex-col items-center"},_t={class:"text-4xl font-bold mb-8"},wt={class:"text-md text-gray-500"},Zt=M({__name:"ProjectPage",setup(C){const e=le(),v=ie(),p=oe(),m=ue(),{lang:b}=O(m);ee(b,async(h,t)=>{h!==t&&d.value&&await V(Number(e.params.id),(e.query.route_id??"").toString())});const c=de(),{units:f,isLessonLoading:y,selectedLesson:d,emulatorID:x,neededModules:g,slots:$,showPibody:L,showCode:z,projectStatus:U}=O(c),{loadLessonById:V,saveStudentIdeState:K}=c;function R(){v.push({name:"projects2"})}ee($,()=>{W({slots:$.value})});const W=ce(h=>{K(h)},1e3,{maxWait:5e3});function D(h){W({slots:$.value})}const H=()=>{const h=e.path.replace("/project/","/lesson/");v.push(`${h}/edit`)},j=i(window.innerWidth),B=i(16),I=i(!0),A=i(!0);function T(){if(j.value=window.innerWidth,j.value<=1300){B.value=16;return}const t=452-(j.value-1024)/2;B.value=t>16?t:16}_e(()=>{T(),V(Number(e.params.id),(e.query.route_id??"").toString()),window.addEventListener("resize",T)}),we(()=>{window.removeEventListener("resize",T)});const F=N(()=>j.value<=1920?{}:"calc((-100vw + 1920px) / 2)");return(h,t)=>{const S=re,J=fe,n=se,_=ve;return o(),u(G,null,[s(U)!="completed"?(o(),u("div",tt,[a("div",st,[a("div",ot,[a("div",nt,[r(S,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:R})]),s(d)?(o(),u("div",lt,[r(J,{value:s(d).studentProgress,"show-value":!1,class:"w-full rounded-full h-3"},null,8,["value"])])):k("",!0),t[9]||(t[9]=a("div",{class:"w-10"},null,-1))])]),a("div",at,[a("div",{class:"w-full h-full max-w-screen-lg mx-auto py-8",style:be({paddingLeft:B.value+"px",paddingRight:B.value+"px"})},[s(y)?(o(),w(n,{key:0,class:"flex justify-center"})):s(d)?(o(),u("div",rt,[r(Oe,{units:s(f)},null,8,["units"])])):(o(),u("div",it,"No lesson found")),s(p).userRole=="editor"?(o(),u("div",ut,[r(s(Le)),r(S,{icon:"pi pi-pencil",variant:"text",severity:"contrast",onClick:H})])):k("",!0)],4)]),a("div",ct,[r(et)]),s(L)?(o(),u("div",dt,[r(S,{icon:"pi pi-microchip",severity:"secondary",onClick:t[0]||(t[0]=l=>I.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),r(_,{visible:I.value,"onUpdate:visible":t[4]||(t[4]=l=>I.value=l),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${F.value}`}}},{header:E(()=>t[10]||(t[10]=[a("div",null,null,-1)])),container:E(()=>[a("div",pt,[a("div",vt,[r(S,{icon:"pi pi-chevron-left",severity:"secondary",onClick:t[1]||(t[1]=l=>I.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(o(),w(s($e),{id:s(x),key:s(x),slots:s($),"onUpdate:slots":t[2]||(t[2]=l=>Q($)?$.value=l:null),neededModules:s(g),"onUpdate:neededModules":t[3]||(t[3]=l=>Q(g)?g.value=l:null),class:"w-full",horizontal:!1,autoPut:!0},null,8,["id","slots","neededModules"]))])]),_:1},8,["visible","pt"])])):k("",!0),s(z)?(o(),u("div",ft,[r(S,{icon:"pi pi-code",severity:"secondary",onClick:t[5]||(t[5]=l=>A.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),r(_,{visible:A.value,"onUpdate:visible":t[8]||(t[8]=l=>A.value=l),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${F.value}`}}},{header:E(()=>t[11]||(t[11]=[a("div",null,null,-1)])),container:E(()=>[a("div",mt,[a("div",yt,[r(S,{icon:"pi pi-chevron-right",severity:"secondary",onClick:t[6]||(t[6]=l=>A.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),(o(),w(xe,null,[(o(),w(s(Ce),{id:s(x),key:s(x),connectbuttons:s(L),"onUpdate:connectbuttons":t[7]||(t[7]=l=>Q(L)?L.value=l:null),onSaveAnswer:D},null,8,["id","connectbuttons"]))],1024))])]),_:1},8,["visible","pt"])])):k("",!0)])):k("",!0),r(ae,{"enter-active-class":"transition duration-500 ease-out","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-300 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:E(()=>[s(U)=="completed"?(o(),u("div",gt,[t[12]||(t[12]=a("div",{class:"text-5xl"},"⚡️",-1)),a("div",ht,[a("div",_t,X(h.$t("goodWork")),1),a("div",wt,X(h.$t("keepLearning")),1)]),a("div",null,[r(S,{label:h.$t("continue"),class:"rounded-full w-56 text-xl",onClick:R},null,8,["label"])])])):k("",!0)]),_:1})],64)}}});export{Zt as default};
