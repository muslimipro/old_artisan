import{s as Q,a as W}from"./index-P7_tGZCZ.js";import{s as Z}from"./index-BCI9kVQP.js";import{a as ee,b as le}from"./index-Bht399_o.js";import{s as h}from"./index-X0HA0JnL.js";import{b as D,ab as M,u as L,r as d,o as $,p as I,D as t,h as l,j as m,i as T,U as se,w as A,L as P,aa as O,E as Y,e as oe,c as F,t as C,k as S,q as R,F as ae,aH as te}from"./index-BwcPjnJP.js";import{u as B,A as j}from"./useAdminStore-uEuTRxx5.js";import{s as q}from"./index-J_wi4mxH.js";import{a as H,A as ie}from"./user-B459fZOf.js";import"./index-DqtVKoVZ.js";import"./index-w-z7np8T.js";import"./index-C691Vja9.js";import"./index-D9kQDm6b.js";import"./index-B4dxx41c.js";import"./index-CXxu4Mjq.js";import"./index-Bqa5yC9A.js";import"./index-DH5eiR2q.js";const ne={class:"flex flex-col"},re={class:"flex flex-col"},de={class:"flex flex-col"},ue={class:"flex flex-col"},pe=D({__name:"CreateUserDialog",props:{modelValue:{type:Boolean,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(x){const p=M(x,"modelValue"),v=L(),V=B(),{loadUsers:g}=V,y=d("freemium"),n=d(""),c=d(""),f=d("student"),r=d(!1);async function i(){r.value=!0;try{const{data:o}=await se.createUser({access_type:y.value,email:n.value,password:c.value,user_type:f.value});v.add({severity:"success",summary:o.message,life:2e3}),await g(),p.value=!1}catch(o){v.add({severity:"error",summary:o.response.data.error,detail:o,life:2e3})}finally{r.value=!1}}return(o,s)=>{const U=q,b=h,w=A,E=P;return $(),I(E,{visible:p.value,"onUpdate:visible":s[5]||(s[5]=u=>p.value=u),modal:"",draggable:!1,class:"m-4 max-w-xl",header:"Create new user"},{footer:t(()=>[l(w,{label:o.$t("close"),severity:"secondary",onClick:s[4]||(s[4]=u=>p.value=!1)},null,8,["label"]),l(w,{label:o.$t("pages.teacher.create"),onClick:i,disabled:r.value,loading:r.value},null,8,["label","disabled","loading"])]),default:t(()=>[m("div",ne,[s[6]||(s[6]=m("div",{class:"font-bold text-sm mb-1"},"User type",-1)),l(U,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=u=>f.value=u),options:T(H),class:"w-full",placeholder:"Select user type"},null,8,["modelValue","options"])]),m("div",re,[s[7]||(s[7]=m("div",{class:"font-bold text-sm mb-1"},"Email",-1)),l(b,{type:"text",modelValue:n.value,"onUpdate:modelValue":s[1]||(s[1]=u=>n.value=u),class:"w-full"},null,8,["modelValue"])]),m("div",de,[s[8]||(s[8]=m("div",{class:"font-bold text-sm mb-1"},"Password",-1)),l(b,{type:"text",modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=u=>c.value=u),class:"w-full"},null,8,["modelValue"])]),m("div",ue,[s[9]||(s[9]=m("div",{class:"font-bold text-sm mb-1"},"Access type",-1)),l(U,{modelValue:y.value,"onUpdate:modelValue":s[3]||(s[3]=u=>y.value=u),options:T(ie),class:"w-full",placeholder:"Select access type"},null,8,["modelValue","options"])])]),_:1},8,["visible"])}}}),me=D({__name:"UpdateUserTypeDialog",props:O({userId:{},userType:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const p=M(x,"modelValue"),v=x,V=L(),g=B(),{loadUsers:y}=g,n=d(null);Y(()=>v.userType,r=>{n.value=r},{immediate:!0});const c=d(!1);async function f(){if(!(v.userId==null||n.value==null)){c.value=!0;try{const{data:r}=await j.updateUserRole(Number(v.userId),n.value);V.add({severity:"success",summary:r.message,life:2e3}),y(),p.value=!1}catch(r){V.add({severity:"error",summary:r.response.data.error,detail:r,life:2e3})}finally{c.value=!1}}}return(r,i)=>{const o=q,s=A,U=P;return $(),I(U,{visible:p.value,"onUpdate:visible":i[2]||(i[2]=b=>p.value=b),modal:"",draggable:!1,class:"m-4 max-w-md",header:"Change user type"},{footer:t(()=>[l(s,{label:r.$t("close"),severity:"secondary",onClick:i[1]||(i[1]=b=>p.value=!1)},null,8,["label"]),l(s,{label:r.$t("save"),onClick:f,disabled:c.value,loading:c.value},null,8,["label","disabled","loading"])]),default:t(()=>[l(o,{modelValue:n.value,"onUpdate:modelValue":i[0]||(i[0]=b=>n.value=b),options:T(H),class:"w-full",placeholder:"Select user type"},null,8,["modelValue","options"])]),_:1},8,["visible"])}}}),ce=D({__name:"UpdateVerificationDialog",props:O({userId:{},verification:{type:[Boolean,null]}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const p=M(x,"modelValue"),v=x,V=L(),g=B(),{loadUsers:y}=g,n=d(null),c=d(["verified","unverified"]);Y(()=>v.verification,i=>{n.value=i?"verified":"unverified"},{immediate:!0});const f=d(!1);async function r(){if(!(v.userId==null||n.value==null)){f.value=!0;try{const{data:i}=await j.verifyUser(n.value=="verified",Number(v.userId));V.add({severity:"success",summary:i.message,life:2e3}),y(),p.value=!1}catch(i){V.add({severity:"error",summary:i.response.data.error,detail:i,life:2e3})}finally{f.value=!1}}}return(i,o)=>{const s=q,U=A,b=P;return $(),I(b,{visible:p.value,"onUpdate:visible":o[2]||(o[2]=w=>p.value=w),modal:"",draggable:!1,class:"m-4 max-w-md",header:"Change verification"},{footer:t(()=>[l(U,{label:i.$t("close"),severity:"secondary",onClick:o[1]||(o[1]=w=>p.value=!1)},null,8,["label"]),l(U,{label:i.$t("save"),onClick:r,disabled:f.value,loading:f.value},null,8,["label","disabled","loading"])]),default:t(()=>[l(s,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=w=>n.value=w),options:c.value,class:"w-full",placeholder:"Select verification"},null,8,["modelValue","options"])]),_:1},8,["visible"])}}}),ve={class:"flex-grow min-w-0 pb-4 mb-4 bg-white rounded-md border"},fe={class:"flex items-center"},ye={class:"flex-grow text-2xl"},be={class:"w-44 overflow-scroll"},_e={class:"w-44"},Ve={class:"flex"},ge={class:"flex"},Ue={key:0,class:"w-40"},we={key:1,class:"w-40"},qe=D({__name:"UsersView",setup(x){const p=B(),{users:v,isLoading:V}=oe(p),g=d(!1),y=d(!1),n=d(!1),c=d(null),f=d(null),r=d(null),i=d(),o=d();(()=>{o.value={global:{value:null,matchMode:te.CONTAINS}}})();const U=u=>{console.log(u)},b=()=>{i.value.exportCSV()},w=(u,a)=>{y.value=!0,c.value=u,f.value=a},E=(u,a)=>{n.value=!0,c.value=u,r.value=a};return(u,a)=>{const k=A,K=ee,X=h,G=le,_=Q,N=Z,J=W;return $(),F(ae,null,[m("div",ve,[l(J,{ref_key:"dt",ref:i,filters:o.value,"onUpdate:filters":a[2]||(a[2]=e=>o.value=e),value:T(v),dataKey:"id",loading:T(V),scrollable:"",globalFilterFields:["email","id","name","user_type","access_type"],class:"rounded-md overflow-hidden w-full",paginator:"",rows:10,rowsPerPageOptions:[5,10,25]},{header:t(()=>[m("div",fe,[m("div",ye,"Users - "+C(T(v).length),1),l(k,{label:"Create user",icon:"pi pi-plus",variant:"outlined",class:"mr-2",onClick:a[0]||(a[0]=e=>g.value=!0)}),l(k,{label:"Export",icon:"pi pi-upload",severity:"info",variant:"outlined",class:"mr-2",onClick:b}),l(G,null,{default:t(()=>[l(K,null,{default:t(()=>a[6]||(a[6]=[m("i",{class:"pi pi-search"},null,-1)])),_:1}),l(X,{modelValue:o.value.global.value,"onUpdate:modelValue":a[1]||(a[1]=e=>o.value.global.value=e),placeholder:"Search"},null,8,["modelValue"])]),_:1})])]),empty:t(()=>a[7]||(a[7]=[S(" No users found. ")])),loading:t(()=>a[8]||(a[8]=[S(" Loading users data. Please wait. ")])),default:t(()=>[l(_,{field:"email",header:"Email",frozen:"",sortable:""},{body:t(({data:e})=>[m("div",be,C(e.email),1)]),_:1}),l(_,{field:"id",header:"ID",sortable:""},{body:t(({data:e})=>[S(C(e.id),1)]),_:1}),l(_,{field:"created_time",header:"Created time",sortable:""},{body:t(({data:e})=>[m("div",_e,C(e.created_time.split("T")[0]+" "+e.created_time.split(".")[0].split("T")[1]),1)]),_:1}),l(_,{field:"name",header:"Name",sortable:""},{body:t(({data:e})=>[S(C(`${e.name} ${e.surname}`),1)]),_:1}),l(_,{field:"user_type",header:"Type",sortable:""},{body:t(({data:e})=>[m("div",Ve,[l(N,{value:e.user_type,severity:"secondary"},null,8,["value"]),e.user_type!="super_admin"?($(),I(k,{key:0,icon:"pi pi-pencil",variant:"link",size:"small",onClick:z=>w(e.id,e.user_type)},null,8,["onClick"])):R("",!0)])]),_:1}),l(_,{field:"access_type",header:"Access",sortable:""},{body:t(({data:e})=>[l(N,{value:e.access_type,severity:e.access_type=="premium"?"success":"info"},null,8,["value","severity"])]),_:1}),l(_,{field:"verified",header:"Verified",sortable:""},{body:t(({data:e})=>[m("div",ge,[l(N,{value:e.verified?"verified":"unverified",severity:e.verified?"success":"warn"},null,8,["value","severity"]),e.user_type!="super_admin"?($(),I(k,{key:0,icon:"pi pi-pencil",variant:"link",size:"small",onClick:z=>E(e.id,e.verified)},null,8,["onClick"])):R("",!0)])]),_:1}),l(_,{field:"xp",header:"XP",sortable:""},{body:t(({data:e})=>[S(C(e.xp),1)]),_:1}),l(_,{field:"subscription_end",header:"Expire date",sortable:""},{body:t(({data:e})=>[e.subscription_end?($(),F("div",Ue,C(e.subscription_end.split("T")[0]+" : "+e.subscription_end.split(".")[0].split("T")[1]),1)):($(),F("div",we,"-"))]),_:1}),l(_,{exportable:!1},{body:t(e=>[l(k,{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:z=>U(e.data)},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","loading"])]),l(pe,{modelValue:g.value,"onUpdate:modelValue":a[3]||(a[3]=e=>g.value=e)},null,8,["modelValue"]),l(me,{modelValue:y.value,"onUpdate:modelValue":a[4]||(a[4]=e=>y.value=e),userId:c.value,userType:f.value},null,8,["modelValue","userId","userType"]),l(ce,{modelValue:n.value,"onUpdate:modelValue":a[5]||(a[5]=e=>n.value=e),userId:c.value,verification:r.value},null,8,["modelValue","userId","verification"])],64)}}});export{qe as default};
