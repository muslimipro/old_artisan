import{s as pe}from"./index-DaYIunwR.js";import{s as te}from"./index-BcI8EnQN.js";import{s as ve}from"./index-BnLhgIz5.js";import{d as fe,u as me,r as u,A as se,e as O,x as N,b as T,o,c as a,F as G,l as oe,h as i,z as ye,p as b,i as t,q as $,C as ne,D as E,j as l,k as ge,t as Q,T as le,v as ie,w as ae,E as Z,g as he,G as _e,H as we,I as J,K as be}from"./index-DKpYZndv.js";import{u as ee,a as xe}from"./store-BUZ5c4-q.js";import{S as ke}from"./SimulationView-Bh8FG0cK.js";import{c as $e}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-K3wU-YFT.js";import{_ as Se}from"./CodeViewer.vue_vue_type_script_setup_true_lang-DO-SEQz0.js";import{_ as Ce}from"./EditLocaleSelector.vue_vue_type_script_setup_true_lang-Ctwp7rgH.js";import{u as re}from"./useLocaleStore-BHe1PRB7.js";import{L as Le}from"./lessonApi-CpPGCm9f.js";import{P as je}from"./projectApi-DK8BDscH.js";import{m as Pe}from"./mapLessonFromDto-D3cEBYeg.js";import{m as Ue}from"./mapUnitFromDto-DVWJHO4f.js";import{U as X}from"./unitApi-kIYeR_Ml.js";import{_ as Be,a as Ie,b as Ae,c as Ee,d as ze}from"./TeacherReviseViewer.vue_vue_type_style_index_0_scoped_75f452fa_lang-Bn_O2hv3.js";import{s as Ve}from"./index-DG5KcTt3.js";import{_ as De}from"./TinkercadViewer.vue_vue_type_script_setup_true_lang-DFwl26Lj.js";import{u as ue}from"./index-C1fT2Vi_.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CdXgfwks.js";import"./index-Br5iJuVg.js";import"./index-Sv5XbjOn.js";import"./index-C_i3kvzb.js";import"./index-CQW4Wi6y.js";import"./index-OdaeILGb.js";import"./index-Dc-zD-v2.js";import"./language-DYQF8nnT.js";import"./transformUnitDtosToPages-hsgZNhAG.js";import"./index-D9s7_hLW.js";import"./index-CRjM1jwi.js";const ce=fe("project-store",()=>{const L=me(),e=u(null),y=u(!1),f=u(!1),_=u(!1),x=u(!1),c=u(0),g=u([]),w=u({}),v=u("submit"),k=u(!0),h=u(""),S=u(null),j=u(null),z=u([]),V=u([]),M=se(),K=re(),{lang:R}=O(K),P=u(void 0);async function H(n,m){try{y.value=!0,w.value={},P.value=M.userRole==="editor"?R.value:void 0;const{data:d}=await Le.getLessonById(n,m,P.value);e.value=Pe(d),e.value.studentProgress==100?v.value="revise":v.value="submit",await W()}catch(d){L.add({severity:"error",summary:d.response.data.error,life:2e3})}finally{y.value=!1}}async function W(){if(e.value)try{g.value=[];const n=[];e.value.pages.forEach(d=>{d.groups.forEach(r=>{r.units.forEach(q=>{n.push(q.id)})})});const{data:m}=await X.getUnitsByIdsandLessonId(n,e.value.id,P.value);for(const d of m)g.value.push(Ue(d)),["code","pibody"].includes(d.unit_type)&&A(d.unit_type,g.value[g.value.length-1])}catch(n){console.error("Error preloading units:",n)}}async function U(){if(e.value!=null)try{x.value=!0;for(const[n,m]of g.value.entries())if(m.unitType=="checklist"){const d=ee(h.value).code.value;for(const Y of m.data.checks){const de=await $e(h.value,d,Y.tests);w.value[Y.id]=de.correct}const{data:r}=await je.submitProject(e.value.id,{checklist:w.value}),q=r.progress;g.value[n].studentState={answer:{checklist:r.checklist}},e.value.studentProgress=q,q==100?v.value="finish":v.value="try-again"}}catch(n){console.log(n)}finally{x.value=!1}}async function B(){e.value!=null&&(v.value="submit")}async function I(){e.value!=null&&(v.value="completed")}function A(n,m){let d="";if(h.value==""||m.content.starting!=""){d=`emulator-${m.id}`;const r=m.studentState.answer.code;j.value=ee(d),j.value.setCode(r)}h.value=d??h.value,n=="pibody"&&(S.value=xe(h.value),z.value=m.data.neededModules,S.value.addNeededModules(z.value),d!=""&&(V.value=m.studentState.answer.slots))}function D(){k.value=!0}async function F(n){if(h.value=="")return;const m=Number(h.value.split("-")[1]);n.code=j.value.code,await X.saveUnitByIdandLessonId(m,e.value.id,{answer:n})}const p=N(()=>e.value?e.value.pages[c.value]??null:null),s=N({get:()=>{var n;return((n=p.value)==null?void 0:n.showPibody)??!1},set:n=>{p.value&&(p.value.showPibody=n)}}),C=N({get:()=>{var n;return((n=p.value)==null?void 0:n.showCode)??!1},set:n=>{p.value&&(p.value.showCode=n)}});return{selectedLesson:e,isLessonLoading:y,isUnitLoading:f,units:g,isGroupLoading:_,isSubmitLoading:x,projectStatus:v,emulatorID:h,neededModules:z,slots:V,showPibody:s,showCode:C,submitProject:U,tryAgain:B,finishLesson:I,loadLessonById:H,loadAllUnits:W,runCodePressed:D,saveStudentIdeState:F}}),Te={class:"flex flex-col gap-2"},Me=T({__name:"ChecklistViewer",props:{checklist:{},state:{}},setup(L){const e=L,y=N(()=>{var f;return((f=e.state.answer)==null?void 0:f.checklist)??{}});return(f,_)=>{const x=Ve;return o(),a("div",Te,[(o(!0),a(G,null,oe(e.checklist.options,c=>(o(),a("div",{key:c.id,class:"flex gap-4 items-center"},[i(x,{modelValue:y.value[c.id],"onUpdate:modelValue":g=>y.value[c.id]=g,binary:!0,onClick:_[0]||(_[0]=ye(()=>{},["stop","prevent"]))},null,8,["modelValue","onUpdate:modelValue"]),i(Be,{text:c.text},null,8,["text"])]))),128))])}}}),Re={key:1,class:"px-4 py-2"},We=T({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(L){const e=L,y=ne();function f(c){_(c)}const _=ue(c=>{x(c)},1e3,{maxWait:5e3});async function x(c){await X.saveUnitByIdandLessonId(e.unit.id,Number(y.params.id),{answer:c})}return(c,g)=>{const w=te;return o(),a("div",null,[c.loading?(o(),b(w,{key:0,class:"flex justify-center items-center w-10 h-full"})):(o(),a("div",Re,[e.unit.unitType=="article"?(o(),b(t(Ie),{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="checklist"?(o(),b(t(Me),{key:1,checklist:e.unit.content,state:e.unit.studentState},null,8,["checklist","state"])):e.unit.unitType=="options"?(o(),b(t(Ae),{key:2,"options-data":e.unit.content,state:e.unit.studentState,onSaveAnswer:f},null,8,["options-data","state"])):e.unit.unitType=="open"?(o(),b(t(Ee),{key:3,state:e.unit.studentState,onSaveAnswer:f},null,8,["state"])):e.unit.unitType=="video"?(o(),b(t(ze),{key:4,video:e.unit.content},null,8,["video"])):e.unit.unitType=="tinkercad"?(o(),b(t(De),{key:5,tinkercad:e.unit.content},null,8,["tinkercad"])):$("",!0)]))])}}}),Fe={ref:"rootEl",class:"flex flex-col gap-8"},qe=T({__name:"UnitsView",props:{units:{}},setup(L){return(e,y)=>(o(),a("div",Fe,[(o(!0),a(G,null,oe(e.units,f=>(o(),b(We,{key:f.id,unit:f},null,8,["unit"]))),128))],512))}}),Oe={key:0,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Ge={key:"try-again",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-gray-50"},Ke={class:"text-lg font-bold flex items-center gap-2"},He={key:1},Je={class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Qe={key:2},Xe={class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Ye=T({__name:"NavigationBar",setup(L){const e=ie(),y=ce(),{isSubmitLoading:f,projectStatus:_}=O(y),{submitProject:x,tryAgain:c,finishLesson:g}=y;return(w,v)=>{const k=ae;return o(),a(G,null,[t(_)=="submit"?(o(),a("div",Oe,[i(k,{label:w.$t("submit").toUpperCase(),icon:"pi pi-check","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:t(x),loading:t(f),disabled:t(f)},null,8,["label","onClick","loading","disabled"])])):$("",!0),i(le,{name:"shake",appear:""},{default:E(()=>[t(_)=="try-again"?(o(),a("div",Ge,[l("div",Ke,[v[1]||(v[1]=l("span",{class:"text-3xl"},"⚠️",-1)),ge(" "+Q(w.$t("incorrect"))+"! ",1)]),i(k,{label:w.$t("tryAgain").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:t(c)},null,8,["label","onClick"])])):$("",!0)]),_:1}),t(_)=="finish"?(o(),a("div",He,[l("div",Je,[i(k,{label:w.$t("finish").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:t(g)},null,8,["label","onClick"])])])):$("",!0),t(_)=="revise"?(o(),a("div",Qe,[l("div",Xe,[i(k,{label:w.$t("close").toUpperCase(),icon:"pi pi-sign-out","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:v[0]||(v[0]=h=>t(e).push({name:"projects2"}))},null,8,["label"])])])):$("",!0)],64)}}}),Ze=Ne(Ye,[["__scopeId","data-v-ee895426"]]),et={key:0,class:"h-screen bg-white flex flex-col items-center overflow-hidden relative"},tt={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 max-w-[1920px] mx-auto"},st={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},ot={class:"flex items-center gap-4"},nt={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},lt={class:"flex-1 overflow-y-auto mt-16 mb-24 w-full"},it={key:1,class:"flex justify-center"},at={key:2},rt={key:3,class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-[1000] border border-gray-200 flex flex-col items-center gap-4"},ut={class:"fixed bottom-0 left-0 right-0 z-50 bg-transparent shadow-md max-w-[1920px] mx-auto"},ct={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},dt={class:"relative h-full"},pt={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},vt={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},ft={class:"relative h-full"},mt={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},yt={key:0,class:"h-screen flex flex-col items-center justify-center overflow-hidden gap-10"},gt={class:"flex flex-col items-center"},ht={class:"text-4xl font-bold mb-8"},_t={class:"text-md text-gray-500"},Xt=T({__name:"ProjectPage",setup(L){const e=ne(),y=ie(),f=se(),_=re(),{lang:x}=O(_);Z(x,async(p,s)=>{p!==s&&v.value&&await M(Number(e.params.id),(e.query.route_id??"").toString())});const c=ce(),{units:g,isLessonLoading:w,selectedLesson:v,emulatorID:k,neededModules:h,slots:S,showPibody:j,showCode:z,projectStatus:V}=O(c),{loadLessonById:M,saveStudentIdeState:K}=c;function R(){y.push({name:"projects2"})}Z(S,()=>{P({slots:S.value})});const P=ue(p=>{K(p)},1e3,{maxWait:5e3});function H(p){P({slots:S.value})}const W=()=>{const p=e.path.replace("/project/","/lesson/");y.push(`${p}/edit`)},U=u(window.innerWidth),B=u(16),I=u(!0),A=u(!0);function D(){if(U.value=window.innerWidth,U.value<=1300){B.value=16;return}const s=452-(U.value-1024)/2;B.value=s>16?s:16}he(()=>{D(),M(Number(e.params.id),(e.query.route_id??"").toString()),window.addEventListener("resize",D)}),_e(()=>{window.removeEventListener("resize",D)});const F=N(()=>U.value<=1920?{}:"calc((-100vw + 1920px) / 2)");return(p,s)=>{const C=ae,n=ve,m=te,d=pe;return o(),a(G,null,[t(V)!="completed"?(o(),a("div",et,[l("div",tt,[l("div",st,[l("div",ot,[i(C,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:R})]),t(v)?(o(),a("div",nt,[i(n,{value:t(v).studentProgress,"show-value":!1,class:"w-full rounded-full h-3"},null,8,["value"])])):$("",!0),s[9]||(s[9]=l("div",{class:"w-10"},null,-1))])]),l("div",lt,[l("div",{class:"w-full h-full max-w-screen-lg mx-auto py-8",style:we({paddingLeft:B.value+"px",paddingRight:B.value+"px"})},[t(w)?(o(),b(m,{key:0,class:"flex justify-center"})):t(v)?(o(),a("div",at,[i(qe,{units:t(g)},null,8,["units"])])):(o(),a("div",it,"No lesson found")),t(f).userRole=="editor"?(o(),a("div",rt,[i(t(Ce)),i(C,{icon:"pi pi-pencil",variant:"text",severity:"contrast",onClick:W})])):$("",!0)],4)]),l("div",ut,[i(Ze)]),t(j)?(o(),a("div",ct,[i(C,{icon:"pi pi-microchip",severity:"secondary",onClick:s[0]||(s[0]=r=>I.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),i(d,{visible:I.value,"onUpdate:visible":s[4]||(s[4]=r=>I.value=r),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${F.value}`}}},{header:E(()=>s[10]||(s[10]=[l("div",null,null,-1)])),container:E(()=>[l("div",dt,[l("div",pt,[i(C,{icon:"pi pi-chevron-left",severity:"secondary",onClick:s[1]||(s[1]=r=>I.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(o(),b(t(ke),{id:t(k),key:t(k),slots:t(S),"onUpdate:slots":s[2]||(s[2]=r=>J(S)?S.value=r:null),neededModules:t(h),"onUpdate:neededModules":s[3]||(s[3]=r=>J(h)?h.value=r:null),class:"w-full",horizontal:!1,autoPut:!0},null,8,["id","slots","neededModules"]))])]),_:1},8,["visible","pt"])])):$("",!0),t(z)?(o(),a("div",vt,[i(C,{icon:"pi pi-code",severity:"secondary",onClick:s[5]||(s[5]=r=>A.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),i(d,{visible:A.value,"onUpdate:visible":s[8]||(s[8]=r=>A.value=r),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${F.value}`}}},{header:E(()=>s[11]||(s[11]=[l("div",null,null,-1)])),container:E(()=>[l("div",ft,[l("div",mt,[i(C,{icon:"pi pi-chevron-right",severity:"secondary",onClick:s[6]||(s[6]=r=>A.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),(o(),b(be,null,[(o(),b(t(Se),{id:t(k),key:t(k),connectbuttons:t(j),"onUpdate:connectbuttons":s[7]||(s[7]=r=>J(j)?j.value=r:null),onSaveAnswer:H},null,8,["id","connectbuttons"]))],1024))])]),_:1},8,["visible","pt"])])):$("",!0)])):$("",!0),i(le,{"enter-active-class":"transition duration-500 ease-out","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-300 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:E(()=>[t(V)=="completed"?(o(),a("div",yt,[s[12]||(s[12]=l("div",{class:"text-5xl"},"⚡️",-1)),l("div",gt,[l("div",ht,Q(p.$t("goodWork")),1),l("div",_t,Q(p.$t("keepLearning")),1)]),l("div",null,[i(C,{label:p.$t("continue"),class:"rounded-full w-56 text-xl",onClick:R},null,8,["label"])])])):$("",!0)]),_:1})],64)}}});export{Xt as default};
