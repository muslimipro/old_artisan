import{s as P}from"./index-3shJJ7Ww.js";import{b as N,a as z,r as v,x as H,o as t,c as o,j as m,p as y,q as E,k as K,t as S,h as u,D as A,n as G,F as I,l as V,ay as J,w as Q,d as X,u as Y,a6 as Z,i as x,e as ee,g as te,C as se}from"./index-CrrKimau.js";import{L as ne}from"./lessonApi-Bh_eeZwv.js";import{m as oe}from"./mapLessonFromDto-CG19vVOp.js";import{u as ie,a as ae}from"./store-DDrSlhXQ.js";import{_ as F,a as re,b as le,c as ue,d as ce}from"./TeacherReviseViewer.vue_vue_type_style_index_0_scoped_b98b9a0f_lang-BnxIVwFl.js";import{s as de,a as pe}from"./index-CzVL6f0S.js";import{s as fe}from"./index-DL1ViM7W.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./mapUnitFromDto-DJ2zlrQL.js";import"./transformUnitDtosToPages-4blM3N0G.js";import"./index-M8gq5o1h.js";import"./index-D_2waQsa.js";import"./index-DgmsQzkT.js";import"./index-4_fBhWkb.js";import"./index-gprwKlQi.js";import"./index-DxuAR6go.js";import"./index-DU7DOYFv.js";import"./index-rLSFooqB.js";import"./index-Cc4fZZVN.js";import"./index-VUifxjOs.js";import"./index-Dv3PXNVO.js";import"./index-CSMgnqNq.js";import"./index-Cxw2yqN5.js";const ve={class:"rounded-2xl max-w-4xl mx-auto border border-slate-100 gap-1 flex flex-col bg-slate-100 p-4"},ye={class:"flex items-center justify-between"},he={key:0,class:"text-2xl"},_e={class:"flex gap-2 items-center"},ge={key:0,class:"flex gap-2 flex-wrap"},xe={key:1,style:{"max-width":"160px","max-height":"120px",overflow:"hidden"}},we={key:2},be={class:"flex justify-end"},Te={key:0},ke={key:1,class:"flex gap-2 flex-wrap"},$e={key:2},Ce={class:"rounded-xl overflow-clip"},De={key:3},Le={class:"rounded-xl overflow-clip"},Se={key:4},Ae={class:"rounded-xl overflow-clip",style:{"max-width":"560px","max-height":"420px"}},Ee=N({__name:"TeacherReviseViewer",props:{classData:{},unitType:{},unitContent:{}},setup(b){const{t:s}=z(),e=b,c=v(),h=v();(()=>{h.value={global:{value:null,matchMode:J.CONTAINS}}})();const r=[],k=[],l=v(0);function D(){r.push(0),k.push(s("pages.teacher.studentAnswers"));for(const n of e.classData)r.push(n.id),k.push(n.name.length>0?n.name:n.email)}D();const d=H(()=>e.classData.find(n=>n.id===r[l.value]));function $(n){var a,f;return!((a=e.unitContent)!=null&&a.options)||!((f=n.answer)!=null&&f.options)?[]:e.unitContent.options.filter(_=>n.answer.options.includes(_.id))}function p(n){return n==="completed"?"text-primary600":n==="attempted"?"text-rose400":n==="started"?"text-warning400":""}function U(){l.value=0}function W(){l.value-=1,l.value<0&&(l.value=0)}function O(){l.value+=1,l.value==r.length&&(l.value=r.length-1)}function q(n){for(let a=0;a<r.length;a++)r[a]==n&&(l.value=a)}function R(n){var a,f,_,L;for(let C=0;C<r.length;C++)if(r[C]==n){const w=e.classData.find(j=>j.id===r[C]);if(e.unitType=="options")return w;if(e.unitType=="submit-image")return((a=w.answer)==null?void 0:a.url)??"";let g="";return e.unitType=="open"&&(g=((f=w.answer)==null?void 0:f.open)??""),e.unitType=="code"&&(g=((_=w.answer)==null?void 0:_.code)??""),e.unitType=="pibody"&&(g=((L=w.answer)==null?void 0:L.code)??""),g.length>25?g.substring(0,25)+"...":g}}return(n,a)=>{var w,g,j,M;const f=Q,_=de,L=fe,C=pe;return t(),o("div",ve,[m("div",ye,[e.classData?(t(),o("div",he,[l.value!=0?(t(),y(f,{key:0,tooltip:n.$t("pages.teacher.viewAnswer"),icon:"pi pi-angle-left",outlined:"",onClick:a[0]||(a[0]=i=>U())},null,8,["tooltip"])):E("",!0),K(" "+S(k[l.value]),1)])):E("",!0),m("div",_e,[u(f,{tooltip:n.$t("pages.teacher.viewAnswer"),icon:"pi pi-angle-left",rounded:"",severity:"contrast",onClick:a[1]||(a[1]=i=>W()),disabled:l.value==0},null,8,["tooltip","disabled"]),u(f,{tooltip:n.$t("pages.teacher.viewAnswer"),icon:"pi pi-angle-right",rounded:"",severity:"contrast",onClick:a[2]||(a[2]=i=>O()),disabled:l.value==r.length-1},null,8,["tooltip","disabled"])])]),m("div",null,[r[l.value]==0?(t(),y(C,{key:0,ref_key:"dt",ref:c,filters:h.value,"onUpdate:filters":a[3]||(a[3]=i=>h.value=i),value:e.classData,dataKey:"id",globalFilterFields:["name","status"],class:"rounded-md overflow-hidden w-full",scrollable:"",scrollHeight:"400px"},{default:A(()=>[u(_,{field:"name",header:n.$t("pages.teacher.name"),sortable:""},{body:A(({data:i})=>[m("div",null,S(`${i.name.length>0?i.name:i.email}`),1)]),_:1},8,["header"]),u(_,{field:"status",header:n.$t("pages.school.status"),sortable:""},{body:A(({data:i})=>[m("div",{class:G(p(i.status))},S(`${i.status}`),3)]),_:1},8,["header"]),u(_,{header:n.$t("pages.teacher.answer"),exportable:!1,sortable:""},{body:A(({data:i})=>[e.unitType=="options"?(t(),o("div",ge,[(t(!0),o(I,null,V($(R(i.id)),B=>(t(),o("div",{key:B.id},[u(F,{text:B.text},null,8,["text"])]))),128))])):e.unitType=="submit-image"?(t(),o("div",xe,[u(L,{src:R(i.id),style:{width:"100%",height:"100%","object-fit":"contain"}},null,8,["src"])])):(t(),o("div",we,S(`${R(i.id)}`),1))]),_:1},8,["header"]),u(_,{header:"",exportable:!1,class:"text-right",headerClass:"text-right"},{body:A(({data:i})=>[m("div",be,[u(f,{tooltip:n.$t("pages.teacher.viewAnswer"),icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:B=>q(i.id)},null,8,["tooltip","onClick"])])]),_:1})]),_:1},8,["filters","value"])):(t(),o(I,{key:1},[e.unitType=="open"?(t(),o("div",Te,S(((w=d.value.answer)==null?void 0:w.open)??""),1)):e.unitType=="options"?(t(),o("div",ke,[(t(!0),o(I,null,V($(d.value),i=>(t(),o("div",{key:i.id},[u(F,{text:i.text},null,8,["text"])]))),128))])):e.unitType=="code"?(t(),o("div",$e,[m("div",Ce,[u(F,{text:` \`\`\`python
${((g=d.value.answer)==null?void 0:g.code)??""}
\`\`\` `},null,8,["text"])])])):e.unitType=="pibody"?(t(),o("div",De,[m("div",Le,[u(F,{text:` \`\`\`python
${((j=d.value.answer)==null?void 0:j.code)??""}
\`\`\` `},null,8,["text"])])])):e.unitType=="submit-image"?(t(),o("div",Se,[m("div",Ae,[u(L,{src:(M=d.value.answer)==null?void 0:M.url,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,["src"])])])):E("",!0)],64))])])}}}),je=me(Ee,[["__scopeId","data-v-b98b9a0f"]]),Fe=X("teacher-revise-store",()=>{const b=Y(),s=v(null),e=v(!1),c=v([]),h=v(null),T=v(null),r=v(!1),k=v(!1);async function l(d,$){try{e.value=!0;const{data:p}=await ne.getLessonWithClassData(d,$);s.value=oe(p),await D()}catch(p){b.add({severity:"error",summary:p.response.data.error,life:2e3})}finally{e.value=!1}}async function D(){if(s.value)try{c.value=[],s.value.pages.forEach(d=>{d.groups.forEach($=>{$.units.forEach(p=>{c.value.push(p),(p.unitType=="code"||p.unitType=="pibody")&&(r.value=!0,T.value=ie("emulatorID"),T.value.setCode("")),p.unitType=="pibody"&&(k.value=!0,h.value=ae("emulatorID"),h.value.addNeededModules([]))})})})}catch(d){console.error("Error loading units:",d)}finally{}}return{selectedLesson:s,isLessonLoading:e,units:c,showPibody:k,showCode:r,loadLessonWithClassData:l}}),Ie={key:1,class:"flex-grow px-4 py-2"},Ne=N({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(b){const s=b;let e=!1;return Z(()=>{s.unit.classData&&(s.unit.unitType=="options"&&(e=!0),s.unit.unitType=="open"&&(e=!0),s.unit.unitType=="code"&&(e=!0),s.unit.unitType=="pibody"&&(e=!0),s.unit.unitType=="checklist"&&(e=!0),s.unit.unitType=="submit-image"&&(e=!0))}),(c,h)=>{const T=P;return t(),o("div",null,[c.loading?(t(),y(T,{key:0,class:"flex justify-center items-center w-10 h-full"})):(t(),o("div",Ie,[s.unit.unitType=="article"?(t(),y(x(re),{key:0,article:s.unit.content},null,8,["article"])):s.unit.unitType=="options"?(t(),y(x(le),{key:1,"options-data":s.unit.content,state:s.unit.studentState},null,8,["options-data","state"])):s.unit.unitType=="open"?(t(),y(x(ue),{key:2,state:s.unit.studentState},null,8,["state"])):s.unit.unitType=="video"?(t(),y(x(ce),{key:3,video:s.unit.content},null,8,["video"])):E("",!0),x(e)?(t(),y(x(je),{key:4,classData:s.unit.classData,unitType:s.unit.unitType,unitContent:s.unit.content},null,8,["classData","unitType","unitContent"])):E("",!0)]))])}}}),Re={ref:"rootEl",class:"flex flex-col gap-8"},Be=N({__name:"UnitsView",props:{units:{}},setup(b){return(s,e)=>(t(),o("div",Re,[(t(!0),o(I,null,V(s.units,c=>(t(),y(Ne,{key:c.id,unit:c},null,8,["unit"]))),128))],512))}}),Ve={class:"h-full flex flex-col overflow-y-auto relative bg-white"},Me={class:"w-full max-w-screen-lg mx-auto py-8"},Pe={key:1,class:"flex justify-center"},Ue={key:2},pt=N({__name:"TeacherRevisePage",setup(b){const s=se(),e=Fe(),{units:c,isLessonLoading:h,selectedLesson:T}=ee(e),{loadLessonWithClassData:r}=e;return te(()=>{r(s.params.class_id,s.params.lesson_id)}),(k,l)=>{const D=P;return t(),o("div",Ve,[m("div",Me,[x(h)?(t(),y(D,{key:0,class:"flex justify-center"})):x(T)?(t(),o("div",Ue,[u(Be,{units:x(c)},null,8,["units"])])):(t(),o("div",Pe,"No lesson found"))])])}}});export{pt as default};
