import{T as de}from"./index-BZBs6_fA.js";import{b as E,r as z,D as I,g as U,a1 as pe,o as p,c as y,j as a,G as g,i as e,t as O,F as $,l as A,n as F,ap as ae,h as B,q,p as S,aq as re,x as j,A as Y,a2 as ce,aa as fe,ab as te,a3 as T,y as se,a4 as H,m as N,P as oe,w as he}from"./index-B13zA5hA.js";import{s as ve}from"./index-BR-BkdfI.js";import{i as ue}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-D_ezR_o-.js";import{o as xe,d as ne,m as ye,M as me,e as we,f as ge,g as be,a as X,h as _e,r as ke,j as Me,k as Pe,l as Se}from"./store-DF0l0ZzV.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as $e}from"./index-C5LSQmEr.js";const Le="/assets/pibody-CmiHEiCK.png",Ce=["width","height"],D=12,De=E({__name:"DisplayView",props:{id:{default:"default"}},setup(b){const t=b,s=z(112),x=z(160),k=z(null),v=z(null),l=z(0),r=ue(t.id);r.text.value||(r.text.value="");function i(o){const f=o.deltaY>0?1:-1;l.value+=f*D,l.value=Math.max(0,l.value);const{lines:m,visibleLines:h}=n();l.value=Math.min(m.length*D,l.value),c(m,h)}function n(){const o=[];let f=0;return v.value&&r.text.value&&(String(r.text.value).split(`
`).forEach(h=>{let w="";h.split(" ").forEach(L=>{const V=w+L+" ";v.value.measureText(V).width>s.value?(o.push(w),w=L+" "):w=V}),o.push(w)}),f=Math.ceil(x.value/D)),{lines:o,visibleLines:f}}function c(o,f){if(v.value){v.value.fillStyle="#FFFFFF",v.value.fillRect(0,0,s.value,x.value),v.value.fillStyle=String(r.textColor.value)||"#000000",v.value.font="12px Monaco";const m=Math.floor(l.value/D);for(let h=0;h<f;h++){const w=m+h;if(w<o.length){const _=(h+1)*D-l.value%D;v.value.fillText(o[w],0,_)}}}}return I([r.text,r.textColor],()=>{const{lines:o,visibleLines:f}=n();l.value=Math.max(0,(o.length-f)*D),c(o,f)}),U(async()=>{if(await pe(),!!k.value&&(v.value=k.value.getContext("2d"),v.value)){v.value.fillStyle="#FFFFFF",v.value.fillRect(0,0,s.value,x.value);const{lines:o,visibleLines:f}=n();l.value=0,c(o,f)}}),(o,f)=>(p(),y("div",{class:"display-container",onWheel:i},[a("canvas",{ref_key:"canvas",ref:k,width:s.value,height:x.value,style:{border:"1px solid black",width:"112px",height:"160px"}},null,8,Ce)],32))}}),Fe=G(De,[["__scopeId","data-v-0149e8f3"]]),le=E({__name:"PinInfo",props:{pin:{},withPin:{},isLeft:{type:Boolean}},setup(b){return(t,s)=>(p(),y($,null,[a("div",{class:F(["flex",t.isLeft?"flex-row":"flex-row-reverse"])},[a("div",{style:g({background:e(xe)}),class:"text-center font-mono px-1 mr-1"},O(e(ne)[t.pin.id].name),5),(p(!0),y($,null,A(e(ne)[t.pin.id].able,x=>(p(),y("div",{style:g({background:x.color}),class:"text-center font-mono px-1 mr-1"},O(x.name),5))),256))],2),a("div",{class:F(["flex my-1 mb-3",t.isLeft?"flex-row":"flex-row-reverse"])},[a("div",{style:g({background:`${e(ye)[t.pin.mode]}`}),class:"text-center px-4 mr-1 rounded-lg"},O(e(me)[t.pin.mode]),5),a("div",{style:g(e(we)(t.pin,t.withPin)),class:"text-center px-4 mr-1 rounded-lg bg-black"},O(e(ge)(t.pin,t.withPin)),5)],2)],64))}}),Ie=["id"],Ee=E({__name:"SlotView",props:{slot:{},index:{},id:{}},setup(b){const{isOutside:t}=be(ae("theref")),s=X(b.id),{maxAreaIndex:x,fromSlotIndex:k,settings:v}=s,l=b.index<3;return(r,i)=>{var n;return p(),y($,null,[a("div",{id:`slot-${r.slot.id}`,ref:"theref",class:F(["absolute w-20 h-20 rounded-lg text-center",[{"bg-green-200/[0.5]":e(x)==r.index,"bg-blue-200/[0.5]":e(k)==r.index},r.slot.class]]),style:g([r.slot.style,e(_e)(r.slot)])},[!e(t)&&((n=e(v))!=null&&n.showPinInfo)?(p(),y("div",{key:0,class:"absolute w-fit whitespace-nowrap text-white flex flex-col text-xs bg-black/70",style:g(l?"left:100%":"right:100%")},[B(le,{pin:r.slot.pin2,withPin:r.slot.with.pin2,isLeft:l},null,8,["pin","withPin"]),B(le,{pin:r.slot.pin3,withPin:r.slot.with.pin3,isLeft:l},null,8,["pin","withPin"])],4)):q("",!0)],14,Ie),e(t)?q("",!0):(p(),S(re,{key:0,to:`#pibody-${r.id}`},null,8,["to"]))],64)}}}),ze=["width","height"],Te=["points","stroke"],R=3,ie=14,W=10,Ae=E({__name:"Connector",props:{start:{},end:{},style:{},id:{}},setup(b){const t=b,s=X(t.id),x=j(()=>{const{start:i,end:n}=t,c=40,o=[{x:i.x,y:i.y}];return o.push({x:i.x,y:i.y-c}),o.push({x:(n.x+i.x)/2,y:i.y-c}),o.push({x:(n.x+i.x)/2,y:n.y-n.yOffset}),o.push({x:n.x,y:n.y-n.yOffset}),o.push({x:n.x,y:n.y}),o}),k=[{color:"orange",offset:-R,end:-ie/2},{color:"red",offset:0,end:0},{color:"saddlebrown",offset:R,end:ie/2}],v=j(()=>{const i=x.value,n=[];return k.forEach(c=>{const o=c.offset,f=c.end;let m="";for(let _=0;_<i.length-2;_++){const L=i[_];m+=`${L.x-l.value.x-o},${L.y-l.value.y-o} `}const h=i[i.length-2];m+=`${h.x-l.value.x+o},${h.y-l.value.y-o} `;const w=i[i.length-1];m+=`${w.x-l.value.x+f},${w.y-l.value.y+3} `,n.push({color:c.color,points:m})}),n}),l=j(()=>{const i=[],n=[];for(const h of x.value)i.push(h.x),n.push(h.y);const c=Math.min(...i)-W,o=Math.min(...n)-W,f=Math.max(...i)+W,m=Math.max(...n)+W;return{x:c,y:o,w:f-c,h:m-o}}),r=i=>{t.end.at!==s.pinNone&&s.moveConnectorEnd(t,i)};return(i,n)=>(p(),y($,null,[a("div",{class:"absolute bg-black cursor-move",style:g([t.style,{left:t.end.x-12+"px",top:t.end.y+"px",width:t.end.w+"px",height:t.end.h+"px"}]),onPointerdown:[n[0]||(n[0]=Y(c=>c.preventDefault(),["prevent"])),r]},null,36),a("div",{class:"absolute pointer-events-none",style:g([t.style,e(ke)(l.value)])},[(p(),y("svg",{xmlns:"http://www.w3.org/2000/svg",width:l.value.w,height:l.value.h},[(p(!0),y($,null,A(v.value,(c,o)=>(p(),y("polyline",{key:o,points:c.points,stroke:c.color,fill:"none","stroke-width":R,"stroke-linejoin":"round","stroke-linecap":"round"},null,8,Te))),128))],8,ze))],4)],64))}}),Be=G(Ae,[["__scopeId","data-v-9a0ab2fc"]]),Ve=E({__name:"Canvas",setup(b){const t=ae("canvasEl");return U(async()=>{t.value&&(await Me(t.value),requestAnimationFrame(Pe))}),ce(()=>{t.value&&Se(t.value)}),(s,x)=>(p(),y("canvas",{ref_key:"canvasEl",ref:t},null,512))}}),Oe=["id"],We=["id"],je={class:"absolute top-[22px] right-[7px] flex flex-col gap-1"},He=["id"],Ne={class:"max-h-fit w-full overflow-auto flex flex-wrap gap-2 justify-center items-start mt-2",style:{"touch-action":"none",padding:"15px 0 15px 0"}},Re=E({__name:"SimulationView",props:fe({id:{},horizontal:{type:Boolean}},{neededModules:{default:[]},neededModulesModifiers:{},slots:{default:[]},slotsModifiers:{}}),emits:["update:neededModules","update:slots"],setup(b){const t=b,s=X(t.id,t.horizontal),{toDelete:x,slots:k,modules:v,isConnect8or9:l,chosenPin8or9:r,pin8:i,pin9:n,settings:c,clearSlotsModulesClasses:o,modulesWerePut:f,lightUp:m}=s,h=te(b,"neededModules"),w=te(b,"slots");U(()=>{s.putModuleList(w.value)});function _(P){if(f.value=!0,!(!h.value||h.value.length===0)){o();for(const u of h.value){if(!u.slot||!u.module)continue;if(s.getSlotPinWith(u.slot).type!==u.module){m(u.slot,u.module),f.value=!1;break}}}}const L=$e(()=>{w.value=s.slotHasList()},100);I([s.slotHasList],()=>{L()});for(const P of s.slots)I(()=>P.with.type,()=>{_()},{immediate:!0});I(()=>s.pin8.with.type,()=>{_(s.pin8)},{immediate:!0}),I(()=>s.pin9.with.type,()=>{_(s.pin9)},{immediate:!0}),I(h,()=>{for(const P of s.slots)_()});function V(){ue(t.id).clearDisplay(),s.reset()}return(P,u)=>{var Z,ee;const K=ve,J=he,Q=de;return p(),y("div",{id:`emulator-${t.id}`,key:`emulator-${t.id}`,class:F({"h-[450px] flex flex-row":P.horizontal,"h-full flex flex-col":!P.horizontal,"parent relative items-stretch overflow-hidden select-none border-l":!0})},[a("div",{id:`pibody-${t.id}`,class:"relative h-[450px] flex-shrink-0 overflow-x-hidden overflow-y-auto w-[450px]"},[B(K,{src:e(Le),width:"384px",draggable:"false",class:"absolute pt-4 min-w-[384px]",style:{left:"32px",top:"0px"}},null,8,["src"]),B(Fe,{class:"absolute top-[217px] left-[168px] w-[112px] h-[160px]",id:`${t.id}`},null,8,["id"]),a("div",je,[T((p(),S(J,{severity:(Z=e(c))!=null&&Z.showPinInfo?void 0:"secondary",class:"w-5 h-7",onClick:u[0]||(u[0]=d=>{var M;return e(s).setSettings({showPinInfo:!((M=e(c))!=null&&M.showPinInfo)})})},{default:se(()=>u[3]||(u[3]=[a("span",{class:"material-icons",style:{"font-size":"18px"}},"question_mark",-1)])),_:1},8,["severity"])),[[Q,`Pin Information: ${(ee=e(c))!=null&&ee.showPinInfo?"On":"Off"}`,void 0,{left:!0}]]),T((p(),S(J,{severity:"secondary",class:"w-5 h-7",onClick:V},{default:se(()=>u[4]||(u[4]=[a("span",{class:"material-icons",style:{"font-size":"20px"}},"restart_alt",-1)])),_:1})),[[Q,"Reset pibody",void 0,{left:!0}]])]),(p(!0),y($,null,A(e(k),(d,M)=>(p(),S(Ee,{key:M,slot:d,index:M,id:t.id},null,8,["slot","index","id"]))),128)),a("div",{class:"absolute bg-black",style:g({left:e(s).usb.x+"px",top:e(s).usb.y-70+"px",width:e(s).usb.w+"px",height:e(s).usb.h+50+"px"})},null,4),a("div",{class:"absolute",style:g({left:e(s).onLED.x+"px",top:e(s).onLED.y+"px",width:e(s).onLED.w+"px",height:e(s).onLED.h+"px"})},null,4),T(a("div",{class:"absolute flex items-center justify-center animate-bounce-up z-10 pointer-events-none",style:g({left:e(s).helpArrows[8].x+"px",top:e(s).helpArrows[8].y+"px"})},[a("span",{class:F(["icon-arrow-down text-5xl",[e(r)===e(i)?"text-green-500":"text-gray-500",e(s).helpArrows[8].class]]),style:g(e(s).helpArrows[8].style)},null,6),u[5]||(u[5]=a("span",{class:"absolute text-white font-bold -mt-2"},"8",-1))],4),[[H,e(s).helpArrows[8].visible||e(l)]]),T(a("div",{class:"absolute flex items-center justify-center animate-bounce-down z-10 pointer-events-none",style:g({left:e(n).x-10+"px",top:e(n).y+8+"px"})},[a("span",{class:F(["icon-arrow-up text-5xl",e(r)===e(n)?"text-green-500":"text-gray-500"]),style:g(e(s).helpArrows[9].style)},null,6),u[6]||(u[6]=a("span",{class:"absolute text-white font-bold -mt-2"},"9",-1))],4),[[H,e(s).helpArrows[9].visible||e(l)]]),B(Ve,{class:"absolute top-0 left-0 z-10 w-full h-full pointer-events-none",id:t.id},null,8,["id"])],8,We),a("div",{id:`module-list-${t.id}`,class:"relative h-full flex-1 overflow-auto overflow-x-hidden w-[450px]"},[a("div",Ne,[(p(!0),y($,null,A(e(s).neededModules.value,(d,M)=>(p(),S(oe(d.is),N({key:M,class:d.class,style:d.style,ref_for:!0},d,{onPointerdown:[C=>e(s).startDragFromModuleList(d,C),u[1]||(u[1]=Y(C=>C.preventDefault(),["prevent"]))],class:"flex-none w-20 h-20 cursor-move"}),null,16,["class","style","onPointerdown"]))),128)),T(a("div",{class:F(["absolute top-0 left-0 h-full w-full",{"bg-red-500/[0.8]":e(x)}])},u[7]||(u[7]=[a("div",{class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},[a("span",{class:"material-icons",style:{"font-size":"100px"}},"delete")],-1)]),2),[[H,e(x)]])])],8,He),(p(!0),y($,null,A(e(v),(d,M)=>(p(),S(re,{defer:"",to:d.dragging?`#emulator-${t.id}`:`#pibody-${t.id}`,key:d.id},[d.putOn8or9&&d.connector.end.x!==0&&d.connector.end.y!==0?(p(),S(Be,N({key:0,ref_for:!0},d.connector,{id:t.id}),null,16,["id"])):q("",!0),(p(),S(oe(d.is),N({class:d.class,style:[d.style,{left:d.x+"px",top:d.y+"px"}],ref_for:!0},d,{onPointerdown:[C=>e(s).startDragFromSlot(d,M,d.on,C),u[2]||(u[2]=Y(C=>C.preventDefault(),["prevent"]))],class:"absolute w-20 h-20 rounded-xl cursor-move",style:{"touch-action":"none"}}),null,16,["class","style","onPointerdown"]))],8,["to"]))),128))],10,Oe)}}}),Qe=G(Re,[["__scopeId","data-v-e29899fb"]]);export{Qe as S};
