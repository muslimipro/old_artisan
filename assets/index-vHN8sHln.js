import{T as Pe}from"./index-iH93vrIG.js";import{s as Xe}from"./index-BUUMVtlF.js";import{s as Ee}from"./index-SQHY2uKR.js";import{s as Ze}from"./index-BH7KoxWs.js";import{b as Z,a as et,u as ze,r as m,x as D,o as n,c,j as u,t as O,z as tt,q as B,n as st,F as X,l as pe,h as y,d as nt,A as Le,e as le,p as z,i as s,C as De,E as ie,g as je,a3 as Ge,y as Re,D as G,H as $e,a2 as ot,w as Te,k as _e,T as Se,G as at,I as oe,K as lt,v as it}from"./index-AClBedbW.js";import{u as xe,a as Ie}from"./store-CuP_bTmS.js";import{S as rt}from"./SimulationView-B9q2BW-z.js";import{e as Ue,c as ut}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-B0HC6MwN.js";import{_ as ct}from"./CodeViewer.vue_vue_type_script_setup_true_lang-CsU6Lh9z.js";import{_ as dt}from"./EditLocaleSelector.vue_vue_type_script_setup_true_lang-DjtjONGU.js";import{u as Me}from"./useLocaleStore-DNnxkFzn.js";import{L as pt}from"./lessonApi-BK3b3cyR.js";import{m as vt}from"./mapLessonFromDto-D3cEBYeg.js";import{m as ft}from"./mapUnitFromDto-DVWJHO4f.js";import{U as ae}from"./unitApi-CuH6rd-Q.js";import{_ as ke,a as gt,b as ht,c as mt,d as yt}from"./TeacherReviseViewer.vue_vue_type_style_index_0_scoped_75f452fa_lang-B6CH6IaK.js";import{_ as wt}from"./TinkercadViewer.vue_vue_type_script_setup_true_lang-B7svmfut.js";import{u as Ve}from"./index-q1Nz5cPo.js";import{_ as bt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DDx-e1KX.js";import"./index-D9lDRhj3.js";import"./index-CKslPvHa.js";import"./index-EYPUebmY.js";import"./index-BqfOP99U.js";import"./index-XWd1g6Xq.js";import"./language-DYQF8nnT.js";import"./transformUnitDtosToPages-hsgZNhAG.js";import"./index-NBixiio1.js";import"./index-CRBI1kF9.js";import"./index-r2exBSIy.js";const _t={class:"border border-purple-200 rounded-xl bg-gradient-to-r from-purple-50 to-pink-50"},xt={class:"flex items-center gap-3"},kt={class:"font-semibold text-purple-900"},Ct={class:"flex items-center gap-2"},$t=["title"],St={key:0,class:"px-4 pb-4"},Et={key:0},Lt={class:"rounded-xl overflow-clip p-4 bg-white border border-purple-100 shadow-sm"},Tt={key:1,class:"flex gap-2 flex-wrap"},At={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Bt={key:2},It={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Ut={key:3},Pt={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},zt=Z({__name:"TeacherAnswerViewer",props:{unitType:{},unitContent:{}},setup(E){const e=E,{t:p}=et(),h=ze(),a=m(!1),$=()=>{a.value=!a.value},x=async()=>{try{let o="";e.unitType==="open"?o=e.unitContent.answer:e.unitType==="options"?o=I.value.map(l=>l.text).join(`
`):(e.unitType==="code"||e.unitType==="pibody")&&(o=e.unitContent.answer),await navigator.clipboard.writeText(o),h.add({severity:"success",summary:p("pages.teacher.answerCopied"),detail:p("pages.teacher.answerCopiedDetail"),life:2e3})}catch(o){console.log(o),h.add({severity:"error",summary:p("pages.teacher.copyError"),detail:p("pages.teacher.copyErrorDetail"),life:2e3})}},I=D(()=>{var o;return!((o=e.unitContent)!=null&&o.options)||!e.unitContent.answer?[]:e.unitContent.options.filter(l=>e.unitContent.answer.includes(l.id))});return(o,l)=>(n(),c("div",_t,[u("div",{onClick:$,class:"flex items-center justify-between cursor-pointer hover:bg-purple-100/50 p-4 rounded-xl transition-all duration-200"},[u("div",xt,[l[0]||(l[0]=u("div",{class:"flex items-center justify-center w-6 h-6 text-purple-500"},[u("i",{class:"pi pi-crown","aria-hidden":"true"})],-1)),u("span",kt,O(a.value?o.$t("pages.teacher.hideAnswer"):o.$t("pages.teacher.showAnswer")),1)]),u("div",Ct,[a.value?(n(),c("button",{key:0,onClick:tt(x,["stop"]),class:"flex items-center justify-center w-8 h-8 text-purple-600 hover:bg-purple-200 rounded-lg transition-colors",title:o.$t("pages.teacher.copyAnswer")},l[1]||(l[1]=[u("i",{class:"pi pi-copy","aria-hidden":"true"},null,-1)]),8,$t)):B("",!0),(n(),c("svg",{class:st(["w-5 h-5 transition-transform duration-200 text-purple-600",{"rotate-180":a.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},l[2]||(l[2]=[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))])]),a.value?(n(),c("div",St,[e.unitType=="open"?(n(),c("div",Et,[u("div",Lt,O(e.unitContent.answer),1)])):e.unitType=="options"?(n(),c("div",Tt,[u("div",At,[(n(!0),c(X,null,pe(I.value,r=>(n(),c("div",{key:r.id},[y(ke,{text:r.text},null,8,["text"])]))),128))])])):e.unitType=="code"?(n(),c("div",Bt,[u("div",It,[y(ke,{text:` \`\`\`python
${e.unitContent.answer}
\`\`\` `},null,8,["text"])])])):e.unitType=="pibody"?(n(),c("div",Ut,[u("div",Pt,[y(ke,{text:` \`\`\`python
${e.unitContent.answer}
\`\`\` `},null,8,["text"])])])):B("",!0)])):B("",!0)]))}});async function Ce(E){if(E=="")return"";const p=new TextEncoder().encode(E),h=await crypto.subtle.digest("SHA-256",p);return Array.from(new Uint8Array(h)).map(x=>x.toString(16).padStart(2,"0")).join("")}function Dt(E){let e="",p=!1;for(let h=0;h<E.length;h++){const a=E[h];if(a==="#"&&(p=!0),p)if(a===`
`)p=!1;else continue;a!==" "&&a!=="	"&&a!==`
`&&a!=="\r"&&(e+=a)}return e}function jt(E,e){if(E.length!==e.length)return!1;const p=[...E].sort(),h=[...e].sort();return p.every((a,$)=>a===h[$])}const ve=nt("lesson-store",()=>{const E=ze(),e=m(null),p=m(!1),h=m(!1),a=m(!1),$=m(!1),x=m(!1),I=m(0),o=m(0),l=m([]),r=m(0),k=m(new Map),_=m(new Map),g=m([]),d=m("continue"),T=m(!1),b=m(!1),L=m(!1),R=m(!0),ee=m(!1),U=m(""),V=m(0),j=m(null),F=m(null),te=m([]),K=m([]),fe=Le(),ge=Me(),{lang:re}=le(ge),q=m(void 0),he=D(()=>{var t;return L.value&&(((t=j.value)==null?void 0:t.modulesWerePut)??!0)&&R.value});async function Y(t,v){try{p.value=!0,k.value.clear(),_.value.clear(),q.value=fe.userRole==="editor"?re.value:void 0;const{data:f}=await pt.getLessonById(t,v,q.value);e.value=vt(f),e.value.stage=="published"&&H()}catch(f){E.add({severity:"error",summary:f.response.data.error,life:2e3})}finally{p.value=!1}}async function H(){if(e.value)try{x.value=!0,I.value=0,k.value.clear();const t=[];e.value.pages.forEach(w=>{w.groups.forEach(S=>{S.units.forEach(ne=>{t.push({id:ne.id,lessonId:e.value.id})})})});const v=t.length,f=5;for(let w=0;w<t.length;w+=f){const ne=t.slice(w,w+f).map(async({id:we,lessonId:Qe})=>{try{const{data:be}=await ae.getUnitByIdandLessonId(we,Qe,q.value);k.value.set(we,be)}catch(be){console.warn(`Failed to preload unit ${we}:`,be)}});await Promise.all(ne),I.value=Math.round(Math.min(w+f,v)/v*100)}}catch(t){console.error("Error preloading units:",t)}finally{x.value=!1}}async function J(t,v){if(k.value.has(t))return k.value.get(t);try{h.value=!0;const{data:f}=await ae.getUnitByIdandLessonId(t,v,q.value);return k.value.set(t,f),f}catch(f){E.add({severity:"error",summary:f.response.data.error,life:2e3})}finally{h.value=!1}}async function se(){if(e.value!=null){a.value=!0,l.value=[],o.value=0,r.value=0,g.value=[],U.value="",K.value=[],b.value=!1;for(let t=0;t<e.value.pages.length;t++)g.value.push(0);d.value="continue",ce(),l.value.push(e.value.pages[o.value].groups[r.value]),await i(e.value.id),a.value=!1}}function me(t,v){var w;V.value=v.id,U.value==""&&(U.value=`emulator-${V.value}`);const f=v.content.starting;ee.value=f!="",F.value=xe(U.value),F.value.setCode(f),t=="pibody"&&(j.value=Ie(U.value),(w=j.value)==null||w.clearSlots(),te.value=v.data.neededModules,j.value.addNeededModules(te.value),K.value=[])}function ue(){var w;if(U.value=="")return;Ue.getSharedEmulator().stop();const v=l.value[r.value].units.find(S=>S.id===V.value),f=(v==null?void 0:v.content.starting)??"";f!=""&&(F.value=xe(U.value),F.value.setCode(f),(v==null?void 0:v.unitType)=="pibody"&&(j.value=Ie(U.value),(w=j.value)==null||w.clearSlots(),K.value=[]))}function C(){if(U.value=="")return;Ue.getSharedEmulator().stop()}async function i(t){L.value=!1,T.value=!1,ee.value=!1;for(let v=0;v<l.value[r.value].units.length;v++){const f=l.value[r.value].units[v];["options","open","code","pibody"].includes(f.unitType)&&(d.value="check",T.value=!0);const w=await J(f.id,t);if(w){const S=ft(w);l.value[r.value].units[v].content=S==null?void 0:S.content,l.value[r.value].units[v].data=S==null?void 0:S.data,l.value[r.value].units[v].studentState=S==null?void 0:S.studentState,["code","pibody"].includes(f.unitType)&&(L.value=!0,S.content.answer==""&&S.data.tests.lenght==0||(R.value=!1),me(f.unitType,S))}}d.value=="continue"&&await P()}async function P(){if(e.value!=null)try{$.value=!0,b.value=!1;for(const t of l.value[l.value.length-1].units){if(_.value.set(t.id,t.studentState.answer),["code","pibody"].includes(t.unitType)){const v=xe(U.value).code.value;if(t.data.tests.length>0){const f=await ut(U.value,v,t.data.tests,t.data.includedCommands);b.value=f.correct}else if(!t.content.hashed_answer)b.value=!0;else{const f=Dt(v),w=await Ce(f);b.value=t.content.hashed_answer===w}}else if(t.unitType=="open"){const f=String(t.studentState.answer.open??"").replace(/ /g,"").toLowerCase(),w=await Ce(f);b.value=!t.content.hashed_answer||t.content.hashed_answer===w}else if(t.unitType=="options"){const v=t.studentState.answer.options,f=[];for(const w of v)f.push(await Ce(w));b.value=t.content.hashed_answer.length==0||jt(t.content.hashed_answer,f)}else b.value=!0;if(b.value==!1)break}l.value[l.value.length-1].units.length||(b.value=!0),b.value?(g.value[o.value]++,r.value>=e.value.pages[o.value].groups.length-1?o.value<e.value.pages.length-1?d.value="continue":d.value="finish":d.value="continue"):d.value="try-again"}finally{$.value=!1}}async function N(){if(e.value!=null){if(C(),r.value>=e.value.pages[o.value].groups.length-1){await Be(),Ae();return}a.value=!0,r.value++,l.value.push(e.value.pages[o.value].groups[r.value]),await i(e.value.id),a.value=!1}}async function W(t){const v=l.value[l.value.length-1].id;d.value="continue",g.value[o.value]--,r.value--,l.value.pop(),v==t?o.value==0&&l.value.length==0?await se():await N():await W(t)}function ce(){if(!e.value)return;let t=0;for(const v of e.value.pages)if(v.groups.every(w=>w.units.every(S=>S.studentStatus==="completed")))t!=e.value.pages.length-1&&(g.value[t]=v.groups.length,t++);else break;o.value=t}function ye(){o.value!=0&&(g.value[o.value]=0,g.value[o.value-1]=0,o.value-=2,Ae())}function A(t,v){if(e.value!=null){for(const[f,w]of l.value.entries())for(const[S,ne]of w.units.entries())if(ne.id==t){l.value[f].units[S].studentState.answer=v;break}}}async function de(){e.value!=null&&(d.value="check")}async function Fe(){e.value!=null&&(await Be(),d.value="completed")}function qe(){k.value.clear(),I.value=0,x.value=!1}async function Ae(){e.value!=null&&(a.value=!0,o.value++,l.value=[],r.value=0,d.value="continue",l.value.push(e.value.pages[o.value].groups[r.value]),await i(e.value.id),a.value=!1)}function He(t){L.value=t}function Ne(){R.value=!0}async function We(t){U.value!=""&&(t.code=F.value.code,A(V.value,t),await ae.saveUnitByIdandLessonId(V.value,e.value.id,{answer:t}))}async function Be(){if(a.value=!0,e.value==null)return;const t=Array.from(_.value.entries()).map(([f,w])=>({id:f,student_answer:w})),{data:v}=await ae.submitUnitsByLessonId(e.value.id,t);b.value=v.correct,_.value=new Map,a.value=!1}const M=D(()=>e.value?e.value.pages[o.value]??null:null),Q=D(()=>M.value?M.value.groups[r.value]??null:null),Oe=D({get:()=>{var t;return((t=Q.value)==null?void 0:t.pibodyDrawerVisible)??!1},set:t=>{Q.value&&(Q.value.pibodyDrawerVisible=t)}}),Ke=D({get:()=>{var t;return((t=Q.value)==null?void 0:t.codeDrawerVisible)??!1},set:t=>{Q.value&&(Q.value.codeDrawerVisible=t)}}),Ye=D({get:()=>{var t;return((t=M.value)==null?void 0:t.showPibody)??!1},set:t=>{M.value&&(M.value.showPibody=t)}}),Je=D({get:()=>{var t;return((t=M.value)==null?void 0:t.showCode)??!1},set:t=>{M.value&&(M.value.showCode=t)}});return{selectedLesson:e,isLessonLoading:p,isUnitLoading:h,groups:l,groupIndex:r,isGroupLoading:a,isSubmitLoading:$,isPreloadingUnits:x,preloadingProgress:I,groupStatus:d,submitExist:T,correct:b,submitEnabled:he,pageProgress:g,emulatorID:U,neededModules:te,slots:K,pibodyDrawerVisible:Oe,codeDrawerVisible:Ke,showPibody:Ye,showCode:Je,answersCache:_,startingCodeExist:ee,setSubmitable:He,loadLessonById:Y,loadUnitByIdandLessonId:J,preloadAllUnits:H,clearUnitsCache:qe,loadInitialGroup:se,submitGroup:P,nextGroup:N,saveAnswer:A,tryAgain:de,finishLesson:Fe,runCodePressed:Ne,saveStudentIdeState:We,resetGroup:W,pageBack:ye,resetEmulator:ue}}),Gt={key:1,class:"px-4 py-2"},Rt=Z({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(E){const e=E,p=De(),h=ve(),{saveAnswer:a,setSubmitable:$}=h;function x(r){e.unit.unitType=="options"?$(r.options.length>0):e.unit.unitType=="open"&&$(r.open.length>0),a(e.unit.id,r),I(r)}const I=Ve(r=>{o(r)},1e3,{maxWait:5e3});async function o(r){await ae.saveUnitByIdandLessonId(e.unit.id,Number(p.params.id),{answer:r})}const l=D(()=>{var r;return(r=e.unit.content)!=null&&r.answer?Array.isArray(e.unit.content.answer)?e.unit.content.answer.length>0:typeof e.unit.content.answer=="string"?e.unit.content.answer.trim()!=="":!0:!1});return(r,k)=>{const _=Ee;return n(),c("div",null,[r.loading?(n(),z(_,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),c("div",Gt,[e.unit.unitType=="article"?(n(),z(s(gt),{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="options"?(n(),z(s(ht),{key:1,"options-data":e.unit.content,state:e.unit.studentState,onSaveAnswer:x},null,8,["options-data","state"])):e.unit.unitType=="open"?(n(),z(s(mt),{key:2,state:e.unit.studentState,onSaveAnswer:x},null,8,["state"])):e.unit.unitType=="video"?(n(),z(s(yt),{key:3,video:e.unit.content},null,8,["video"])):e.unit.unitType=="tinkercad"?(n(),z(s(wt),{key:4,tinkercad:e.unit.content},null,8,["tinkercad"])):B("",!0),l.value?(n(),z(s(zt),{key:5,unitType:e.unit.unitType,unitContent:e.unit.content},null,8,["unitType","unitContent"])):B("",!0)]))])}}}),Mt={key:1,class:"flex flex-col h-full w-full"},Vt={class:"flex-grow flex flex-col gap-4 px-4 py-2"},Ft=Z({__name:"GroupCard",props:{group:{},loading:{type:Boolean}},setup(E){const e=E,p=m(null);return ie(()=>e.loading,h=>{h===!1&&p.value&&requestAnimationFrame(()=>{var a;(a=p.value)==null||a.scrollIntoView({behavior:"smooth",block:"start"})})}),(h,a)=>{const $=Ee;return n(),c("div",{ref_key:"groupRef",ref:p},[h.loading?(n(),z($,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),c("div",Mt,[u("div",Vt,[(n(!0),c(X,null,pe(h.group.units,x=>(n(),z(Rt,{key:x.id,unit:x},null,8,["unit"]))),128))])]))],512)}}}),qt={key:0,class:"absolute right-0"},Ht=Z({__name:"UnitsView",props:{pages:{}},setup(E){const e=ve(),{groups:p,isGroupLoading:h}=le(e),{loadInitialGroup:a,resetGroup:$}=e,x=Le(),I=m(null),o=m(null),l=m(0);function r(g){let d=g;for(;d&&d.parentElement;){const T=d.parentElement,L=getComputedStyle(T).overflowY;if(L==="auto"||L==="scroll")return T;d=T}return null}async function k(){await ot();const g=r(I.value),d=o.value;if(!g||!d){l.value=0;return}const T=g.clientHeight,b=d.getBoundingClientRect().height,L=Math.max(0,T-b-16);l.value=L}function _(g,d){var L;const T=(L=p.value[p.value.length-1])==null?void 0:L.id;let b=null;g&&(g instanceof Element?b=g:g.$el instanceof Element&&(b=g.$el)),o.value=d.id===T?b:null}return je(()=>{a(),k(),window.addEventListener("resize",k)}),Ge(()=>{window.removeEventListener("resize",k)}),ie(()=>p.value.length,async()=>{await k()}),ie(()=>h.value,async(g,d)=>{d===!0&&g===!1&&await k()}),(g,d)=>{const T=Te,b=Pe;return n(),c("div",{ref_key:"rootEl",ref:I,class:"flex flex-col gap-2 pt-2"},[(n(!0),c(X,null,pe(s(p),L=>(n(),c("div",{key:L.id,ref_for:!0,ref:R=>_(R,L),class:"relative"},[!s(h)&&s(x).userRole=="editor"?(n(),c("div",qt,[Re((n(),z(T,{type:"button",class:"w-9 h-9 mr-8 mt-2",rounded:"",severity:"secondary",variant:"text",onClick:R=>s($)(L.id)},{default:G(()=>d[0]||(d[0]=[u("span",{class:"material-icons"},"restart_alt",-1)])),_:2},1032,["onClick"])),[[b,"Reset step",void 0,{left:!0}]])])):B("",!0),y(Ft,{group:L,loading:s(h)&&L.id==s(p)[s(p).length-1].id},null,8,["group","loading"])]))),128)),u("div",{style:$e({height:l.value+"px"})},null,4)],512)}}}),Nt={key:0,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Wt={key:1},Ot={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},Kt={class:"text-lg font-bold flex items-center gap-2"},Yt={key:"incorrect",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-red-100"},Jt={key:"no-submit",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Qt={key:"try-again",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-gray-50"},Xt={class:"text-lg font-bold flex items-center gap-2"},Zt={key:2},es={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},ts={class:"text-lg font-bold flex items-center gap-2"},ss={key:1,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},ns=Z({__name:"NavigationBar",setup(E){const e=ve(),{isSubmitLoading:p,groupStatus:h,isGroupLoading:a,submitExist:$,correct:x,submitEnabled:I}=le(e),{submitGroup:o,nextGroup:l,tryAgain:r,finishLesson:k}=e;return(_,g)=>{const d=Te;return n(),c(X,null,[s(h)=="check"?(n(),c("div",Nt,[y(d,{label:_.$t("check").toUpperCase(),icon:"pi pi-check","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(o),loading:s(p),disabled:s(p)||!s(I)},null,8,["label","onClick","loading","disabled"])])):B("",!0),s(h)=="continue"?(n(),c("div",Wt,[y(Se,{name:"pop",appear:"",mode:"out-in"},{default:G(()=>[s($)&&s(x)?(n(),c("div",Ot,[u("div",Kt,[g[0]||(g[0]=u("span",{class:"text-3xl"},"üéâ",-1)),_e(" "+O(_.$t("correct"))+"! ",1)]),y(d,{label:_.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(l),loading:s(a),disabled:s(a)},null,8,["label","onClick","loading","disabled"])])):s($)&&!s(x)?(n(),c("div",Yt,[y(d,{label:_.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(l),loading:s(a),disabled:s(a)},null,8,["label","onClick","loading","disabled"])])):(n(),c("div",Jt,[y(d,{label:_.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(l),loading:s(a),disabled:s(a)},null,8,["label","onClick","loading","disabled"])]))]),_:1})])):B("",!0),y(Se,{name:"shake",appear:""},{default:G(()=>[s(h)=="try-again"?(n(),c("div",Qt,[u("div",Xt,[g[1]||(g[1]=u("span",{class:"text-3xl"},"‚ö†Ô∏è",-1)),_e(" "+O(_.$t("incorrect"))+"! ",1)]),y(d,{label:_.$t("tryAgain").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(r)},null,8,["label","onClick"])])):B("",!0)]),_:1}),s(h)=="finish"?(n(),c("div",Zt,[s($)&&s(x)?(n(),c("div",es,[u("div",ts,[g[2]||(g[2]=u("span",{class:"text-3xl"},"üéâ",-1)),_e(" "+O(_.$t("correct"))+"!",1)]),y(d,{label:_.$t("finish").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(k),loading:s(a),disabled:s(a)},null,8,["label","onClick","loading","disabled"])])):(n(),c("div",ss,[y(d,{label:_.$t("finish").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(k)},null,8,["label","onClick"])]))])):B("",!0)],64)}}}),os=bt(ns,[["__scopeId","data-v-4f5f4e6c"]]),as={key:0,class:"h-screen bg-white flex flex-col items-center overflow-hidden relative"},ls={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 max-w-[1920px] mx-auto"},is={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},rs={class:"flex items-center gap-4"},us={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},cs={class:"flex-1 overflow-y-auto mt-16 mb-24 w-full"},ds={key:1,class:"flex justify-center"},ps={key:2},vs={key:3,class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-[1000] border border-gray-200 flex flex-col items-center gap-4"},fs={key:4,class:"fixed top-20 right-4 bg-white rounded-lg shadow-md z-50 border border-gray-200 p-4 min-w-64"},gs={class:"flex items-center gap-3 mb-2"},hs={class:"fixed bottom-0 left-0 right-0 z-50 bg-transparent shadow-md max-w-[1920px] mx-auto"},ms={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},ys={class:"relative h-full"},ws={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},bs={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},_s={class:"relative h-full"},xs={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},ks={key:0,class:"absolute right-0 top-0 z-10 h-[38px] p-[1px]"},Cs={key:0,class:"h-screen flex flex-col items-center justify-center overflow-hidden gap-10"},$s={class:"flex flex-col items-center"},Ss={class:"text-4xl font-bold mb-8"},Es={class:"text-md text-gray-500"},on=Z({__name:"LessonPage",setup(E){const e=De(),p=it(),h=Le(),a=Me(),{lang:$}=le(a);ie($,async(C,i)=>{C!==i&&o.value&&await j(Number(e.params.id),(e.query.route_id??"").toString())});const x=ve(),{isLessonLoading:I,selectedLesson:o,pageProgress:l,groupStatus:r,emulatorID:k,neededModules:_,slots:g,pibodyDrawerVisible:d,codeDrawerVisible:T,showPibody:b,showCode:L,isPreloadingUnits:R,preloadingProgress:ee,answersCache:U,startingCodeExist:V}=le(x),{loadLessonById:j,runCodePressed:F,saveStudentIdeState:te,pageBack:K,resetEmulator:fe}=x;function ge(C){var P;const i=((P=o.value)==null?void 0:P.pages.reduce((N,W)=>N+W.groups.length,0))||1;return C/i*100}function re(){var C;((C=o.value)==null?void 0:C.lessonType)=="module"?p.push("/v2/docs"):e.query.route_id&&e.query.route_id!=""?p.push("/v2/route/"+e.query.route_id):h.userRole=="editor"?p.push("/v2/routes"):p.push("/v2/home")}ie(g,()=>{q({slots:g.value})});const q=Ve(C=>{te(C)},1e3,{maxWait:5e3});function he(C){q({slots:g.value})}const Y=m(window.innerWidth),H=m(16);function J(){if(Y.value=window.innerWidth,Y.value<=1300){H.value=16;return}const i=452-(Y.value-1024)/2;H.value=i>16?i:16}je(async()=>{var C,i;r.value="continue",J(),await j(Number(e.params.id),(e.query.route_id??"").toString()),((C=o.value)==null?void 0:C.lessonType)=="project"&&p.push({path:e.path.replace("/lesson/","/project/"),query:e.query}),((i=o.value)==null?void 0:i.studentProgress)==100&&h.userRole!="editor"&&p.push({path:`${e.path}/revise`,query:e.query}),window.addEventListener("resize",J),window.addEventListener("beforeunload",ue)}),at(()=>{window.removeEventListener("resize",J)});const se=D(()=>Y.value<=1920?{}:"calc((-100vw + 1920px) / 2)"),me=()=>{p.push(`${e.path}/edit`)};Ge(()=>{window.removeEventListener("beforeunload",ue)});function ue(C){if(r.value!="completed"&&U.value.size>0)return C.preventDefault(),!0}return(C,i)=>{const P=Te,N=Ze,W=Ee,ce=Xe,ye=Pe;return n(),c(X,null,[s(r)!="completed"?(n(),c("div",as,[u("div",ls,[u("div",is,[u("div",rs,[y(P,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:re})]),s(o)?(n(),c("div",us,[(n(!0),c(X,null,pe(s(o).pages,(A,de)=>(n(),c("div",{key:de,class:"h-full",style:$e({width:ge(A.groups.length)+"%"})},[y(N,{value:s(l)[de]/A.groups.length*100,"show-value":!1,class:"w-full rounded-full h-3"},null,8,["value"])],4))),128))])):B("",!0),i[9]||(i[9]=u("div",{class:"w-10"},null,-1))])]),u("div",cs,[u("div",{class:"w-full h-full max-w-screen-lg mx-auto",style:$e({paddingLeft:H.value+"px",paddingRight:H.value+"px"})},[s(I)?(n(),z(W,{key:0,class:"flex justify-center"})):s(o)?(n(),c("div",ps,[y(Ht,{pages:s(o).pages},null,8,["pages"])])):(n(),c("div",ds,"No lesson found")),s(h).userRole=="editor"?(n(),c("div",vs,[y(s(dt)),y(P,{icon:"pi pi-pencil",variant:"text",severity:"contrast",onClick:me}),y(P,{variant:"text",severity:"contrast",onClick:s(K)},{default:G(()=>i[10]||(i[10]=[u("span",{class:"material-icons"},"swipe_left_alt",-1)])),_:1},8,["onClick"])])):B("",!0),s(R)?(n(),c("div",fs,[u("div",gs,[y(W,{style:{width:"20px",height:"20px"}}),i[11]||(i[11]=u("span",{class:"text-sm font-medium"},"Preloading units...",-1))]),y(N,{value:s(ee),"show-value":!0,class:"h-2"},null,8,["value"])])):B("",!0)],4)]),u("div",hs,[y(os)]),s(b)?(n(),c("div",ms,[y(P,{icon:"pi pi-microchip",severity:"secondary",onClick:i[0]||(i[0]=A=>d.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),y(ce,{visible:s(d),"onUpdate:visible":i[4]||(i[4]=A=>oe(d)?d.value=A:null),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${se.value}`}}},{header:G(()=>i[12]||(i[12]=[u("div",null,null,-1)])),container:G(()=>[u("div",ys,[u("div",ws,[y(P,{icon:"pi pi-chevron-left",severity:"secondary",onClick:i[1]||(i[1]=A=>d.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(n(),z(s(rt),{id:s(k),key:s(k),slots:s(g),"onUpdate:slots":i[2]||(i[2]=A=>oe(g)?g.value=A:null),neededModules:s(_),"onUpdate:neededModules":i[3]||(i[3]=A=>oe(_)?_.value=A:null),class:"w-full",horizontal:!1,autoPut:!0},null,8,["id","slots","neededModules"]))])]),_:1},8,["visible","pt"])])):B("",!0),s(L)?(n(),c("div",bs,[y(P,{icon:"pi pi-code",severity:"secondary",onClick:i[5]||(i[5]=A=>T.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),y(ce,{visible:s(T),"onUpdate:visible":i[8]||(i[8]=A=>oe(T)?T.value=A:null),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${se.value}`}}},{header:G(()=>i[13]||(i[13]=[u("div",null,null,-1)])),container:G(()=>[u("div",_s,[u("div",xs,[y(P,{icon:"pi pi-chevron-right",severity:"secondary",onClick:i[6]||(i[6]=A=>T.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),s(V)?(n(),c("div",ks,[Re(y(P,{icon:"pi pi-replay",variant:"link",onClick:s(fe),class:"h-[36px] rounded-lg text-sm"},null,8,["onClick"]),[[ye,C.$t("revertToStartingCode")]])])):B("",!0),(n(),z(lt,null,[(n(),z(s(ct),{id:s(k),key:s(k),connectbuttons:s(b),"onUpdate:connectbuttons":i[7]||(i[7]=A=>oe(b)?b.value=A:null),onRun:s(F),onSaveAnswer:he},null,8,["id","connectbuttons","onRun"]))],1024))])]),_:1},8,["visible","pt"])])):B("",!0)])):B("",!0),y(Se,{"enter-active-class":"transition duration-500 ease-out","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-300 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:G(()=>[s(r)=="completed"?(n(),c("div",Cs,[i[14]||(i[14]=u("div",{class:"text-5xl"},"‚ö°Ô∏è",-1)),u("div",$s,[u("div",Ss,O(C.$t("goodWork")),1),u("div",Es,O(C.$t("keepLearning")),1)]),u("div",null,[y(P,{label:C.$t("continue"),class:"rounded-full w-56 text-xl",onClick:re},null,8,["label"])])])):B("",!0)]),_:1})],64)}}});export{on as default};
