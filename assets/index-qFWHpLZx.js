import{s as We}from"./index-Ghj3hXdG.js";import{s as ke}from"./index-BWGSN1pn.js";import{s as Oe}from"./index-v92GWQ9D.js";import{b as Q,a as Ke,u as Te,r as m,x as D,o as n,c as d,j as u,t as q,z as Ye,q as B,n as Je,F as J,l as ve,h as y,d as Qe,A as Ce,e as le,p as P,i as s,C as Ee,E as ie,g as Be,a3 as Ie,y as Xe,D as j,H as _e,a2 as Ze,w as $e,k as ye,T as xe,G as et,I as oe,K as tt,v as st}from"./index-OPmzM71e.js";import{u as Ae,a as nt}from"./store-BSWgFrr0.js";import{S as ot}from"./SimulationView-DzRDoa29.js";import{c as at,e as lt}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-BSbyPsTu.js";import{_ as it}from"./CodeViewer.vue_vue_type_script_setup_true_lang-8E5P_IKt.js";import{_ as rt}from"./EditLocaleSelector.vue_vue_type_script_setup_true_lang-BqER42eI.js";import{u as Ue}from"./useLocaleStore-Cuv4B1CP.js";import{L as ut}from"./lessonApi-CnprsNaC.js";import{m as ct}from"./mapLessonFromDto-D3cEBYeg.js";import{m as dt}from"./mapUnitFromDto-DVWJHO4f.js";import{U as ae}from"./unitApi-C3y_hJgc.js";import{T as pt}from"./index-51z-PxMN.js";import{_ as we,a as vt,b as ft,c as gt,d as ht}from"./TeacherReviseViewer.vue_vue_type_style_index_0_scoped_75f452fa_lang-Bb0hCGMj.js";import{_ as mt}from"./TinkercadViewer.vue_vue_type_script_setup_true_lang-D4KGzmUc.js";import{u as Pe}from"./index-ULsFXyYg.js";import{_ as yt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-WPnT3Nz4.js";import"./index-34R-cZ83.js";import"./index-y66fLmIk.js";import"./index-CR1osQc6.js";import"./index-CH7amLO5.js";import"./index-0vmajm6r.js";import"./language-DYQF8nnT.js";import"./transformUnitDtosToPages-hsgZNhAG.js";import"./index-a7tscP-N.js";import"./index-C9mcwbj8.js";import"./index-Bbywy24T.js";const wt={class:"border border-purple-200 rounded-xl bg-gradient-to-r from-purple-50 to-pink-50"},bt={class:"flex items-center gap-3"},_t={class:"font-semibold text-purple-900"},xt={class:"flex items-center gap-2"},kt=["title"],Ct={key:0,class:"px-4 pb-4"},$t={key:0},St={class:"rounded-xl overflow-clip p-4 bg-white border border-purple-100 shadow-sm"},Lt={key:1,class:"flex gap-2 flex-wrap"},At={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Tt={key:2},Et={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Bt={key:3},It={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Ut=Q({__name:"TeacherAnswerViewer",props:{unitType:{},unitContent:{}},setup(S){const e=S,{t:p}=Ke(),f=Te(),a=m(!1),C=()=>{a.value=!a.value},x=async()=>{try{let o="";e.unitType==="open"?o=e.unitContent.answer:e.unitType==="options"?o=I.value.map(l=>l.text).join(`
`):(e.unitType==="code"||e.unitType==="pibody")&&(o=e.unitContent.answer),await navigator.clipboard.writeText(o),f.add({severity:"success",summary:p("pages.teacher.answerCopied"),detail:p("pages.teacher.answerCopiedDetail"),life:2e3})}catch(o){console.log(o),f.add({severity:"error",summary:p("pages.teacher.copyError"),detail:p("pages.teacher.copyErrorDetail"),life:2e3})}},I=D(()=>{var o;return!((o=e.unitContent)!=null&&o.options)||!e.unitContent.answer?[]:e.unitContent.options.filter(l=>e.unitContent.answer.includes(l.id))});return(o,l)=>(n(),d("div",wt,[u("div",{onClick:C,class:"flex items-center justify-between cursor-pointer hover:bg-purple-100/50 p-4 rounded-xl transition-all duration-200"},[u("div",bt,[l[0]||(l[0]=u("div",{class:"flex items-center justify-center w-6 h-6 text-purple-500"},[u("i",{class:"pi pi-crown","aria-hidden":"true"})],-1)),u("span",_t,q(a.value?o.$t("pages.teacher.hideAnswer"):o.$t("pages.teacher.showAnswer")),1)]),u("div",xt,[a.value?(n(),d("button",{key:0,onClick:Ye(x,["stop"]),class:"flex items-center justify-center w-8 h-8 text-purple-600 hover:bg-purple-200 rounded-lg transition-colors",title:o.$t("pages.teacher.copyAnswer")},l[1]||(l[1]=[u("i",{class:"pi pi-copy","aria-hidden":"true"},null,-1)]),8,kt)):B("",!0),(n(),d("svg",{class:Je(["w-5 h-5 transition-transform duration-200 text-purple-600",{"rotate-180":a.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},l[2]||(l[2]=[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))])]),a.value?(n(),d("div",Ct,[e.unitType=="open"?(n(),d("div",$t,[u("div",St,q(e.unitContent.answer),1)])):e.unitType=="options"?(n(),d("div",Lt,[u("div",At,[(n(!0),d(J,null,ve(I.value,r=>(n(),d("div",{key:r.id},[y(we,{text:r.text},null,8,["text"])]))),128))])])):e.unitType=="code"?(n(),d("div",Tt,[u("div",Et,[y(we,{text:` \`\`\`python
${e.unitContent.answer}
\`\`\` `},null,8,["text"])])])):e.unitType=="pibody"?(n(),d("div",Bt,[u("div",It,[y(we,{text:` \`\`\`python
${e.unitContent.answer}
\`\`\` `},null,8,["text"])])])):B("",!0)])):B("",!0)]))}});async function be(S){if(S=="")return"";const p=new TextEncoder().encode(S),f=await crypto.subtle.digest("SHA-256",p);return Array.from(new Uint8Array(f)).map(x=>x.toString(16).padStart(2,"0")).join("")}function Pt(S){let e="",p=!1;for(let f=0;f<S.length;f++){const a=S[f];if(a==="#"&&(p=!0),p)if(a===`
`)p=!1;else continue;a!==" "&&a!=="	"&&a!==`
`&&a!=="\r"&&(e+=a)}return e}function zt(S,e){if(S.length!==e.length)return!1;const p=[...S].sort(),f=[...e].sort();return p.every((a,C)=>a===f[C])}const fe=Qe("lesson-store",()=>{const S=Te(),e=m(null),p=m(!1),f=m(!1),a=m(!1),C=m(!1),x=m(!1),I=m(0),o=m(0),l=m([]),r=m(0),k=m(new Map),_=m(new Map),v=m([]),c=m("continue"),A=m(!1),w=m(!1),L=m(!1),G=m(!0),z=m(""),H=m(0),R=m(null),X=m(null),Z=m([]),ee=m([]),ge=Ce(),re=Ue(),{lang:ue}=le(re),N=m(void 0),W=D(()=>{var t;return L.value&&(((t=R.value)==null?void 0:t.modulesWerePut)??!0)&&G.value});async function O(t,h){try{p.value=!0,k.value.clear(),_.value.clear(),N.value=ge.userRole==="editor"?ue.value:void 0;const{data:g}=await ut.getLessonById(t,h,N.value);e.value=ct(g),e.value.stage=="published"&&K()}catch(g){S.add({severity:"error",summary:g.response.data.error,life:2e3})}finally{p.value=!1}}async function K(){if(e.value)try{x.value=!0,I.value=0,k.value.clear();const t=[];e.value.pages.forEach(b=>{b.groups.forEach(T=>{T.units.forEach(ne=>{t.push({id:ne.id,lessonId:e.value.id})})})});const h=t.length,g=5;for(let b=0;b<t.length;b+=g){const ne=t.slice(b,b+g).map(async({id:he,lessonId:Ne})=>{try{const{data:me}=await ae.getUnitByIdandLessonId(he,Ne,N.value);k.value.set(he,me)}catch(me){console.warn(`Failed to preload unit ${he}:`,me)}});await Promise.all(ne),I.value=Math.round(Math.min(b+g,h)/h*100)}}catch(t){console.error("Error preloading units:",t)}finally{x.value=!1}}async function te(t,h){if(k.value.has(t))return k.value.get(t);try{f.value=!0;const{data:g}=await ae.getUnitByIdandLessonId(t,h,N.value);return k.value.set(t,g),g}catch(g){S.add({severity:"error",summary:g.response.data.error,life:2e3})}finally{f.value=!1}}async function ce(){if(e.value!=null){a.value=!0,l.value=[],o.value=0,r.value=0,v.value=[],z.value="",ee.value=[],w.value=!1;for(let t=0;t<e.value.pages.length;t++)v.value.push(0);c.value="continue",pe(),l.value.push(e.value.pages[o.value].groups[r.value]),await i(e.value.id),a.value=!1}}function de(t,h){var b;H.value=h.id,z.value==""&&(z.value=`emulator-${H.value}`);const g=h.content.starting;X.value=Ae(z.value),X.value.setCode(g),t=="pibody"&&(R.value=nt(z.value),(b=R.value)==null||b.clearSlots(),Z.value=h.data.neededModules,R.value.addNeededModules(Z.value),ee.value=[])}function $(){z.value!=""&&lt.getSharedEmulator().stop()}async function i(t){L.value=!1,A.value=!1;for(let h=0;h<l.value[r.value].units.length;h++){const g=l.value[r.value].units[h];["options","open","code","pibody"].includes(g.unitType)&&(c.value="check",A.value=!0);const b=await te(g.id,t);if(b){const T=dt(b);l.value[r.value].units[h].content=T==null?void 0:T.content,l.value[r.value].units[h].data=T==null?void 0:T.data,l.value[r.value].units[h].studentState=T==null?void 0:T.studentState,["code","pibody"].includes(g.unitType)&&(L.value=!0,T.content.answer==""&&T.data.tests.lenght==0||(G.value=!1),de(g.unitType,T))}}c.value=="continue"&&await U()}async function U(){if(e.value!=null)try{C.value=!0,w.value=!1;for(const t of l.value[l.value.length-1].units){if(_.value.set(t.id,t.studentState.answer),["code","pibody"].includes(t.unitType)){const h=Ae(z.value).code.value;if(t.data.tests.length>0){const g=await at(z.value,h,t.data.tests,t.data.includedCommands);w.value=g.correct}else if(!t.content.hashed_answer)w.value=!0;else{const g=Pt(h),b=await be(g);w.value=t.content.hashed_answer===b}}else if(t.unitType=="open"){const g=String(t.studentState.answer.open??"").replace(/ /g,"").toLowerCase(),b=await be(g);w.value=!t.content.hashed_answer||t.content.hashed_answer===b}else if(t.unitType=="options"){const h=t.studentState.answer.options,g=[];for(const b of h)g.push(await be(b));w.value=t.content.hashed_answer.length==0||zt(t.content.hashed_answer,g)}else w.value=!0;if(w.value==!1)break}l.value[l.value.length-1].units.length||(w.value=!0),w.value?(v.value[o.value]++,r.value>=e.value.pages[o.value].groups.length-1?o.value<e.value.pages.length-1?c.value="continue":c.value="finish":c.value="continue"):c.value="try-again"}finally{C.value=!1}}async function V(){if(e.value!=null){if($(),r.value>=e.value.pages[o.value].groups.length-1){await Le(),Se();return}a.value=!0,r.value++,l.value.push(e.value.pages[o.value].groups[r.value]),await i(e.value.id),a.value=!1}}async function F(t){const h=l.value[l.value.length-1].id;c.value="continue",v.value[o.value]--,r.value--,l.value.pop(),h==t?o.value==0&&l.value.length==0?await ce():await V():await F(t)}function pe(){if(!e.value)return;let t=0;for(const h of e.value.pages)if(h.groups.every(b=>b.units.every(T=>T.studentStatus==="completed")))t!=e.value.pages.length-1&&(v.value[t]=h.groups.length,t++);else break;o.value=t}function E(){o.value!=0&&(v.value[o.value]=0,v.value[o.value-1]=0,o.value-=2,Se())}function se(t,h){if(e.value!=null){for(const[g,b]of l.value.entries())for(const[T,ne]of b.units.entries())if(ne.id==t){l.value[g].units[T].studentState.answer=h;break}}}async function ze(){e.value!=null&&(c.value="check")}async function De(){e.value!=null&&(await Le(),c.value="completed")}function je(){k.value.clear(),I.value=0,x.value=!1}async function Se(){e.value!=null&&(a.value=!0,o.value++,l.value=[],r.value=0,c.value="continue",l.value.push(e.value.pages[o.value].groups[r.value]),await i(e.value.id),a.value=!1)}function Ge(t){L.value=t}function Me(){G.value=!0}async function Re(t){z.value!=""&&(t.code=X.value.code,se(H.value,t),await ae.saveUnitByIdandLessonId(H.value,e.value.id,{answer:t}))}async function Le(){if(a.value=!0,e.value==null)return;const t=Array.from(_.value.entries()).map(([g,b])=>({id:g,student_answer:b})),{data:h}=await ae.submitUnitsByLessonId(e.value.id,t);w.value=h.correct,_.value=new Map,a.value=!1}const M=D(()=>e.value?e.value.pages[o.value]??null:null),Y=D(()=>M.value?M.value.groups[r.value]??null:null),Ve=D({get:()=>{var t;return((t=Y.value)==null?void 0:t.pibodyDrawerVisible)??!1},set:t=>{Y.value&&(Y.value.pibodyDrawerVisible=t)}}),Fe=D({get:()=>{var t;return((t=Y.value)==null?void 0:t.codeDrawerVisible)??!1},set:t=>{Y.value&&(Y.value.codeDrawerVisible=t)}}),qe=D({get:()=>{var t;return((t=M.value)==null?void 0:t.showPibody)??!1},set:t=>{M.value&&(M.value.showPibody=t)}}),He=D({get:()=>{var t;return((t=M.value)==null?void 0:t.showCode)??!1},set:t=>{M.value&&(M.value.showCode=t)}});return{selectedLesson:e,isLessonLoading:p,isUnitLoading:f,groups:l,groupIndex:r,isGroupLoading:a,isSubmitLoading:C,isPreloadingUnits:x,preloadingProgress:I,groupStatus:c,submitExist:A,correct:w,submitEnabled:W,pageProgress:v,emulatorID:z,neededModules:Z,slots:ee,pibodyDrawerVisible:Ve,codeDrawerVisible:Fe,showPibody:qe,showCode:He,answersCache:_,setSubmitable:Ge,loadLessonById:O,loadUnitByIdandLessonId:te,preloadAllUnits:K,clearUnitsCache:je,loadInitialGroup:ce,submitGroup:U,nextGroup:V,saveAnswer:se,tryAgain:ze,finishLesson:De,runCodePressed:Me,saveStudentIdeState:Re,resetGroup:F,pageBack:E}}),Dt={key:1,class:"px-4 py-2"},jt=Q({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(S){const e=S,p=Ee(),f=fe(),{saveAnswer:a,setSubmitable:C}=f;function x(r){e.unit.unitType=="options"?C(r.options.length>0):e.unit.unitType=="open"&&C(r.open.length>0),a(e.unit.id,r),I(r)}const I=Pe(r=>{o(r)},1e3,{maxWait:5e3});async function o(r){await ae.saveUnitByIdandLessonId(e.unit.id,Number(p.params.id),{answer:r})}const l=D(()=>{var r;return(r=e.unit.content)!=null&&r.answer?Array.isArray(e.unit.content.answer)?e.unit.content.answer.length>0:typeof e.unit.content.answer=="string"?e.unit.content.answer.trim()!=="":!0:!1});return(r,k)=>{const _=ke;return n(),d("div",null,[r.loading?(n(),P(_,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),d("div",Dt,[e.unit.unitType=="article"?(n(),P(s(vt),{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="options"?(n(),P(s(ft),{key:1,"options-data":e.unit.content,state:e.unit.studentState,onSaveAnswer:x},null,8,["options-data","state"])):e.unit.unitType=="open"?(n(),P(s(gt),{key:2,state:e.unit.studentState,onSaveAnswer:x},null,8,["state"])):e.unit.unitType=="video"?(n(),P(s(ht),{key:3,video:e.unit.content},null,8,["video"])):e.unit.unitType=="tinkercad"?(n(),P(s(mt),{key:4,tinkercad:e.unit.content},null,8,["tinkercad"])):B("",!0),l.value?(n(),P(s(Ut),{key:5,unitType:e.unit.unitType,unitContent:e.unit.content},null,8,["unitType","unitContent"])):B("",!0)]))])}}}),Gt={key:1,class:"flex flex-col h-full w-full"},Mt={class:"flex-grow flex flex-col gap-4 px-4 py-2"},Rt=Q({__name:"GroupCard",props:{group:{},loading:{type:Boolean}},setup(S){const e=S,p=m(null);return ie(()=>e.loading,f=>{f===!1&&p.value&&requestAnimationFrame(()=>{var a;(a=p.value)==null||a.scrollIntoView({behavior:"smooth",block:"start"})})}),(f,a)=>{const C=ke;return n(),d("div",{ref_key:"groupRef",ref:p},[f.loading?(n(),P(C,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),d("div",Gt,[u("div",Mt,[(n(!0),d(J,null,ve(f.group.units,x=>(n(),P(jt,{key:x.id,unit:x},null,8,["unit"]))),128))])]))],512)}}}),Vt={key:0,class:"absolute right-0"},Ft=Q({__name:"UnitsView",props:{pages:{}},setup(S){const e=fe(),{groups:p,isGroupLoading:f}=le(e),{loadInitialGroup:a,resetGroup:C}=e,x=Ce(),I=m(null),o=m(null),l=m(0);function r(v){let c=v;for(;c&&c.parentElement;){const A=c.parentElement,L=getComputedStyle(A).overflowY;if(L==="auto"||L==="scroll")return A;c=A}return null}async function k(){await Ze();const v=r(I.value),c=o.value;if(!v||!c){l.value=0;return}const A=v.clientHeight,w=c.getBoundingClientRect().height,L=Math.max(0,A-w-16);l.value=L}function _(v,c){var L;const A=(L=p.value[p.value.length-1])==null?void 0:L.id;let w=null;v&&(v instanceof Element?w=v:v.$el instanceof Element&&(w=v.$el)),o.value=c.id===A?w:null}return Be(()=>{a(),k(),window.addEventListener("resize",k)}),Ie(()=>{window.removeEventListener("resize",k)}),ie(()=>p.value.length,async()=>{await k()}),ie(()=>f.value,async(v,c)=>{c===!0&&v===!1&&await k()}),(v,c)=>{const A=$e,w=pt;return n(),d("div",{ref_key:"rootEl",ref:I,class:"flex flex-col gap-2 pt-2"},[(n(!0),d(J,null,ve(s(p),L=>(n(),d("div",{key:L.id,ref_for:!0,ref:G=>_(G,L),class:"relative"},[!s(f)&&s(x).userRole=="editor"?(n(),d("div",Vt,[Xe((n(),P(A,{type:"button",class:"w-9 h-9 mr-8 mt-2",rounded:"",severity:"secondary",variant:"text",onClick:G=>s(C)(L.id)},{default:j(()=>c[0]||(c[0]=[u("span",{class:"material-icons"},"restart_alt",-1)])),_:2},1032,["onClick"])),[[w,"Reset step",void 0,{left:!0}]])])):B("",!0),y(Rt,{group:L,loading:s(f)&&L.id==s(p)[s(p).length-1].id},null,8,["group","loading"])]))),128)),u("div",{style:_e({height:l.value+"px"})},null,4)],512)}}}),qt={key:0,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Ht={key:1},Nt={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},Wt={class:"text-lg font-bold flex items-center gap-2"},Ot={key:"incorrect",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-red-100"},Kt={key:"no-submit",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Yt={key:"try-again",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-gray-50"},Jt={class:"text-lg font-bold flex items-center gap-2"},Qt={key:2},Xt={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},Zt={class:"text-lg font-bold flex items-center gap-2"},es={key:1,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},ts=Q({__name:"NavigationBar",setup(S){const e=fe(),{isSubmitLoading:p,groupStatus:f,isGroupLoading:a,submitExist:C,correct:x,submitEnabled:I}=le(e),{submitGroup:o,nextGroup:l,tryAgain:r,finishLesson:k}=e;return(_,v)=>{const c=$e;return n(),d(J,null,[s(f)=="check"?(n(),d("div",qt,[y(c,{label:_.$t("check").toUpperCase(),icon:"pi pi-check","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(o),loading:s(p),disabled:s(p)||!s(I)},null,8,["label","onClick","loading","disabled"])])):B("",!0),s(f)=="continue"?(n(),d("div",Ht,[y(xe,{name:"pop",appear:"",mode:"out-in"},{default:j(()=>[s(C)&&s(x)?(n(),d("div",Nt,[u("div",Wt,[v[0]||(v[0]=u("span",{class:"text-3xl"},"üéâ",-1)),ye(" "+q(_.$t("correct"))+"! ",1)]),y(c,{label:_.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(l),loading:s(a),disabled:s(a)},null,8,["label","onClick","loading","disabled"])])):s(C)&&!s(x)?(n(),d("div",Ot,[y(c,{label:_.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(l),loading:s(a),disabled:s(a)},null,8,["label","onClick","loading","disabled"])])):(n(),d("div",Kt,[y(c,{label:_.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(l),loading:s(a),disabled:s(a)},null,8,["label","onClick","loading","disabled"])]))]),_:1})])):B("",!0),y(xe,{name:"shake",appear:""},{default:j(()=>[s(f)=="try-again"?(n(),d("div",Yt,[u("div",Jt,[v[1]||(v[1]=u("span",{class:"text-3xl"},"‚ö†Ô∏è",-1)),ye(" "+q(_.$t("incorrect"))+"! ",1)]),y(c,{label:_.$t("tryAgain").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(r)},null,8,["label","onClick"])])):B("",!0)]),_:1}),s(f)=="finish"?(n(),d("div",Qt,[s(C)&&s(x)?(n(),d("div",Xt,[u("div",Zt,[v[2]||(v[2]=u("span",{class:"text-3xl"},"üéâ",-1)),ye(" "+q(_.$t("correct"))+"!",1)]),y(c,{label:_.$t("finish").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(k),loading:s(a),disabled:s(a)},null,8,["label","onClick","loading","disabled"])])):(n(),d("div",es,[y(c,{label:_.$t("finish").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(k)},null,8,["label","onClick"])]))])):B("",!0)],64)}}}),ss=yt(ts,[["__scopeId","data-v-4f5f4e6c"]]),ns={key:0,class:"h-screen bg-white flex flex-col items-center overflow-hidden relative"},os={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 max-w-[1920px] mx-auto"},as={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},ls={class:"flex items-center gap-4"},is={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},rs={class:"flex-1 overflow-y-auto mt-16 mb-24 w-full"},us={key:1,class:"flex justify-center"},cs={key:2},ds={key:3,class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-[1000] border border-gray-200 flex flex-col items-center gap-4"},ps={key:4,class:"fixed top-20 right-4 bg-white rounded-lg shadow-md z-50 border border-gray-200 p-4 min-w-64"},vs={class:"flex items-center gap-3 mb-2"},fs={class:"fixed bottom-0 left-0 right-0 z-50 bg-transparent shadow-md max-w-[1920px] mx-auto"},gs={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},hs={class:"relative h-full"},ms={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},ys={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},ws={class:"relative h-full"},bs={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},_s={key:0,class:"h-screen flex flex-col items-center justify-center overflow-hidden gap-10"},xs={class:"flex flex-col items-center"},ks={class:"text-4xl font-bold mb-8"},Cs={class:"text-md text-gray-500"},tn=Q({__name:"LessonPage",setup(S){const e=Ee(),p=st(),f=Ce(),a=Ue(),{lang:C}=le(a);ie(C,async($,i)=>{$!==i&&o.value&&await R(Number(e.params.id),(e.query.route_id??"").toString())});const x=fe(),{isLessonLoading:I,selectedLesson:o,pageProgress:l,groupStatus:r,emulatorID:k,neededModules:_,slots:v,pibodyDrawerVisible:c,codeDrawerVisible:A,showPibody:w,showCode:L,isPreloadingUnits:G,preloadingProgress:z,answersCache:H}=le(x),{loadLessonById:R,runCodePressed:X,saveStudentIdeState:Z,pageBack:ee}=x;function ge($){var U;const i=((U=o.value)==null?void 0:U.pages.reduce((V,F)=>V+F.groups.length,0))||1;return $/i*100}function re(){var $;(($=o.value)==null?void 0:$.lessonType)=="module"?p.push("/v2/docs"):e.query.route_id&&e.query.route_id!=""?p.push("/v2/route/"+e.query.route_id):f.userRole=="editor"?p.push("/v2/routes"):p.push("/v2/home")}ie(v,()=>{ue({slots:v.value})});const ue=Pe($=>{Z($)},1e3,{maxWait:5e3});function N($){ue({slots:v.value})}const W=m(window.innerWidth),O=m(16);function K(){if(W.value=window.innerWidth,W.value<=1300){O.value=16;return}const i=452-(W.value-1024)/2;O.value=i>16?i:16}Be(async()=>{var $,i;r.value="continue",K(),await R(Number(e.params.id),(e.query.route_id??"").toString()),(($=o.value)==null?void 0:$.lessonType)=="project"&&p.push({path:e.path.replace("/lesson/","/project/"),query:e.query}),((i=o.value)==null?void 0:i.studentProgress)==100&&p.push({path:`${e.path}/revise`,query:e.query}),window.addEventListener("resize",K),window.addEventListener("beforeunload",de)}),et(()=>{window.removeEventListener("resize",K)});const te=D(()=>W.value<=1920?{}:"calc((-100vw + 1920px) / 2)"),ce=()=>{p.push(`${e.path}/edit`)};Ie(()=>{window.removeEventListener("beforeunload",de)});function de($){if(r.value!="completed"&&H.value.size>0)return $.preventDefault(),!0}return($,i)=>{const U=$e,V=Oe,F=ke,pe=We;return n(),d(J,null,[s(r)!="completed"?(n(),d("div",ns,[u("div",os,[u("div",as,[u("div",ls,[y(U,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:re})]),s(o)?(n(),d("div",is,[(n(!0),d(J,null,ve(s(o).pages,(E,se)=>(n(),d("div",{key:se,class:"h-full",style:_e({width:ge(E.groups.length)+"%"})},[y(V,{value:s(l)[se]/E.groups.length*100,"show-value":!1,class:"w-full rounded-full h-3"},null,8,["value"])],4))),128))])):B("",!0),i[9]||(i[9]=u("div",{class:"w-10"},null,-1))])]),u("div",rs,[u("div",{class:"w-full h-full max-w-screen-lg mx-auto",style:_e({paddingLeft:O.value+"px",paddingRight:O.value+"px"})},[s(I)?(n(),P(F,{key:0,class:"flex justify-center"})):s(o)?(n(),d("div",cs,[y(Ft,{pages:s(o).pages},null,8,["pages"])])):(n(),d("div",us,"No lesson found")),s(f).userRole=="editor"?(n(),d("div",ds,[y(s(rt)),y(U,{icon:"pi pi-pencil",variant:"text",severity:"contrast",onClick:ce}),y(U,{variant:"text",severity:"contrast",onClick:s(ee)},{default:j(()=>i[10]||(i[10]=[u("span",{class:"material-icons"},"swipe_left_alt",-1)])),_:1},8,["onClick"])])):B("",!0),s(G)?(n(),d("div",ps,[u("div",vs,[y(F,{style:{width:"20px",height:"20px"}}),i[11]||(i[11]=u("span",{class:"text-sm font-medium"},"Preloading units...",-1))]),y(V,{value:s(z),"show-value":!0,class:"h-2"},null,8,["value"])])):B("",!0)],4)]),u("div",fs,[y(ss)]),s(w)?(n(),d("div",gs,[y(U,{icon:"pi pi-microchip",severity:"secondary",onClick:i[0]||(i[0]=E=>c.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),y(pe,{visible:s(c),"onUpdate:visible":i[4]||(i[4]=E=>oe(c)?c.value=E:null),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${te.value}`}}},{header:j(()=>i[12]||(i[12]=[u("div",null,null,-1)])),container:j(()=>[u("div",hs,[u("div",ms,[y(U,{icon:"pi pi-chevron-left",severity:"secondary",onClick:i[1]||(i[1]=E=>c.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(n(),P(s(ot),{id:s(k),key:s(k),slots:s(v),"onUpdate:slots":i[2]||(i[2]=E=>oe(v)?v.value=E:null),neededModules:s(_),"onUpdate:neededModules":i[3]||(i[3]=E=>oe(_)?_.value=E:null),class:"w-full",horizontal:!1,autoPut:!0},null,8,["id","slots","neededModules"]))])]),_:1},8,["visible","pt"])])):B("",!0),s(L)?(n(),d("div",ys,[y(U,{icon:"pi pi-code",severity:"secondary",onClick:i[5]||(i[5]=E=>A.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),y(pe,{visible:s(A),"onUpdate:visible":i[8]||(i[8]=E=>oe(A)?A.value=E:null),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${te.value}`}}},{header:j(()=>i[13]||(i[13]=[u("div",null,null,-1)])),container:j(()=>[u("div",ws,[u("div",bs,[y(U,{icon:"pi pi-chevron-right",severity:"secondary",onClick:i[6]||(i[6]=E=>A.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),(n(),P(tt,null,[(n(),P(s(it),{id:s(k),key:s(k),connectbuttons:s(w),"onUpdate:connectbuttons":i[7]||(i[7]=E=>oe(w)?w.value=E:null),onRun:s(X),onSaveAnswer:N},null,8,["id","connectbuttons","onRun"]))],1024))])]),_:1},8,["visible","pt"])])):B("",!0)])):B("",!0),y(xe,{"enter-active-class":"transition duration-500 ease-out","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-300 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:j(()=>[s(r)=="completed"?(n(),d("div",_s,[i[14]||(i[14]=u("div",{class:"text-5xl"},"‚ö°Ô∏è",-1)),u("div",xs,[u("div",ks,q($.$t("goodWork")),1),u("div",Cs,q($.$t("keepLearning")),1)]),u("div",null,[y(U,{label:$.$t("continue"),class:"rounded-full w-56 text-xl",onClick:re},null,8,["label"])])])):B("",!0)]),_:1})],64)}}});export{tn as default};
