import{T as De}from"./index-CV2rfB1h.js";import{s as et}from"./index-DLkuplCm.js";import{s as Le}from"./index-uZyJKb9n.js";import{s as tt}from"./index-iH74k92p.js";import{b as ne,a as st,u as je,r as v,x as V,o as n,c,j as u,t as Q,z as nt,q as U,n as ot,F as se,l as ge,h as y,d as at,A as Ee,e as ue,p as G,i as s,C as Ge,E as ce,g as Me,a3 as Re,y as Se,a4 as lt,H as re,D as q,a2 as Pe,w as Ae,k as xe,T as Te,G as it,I as le,K as rt,v as ut}from"./index-mkT4Nz16.js";import{u as ke,a as Ue}from"./store-CBsra51i.js";import{S as ct}from"./SimulationView-By6f_bqQ.js";import{e as ze,c as dt}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-CNd0MONv.js";import{_ as pt}from"./CodeViewer.vue_vue_type_script_setup_true_lang-CgRwO4P_.js";import{_ as vt}from"./EditLocaleSelector.vue_vue_type_script_setup_true_lang-Cd_9BiRB.js";import{u as He}from"./useLocaleStore-lh19t7gk.js";import{L as ft}from"./lessonApi-CF9NuSSx.js";import{m as gt}from"./mapLessonFromDto-D3cEBYeg.js";import{m as ht}from"./mapUnitFromDto-DVWJHO4f.js";import{U as ie}from"./unitApi-QjydTCTy.js";import{_ as Ce,a as mt,b as yt,c as wt,d as bt}from"./TeacherReviseViewer.vue_vue_type_style_index_0_scoped_75f452fa_lang-CEVzS_3z.js";import{_ as _t}from"./TinkercadViewer.vue_vue_type_script_setup_true_lang-Bpj2hdxV.js";import{u as Ve}from"./index-Bd0CtTvM.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Dp-E07Q-.js";import"./index-Ce2l9Qw5.js";import"./index-CYFre0Ef.js";import"./index-DPKHG_gJ.js";import"./index-Bae2SLxX.js";import"./index-BzKibbNi.js";import"./language-DYQF8nnT.js";import"./transformUnitDtosToPages-hsgZNhAG.js";import"./index-Dt3o_xrH.js";import"./index-C2rkqqLY.js";import"./index-DMVNDFxA.js";const xt={class:"border border-purple-200 rounded-xl bg-gradient-to-r from-purple-50 to-pink-50"},kt={class:"flex items-center gap-3"},Ct={class:"font-semibold text-purple-900"},$t={class:"flex items-center gap-2"},St=["title"],Tt={key:0,class:"px-4 pb-4"},Lt={key:0},Et={class:"rounded-xl overflow-clip p-4 bg-white border border-purple-100 shadow-sm"},At={key:1,class:"flex gap-2 flex-wrap"},Bt={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},It={key:2},Pt={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Ut={key:3},zt={class:"rounded-xl overflow-clip bg-white border border-purple-100 shadow-sm p-4"},Dt=ne({__name:"TeacherAnswerViewer",props:{unitType:{},unitContent:{}},setup(E){const e=E,{t:d}=st(),h=je(),a=v(!1),T=()=>{a.value=!a.value},$=async()=>{try{let o="";e.unitType==="open"?o=e.unitContent.answer:e.unitType==="options"?o=D.value.map(l=>l.text).join(`
`):(e.unitType==="code"||e.unitType==="pibody")&&(o=e.unitContent.answer),await navigator.clipboard.writeText(o),h.add({severity:"success",summary:d("pages.teacher.answerCopied"),detail:d("pages.teacher.answerCopiedDetail"),life:2e3})}catch(o){console.log(o),h.add({severity:"error",summary:d("pages.teacher.copyError"),detail:d("pages.teacher.copyErrorDetail"),life:2e3})}},D=V(()=>{var o;return!((o=e.unitContent)!=null&&o.options)||!e.unitContent.answer?[]:e.unitContent.options.filter(l=>e.unitContent.answer.includes(l.id))});return(o,l)=>(n(),c("div",xt,[u("div",{onClick:T,class:"flex items-center justify-between cursor-pointer hover:bg-purple-100/50 p-4 rounded-xl transition-all duration-200"},[u("div",kt,[l[0]||(l[0]=u("div",{class:"flex items-center justify-center w-6 h-6 text-purple-500"},[u("i",{class:"pi pi-crown","aria-hidden":"true"})],-1)),u("span",Ct,Q(a.value?o.$t("pages.teacher.hideAnswer"):o.$t("pages.teacher.showAnswer")),1)]),u("div",$t,[a.value?(n(),c("button",{key:0,onClick:nt($,["stop"]),class:"flex items-center justify-center w-8 h-8 text-purple-600 hover:bg-purple-200 rounded-lg transition-colors",title:o.$t("pages.teacher.copyAnswer")},l[1]||(l[1]=[u("i",{class:"pi pi-copy","aria-hidden":"true"},null,-1)]),8,St)):U("",!0),(n(),c("svg",{class:ot(["w-5 h-5 transition-transform duration-200 text-purple-600",{"rotate-180":a.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},l[2]||(l[2]=[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))])]),a.value?(n(),c("div",Tt,[e.unitType=="open"?(n(),c("div",Lt,[u("div",Et,Q(e.unitContent.answer),1)])):e.unitType=="options"?(n(),c("div",At,[u("div",Bt,[(n(!0),c(se,null,ge(D.value,i=>(n(),c("div",{key:i.id},[y(Ce,{text:i.text},null,8,["text"])]))),128))])])):e.unitType=="code"?(n(),c("div",It,[u("div",Pt,[y(Ce,{text:` \`\`\`python
${e.unitContent.answer}
\`\`\` `},null,8,["text"])])])):e.unitType=="pibody"?(n(),c("div",Ut,[u("div",zt,[y(Ce,{text:` \`\`\`python
${e.unitContent.answer}
\`\`\` `},null,8,["text"])])])):U("",!0)])):U("",!0)]))}});async function $e(E){if(E=="")return"";const d=new TextEncoder().encode(E),h=await crypto.subtle.digest("SHA-256",d);return Array.from(new Uint8Array(h)).map($=>$.toString(16).padStart(2,"0")).join("")}function jt(E){let e="",d=!1;for(let h=0;h<E.length;h++){const a=E[h];if(a==="#"&&(d=!0),d)if(a===`
`)d=!1;else continue;a!==" "&&a!=="	"&&a!==`
`&&a!=="\r"&&(e+=a)}return e}function Gt(E,e){if(E.length!==e.length)return!1;const d=[...E].sort(),h=[...e].sort();return d.every((a,T)=>a===h[T])}const he=at("lesson-store",()=>{const E=je(),e=v(null),d=v(!1),h=v(!1),a=v(!1),T=v(!1),$=v(!1),D=v(0),o=v(0),l=v([]),i=v(0),A=v(new Map),x=v(new Map),w=v([]),g=v("continue"),M=v(!1),k=v(!1),N=v(!1),R=v(!0),H=v(!1),P=v(""),F=v(0),m=v(null),b=v(null),L=v([]),z=v([]),B=Ee(),X=He(),{lang:de}=ue(X),O=v(void 0),me=V(()=>{var t;return N.value&&(((t=m.value)==null?void 0:t.modulesWerePut)??!0)&&R.value});async function Z(t,p){try{d.value=!0,A.value.clear(),x.value.clear(),O.value=B.userRole==="editor"?de.value:void 0;const{data:f}=await ft.getLessonById(t,p,O.value);e.value=gt(f),e.value.stage=="published"&&Y()}catch(f){E.add({severity:"error",summary:f.response.data.error,life:2e3})}finally{d.value=!1}}async function Y(){if(e.value)try{$.value=!0,D.value=0,A.value.clear();const t=[];e.value.pages.forEach(_=>{_.groups.forEach(C=>{C.units.forEach(ae=>{t.push({id:ae.id,lessonId:e.value.id})})})});const p=t.length,f=5;for(let _=0;_<t.length;_+=f){const ae=t.slice(_,_+f).map(async({id:be,lessonId:Ze})=>{try{const{data:_e}=await ie.getUnitByIdandLessonId(be,Ze,O.value);A.value.set(be,_e)}catch(_e){console.warn(`Failed to preload unit ${be}:`,_e)}});await Promise.all(ae),D.value=Math.round(Math.min(_+f,p)/p*100)}}catch(t){console.error("Error preloading units:",t)}finally{$.value=!1}}async function ee(t,p){if(A.value.has(t))return A.value.get(t);try{h.value=!0;const{data:f}=await ie.getUnitByIdandLessonId(t,p,O.value);return A.value.set(t,f),f}catch(f){E.add({severity:"error",summary:f.response.data.error,life:2e3})}finally{h.value=!1}}async function oe(){if(e.value!=null){a.value=!0,l.value=[],o.value=0,i.value=0,w.value=[],P.value="",z.value=[],k.value=!1;for(let t=0;t<e.value.pages.length;t++)w.value.push(0);g.value="continue",ve(),l.value.push(e.value.pages[o.value].groups[i.value]),await r(e.value.id),a.value=!1}}function ye(t,p){var _,C;F.value=p.id,P.value==""&&(P.value=`emulator-${F.value}`);const f=p.content.starting;H.value=f!="",b.value=ke(P.value),b.value.setCode(f),t=="pibody"&&(m.value=Ue(P.value),(_=m.value)==null||_.clearSlots(),(C=m.value)==null||C.reset(),L.value=p.data.neededModules,m.value.addNeededModules(L.value),z.value=[])}function pe(){var _;if(P.value=="")return;ze.getSharedEmulator().stop();const p=l.value[i.value].units.find(C=>C.id===F.value),f=(p==null?void 0:p.content.starting)??"";f!=""&&(b.value=ke(P.value),b.value.setCode(f),(p==null?void 0:p.unitType)=="pibody"&&(m.value=Ue(P.value),(_=m.value)==null||_.clearSlots(),z.value=[]))}function S(){if(P.value=="")return;ze.getSharedEmulator().stop()}async function r(t){N.value=!1,M.value=!1,H.value=!1;for(let p=0;p<l.value[i.value].units.length;p++){const f=l.value[i.value].units[p];["options","open","code","pibody"].includes(f.unitType)&&(g.value="check",M.value=!0);const _=await ee(f.id,t);if(_){const C=ht(_);l.value[i.value].units[p].content=C==null?void 0:C.content,l.value[i.value].units[p].data=C==null?void 0:C.data,l.value[i.value].units[p].studentState=C==null?void 0:C.studentState,["code","pibody"].includes(f.unitType)&&(N.value=!0,C.content.answer==""&&C.data.tests.lenght==0||(R.value=!1),ye(f.unitType,C))}}g.value=="continue"&&await j()}async function j(){if(e.value!=null)try{T.value=!0,k.value=!1;for(const t of l.value[l.value.length-1].units){if(x.value.set(t.id,t.studentState.answer),["code","pibody"].includes(t.unitType)){const p=ke(P.value).code.value;if(t.data.tests.length>0){const f=await dt(P.value,p,t.data.tests,t.data.includedCommands);k.value=f.correct}else if(!t.content.hashed_answer)k.value=!0;else{const f=jt(p),_=await $e(f);k.value=t.content.hashed_answer===_}}else if(t.unitType=="open"){const f=String(t.studentState.answer.open??"").replace(/ /g,"").toLowerCase(),_=await $e(f);k.value=!t.content.hashed_answer||t.content.hashed_answer===_}else if(t.unitType=="options"){const p=t.studentState.answer.options,f=[];for(const _ of p)f.push(await $e(_));k.value=t.content.hashed_answer.length==0||Gt(t.content.hashed_answer,f)}else k.value=!0;if(k.value==!1)break}l.value[l.value.length-1].units.length||(k.value=!0),k.value?(w.value[o.value]++,i.value>=e.value.pages[o.value].groups.length-1?o.value<e.value.pages.length-1?g.value="continue":g.value="finish":g.value="continue"):g.value="try-again"}finally{T.value=!1}}async function K(){if(e.value!=null){if(S(),i.value>=e.value.pages[o.value].groups.length-1){await Ie(),Be();return}a.value=!0,i.value++,l.value.push(e.value.pages[o.value].groups[i.value]),await r(e.value.id),a.value=!1}}async function J(t){const p=l.value[l.value.length-1].id;g.value="continue",w.value[o.value]--,i.value--,l.value.pop(),p==t?o.value==0&&l.value.length==0?await oe():await K():await J(t)}function ve(){if(!e.value)return;let t=0;for(const p of e.value.pages)if(p.groups.every(_=>_.units.every(C=>C.studentStatus==="completed")))t!=e.value.pages.length-1&&(w.value[t]=p.groups.length,t++);else break;o.value=t}function we(){o.value!=0&&(w.value[o.value]=0,w.value[o.value-1]=0,o.value-=2,Be())}function I(t,p){if(e.value!=null){for(const[f,_]of l.value.entries())for(const[C,ae]of _.units.entries())if(ae.id==t){l.value[f].units[C].studentState.answer=p;break}}}async function fe(){e.value!=null&&(g.value="check")}async function qe(){e.value!=null&&(await Ie(),g.value="completed")}function Ne(){A.value.clear(),D.value=0,$.value=!1}async function Be(){e.value!=null&&(a.value=!0,o.value++,l.value=[],i.value=0,g.value="continue",l.value.push(e.value.pages[o.value].groups[i.value]),await r(e.value.id),a.value=!1)}function We(t){N.value=t}function Oe(){R.value=!0}async function Ye(t){P.value!=""&&(t.code=b.value.code,I(F.value,t),await ie.saveUnitByIdandLessonId(F.value,e.value.id,{answer:t}))}async function Ie(){if(a.value=!0,e.value==null)return;const t=Array.from(x.value.entries()).map(([f,_])=>({id:f,student_answer:_})),{data:p}=await ie.submitUnitsByLessonId(e.value.id,t);k.value=p.correct,x.value=new Map,a.value=!1}const W=V(()=>e.value?e.value.pages[o.value]??null:null),te=V(()=>W.value?W.value.groups[i.value]??null:null),Ke=V({get:()=>{var t;return((t=te.value)==null?void 0:t.pibodyDrawerVisible)??!1},set:t=>{te.value&&(te.value.pibodyDrawerVisible=t)}}),Je=V({get:()=>{var t;return((t=te.value)==null?void 0:t.codeDrawerVisible)??!1},set:t=>{te.value&&(te.value.codeDrawerVisible=t)}}),Qe=V({get:()=>{var t;return((t=W.value)==null?void 0:t.showPibody)??!1},set:t=>{W.value&&(W.value.showPibody=t)}}),Xe=V({get:()=>{var t;return((t=W.value)==null?void 0:t.showCode)??!1},set:t=>{W.value&&(W.value.showCode=t)}});return{selectedLesson:e,isLessonLoading:d,isUnitLoading:h,groups:l,groupIndex:i,isGroupLoading:a,isSubmitLoading:T,isPreloadingUnits:$,preloadingProgress:D,groupStatus:g,submitExist:M,correct:k,submitEnabled:me,pageProgress:w,pageIndex:o,emulatorID:P,neededModules:L,slots:z,pibodyDrawerVisible:Ke,codeDrawerVisible:Je,showPibody:Qe,showCode:Xe,answersCache:x,startingCodeExist:H,setSubmitable:We,loadLessonById:Z,loadUnitByIdandLessonId:ee,preloadAllUnits:Y,clearUnitsCache:Ne,loadInitialGroup:oe,submitGroup:j,nextGroup:K,saveAnswer:I,tryAgain:fe,finishLesson:qe,runCodePressed:Oe,saveStudentIdeState:Ye,resetGroup:J,pageBack:we,resetEmulator:pe}}),Mt={key:1,class:"px-4 py-2"},Rt=ne({__name:"UnitCard",props:{unit:{},loading:{type:Boolean}},setup(E){const e=E,d=Ge(),h=he(),{saveAnswer:a,setSubmitable:T}=h;function $(i){e.unit.unitType=="options"?T(i.options.length>0):e.unit.unitType=="open"&&T(i.open.length>0),a(e.unit.id,i),D(i)}const D=Ve(i=>{o(i)},1e3,{maxWait:5e3});async function o(i){await ie.saveUnitByIdandLessonId(e.unit.id,Number(d.params.id),{answer:i})}const l=V(()=>{var i;return(i=e.unit.content)!=null&&i.answer?Array.isArray(e.unit.content.answer)?e.unit.content.answer.length>0:typeof e.unit.content.answer=="string"?e.unit.content.answer.trim()!=="":!0:!1});return(i,A)=>{const x=Le;return n(),c("div",null,[i.loading?(n(),G(x,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),c("div",Mt,[e.unit.unitType=="article"?(n(),G(s(mt),{key:0,article:e.unit.content},null,8,["article"])):e.unit.unitType=="options"?(n(),G(s(yt),{key:1,"options-data":e.unit.content,state:e.unit.studentState,onSaveAnswer:$},null,8,["options-data","state"])):e.unit.unitType=="open"?(n(),G(s(wt),{key:2,state:e.unit.studentState,onSaveAnswer:$},null,8,["state"])):e.unit.unitType=="video"?(n(),G(s(bt),{key:3,video:e.unit.content},null,8,["video"])):e.unit.unitType=="tinkercad"?(n(),G(s(_t),{key:4,tinkercad:e.unit.content},null,8,["tinkercad"])):U("",!0),l.value?(n(),G(s(Dt),{key:5,unitType:e.unit.unitType,unitContent:e.unit.content},null,8,["unitType","unitContent"])):U("",!0)]))])}}}),Ht={key:1,class:"flex flex-col h-full w-full"},Vt={class:"flex-grow flex flex-col gap-4 px-4 py-2"},Ft=ne({__name:"GroupCard",props:{group:{},loading:{type:Boolean}},setup(E){const e=E,d=v(null);return ce(()=>e.loading,h=>{h===!1&&d.value&&requestAnimationFrame(()=>{var a;(a=d.value)==null||a.scrollIntoView({behavior:"smooth",block:"start"})})}),(h,a)=>{const T=Le;return n(),c("div",{ref_key:"groupRef",ref:d},[h.loading?(n(),G(T,{key:0,class:"flex justify-center items-center w-10 h-full"})):(n(),c("div",Ht,[u("div",Vt,[(n(!0),c(se,null,ge(h.group.units,$=>(n(),G(Rt,{key:$.id,unit:$},null,8,["unit"]))),128))])]))],512)}}}),qt={key:0,class:"absolute right-0"},Nt=10,Wt=15,Ot=8,Yt=ne({__name:"UnitsView",props:{pages:{}},setup(E){const e=he(),{groups:d,isGroupLoading:h,pageIndex:a}=ue(e),{loadInitialGroup:T,resetGroup:$,pageBack:D}=e,o=Ee(),l=v(null),i=v(null),A=v(0),x=v(!1),w=v(!1),g=v(null);function M(m){let b=m;for(;b&&b.parentElement;){const L=b.parentElement,B=getComputedStyle(L).overflowY;if(B==="auto"||B==="scroll")return L;b=L}return null}async function k(){await Pe();const m=M(l.value),b=i.value;if(!m||!b){A.value=0;return}const L=m.clientHeight,z=b.getBoundingClientRect().height,B=Math.max(0,L-z-16);A.value=B}function N(m,b){var B;const L=(B=d.value[d.value.length-1])==null?void 0:B.id;let z=null;m&&(m instanceof Element?z=m:m.$el instanceof Element&&(z=m.$el)),i.value=b.id===L?z:null}Me(()=>{T(),k(),window.addEventListener("resize",k),g.value=M(l.value),g.value&&g.value.addEventListener("scroll",P)}),Re(()=>{window.removeEventListener("resize",k),g.value&&g.value.removeEventListener("scroll",P)}),ce(()=>d.value.length,async()=>{await k()}),ce(()=>h.value,async(m,b)=>{b===!0&&m===!1&&await k()});const R=v(!1),H=v(-40);function P(){if(!g.value)return;const m=g.value.scrollTop,b=2;if(m<=b&&a.value>0){R.value=!0;const L=40;H.value=Math.min(Nt,-L+L*(b-m)/b)}else R.value=!1,H.value=-40}async function F(){if(w.value||!g.value)return;w.value=!0;const m=g.value,b=m.scrollHeight,L=m.scrollTop;D(),await Pe();const B=m.scrollHeight-b;m.scrollTop=L+B,w.value=!1,x.value=!1}return(m,b)=>{const L=Ae,z=De;return n(),c("div",{ref_key:"rootEl",ref:l,class:"flex flex-col gap-2"},[Se(u("div",{class:"absolute left-0 right-0 z-[9] flex justify-center pointer-events-auto",style:re([{transition:"transform 0.25s ease, opacity 0.25s ease"},{transform:`translateY(${H.value}px)`,opacity:R.value?1:0}])},[y(L,{icon:"pi pi-arrow-left",label:w.value?"–ó–∞–≥—Ä—É–∑–∫–∞...":"–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É",severity:"secondary",size:"small",onClick:F,loading:w.value,disabled:w.value},null,8,["label","loading","disabled"])],4),[[lt,R.value]]),u("div",{style:re({paddingTop:Math.max(0,H.value+Wt+Ot)+"px"}),class:"flex flex-col gap-2 smooth-padding"},[(n(!0),c(se,null,ge(s(d),B=>(n(),c("div",{key:B.id,ref_for:!0,ref:X=>N(X,B),class:"relative"},[!s(h)&&s(o).userRole=="editor"?(n(),c("div",qt,[Se((n(),G(L,{type:"button",class:"w-9 h-9 mr-8 mt-2",rounded:"",severity:"secondary",variant:"text",onClick:X=>s($)(B.id)},{default:q(()=>b[0]||(b[0]=[u("span",{class:"material-icons"},"restart_alt",-1)])),_:2},1032,["onClick"])),[[z,"Reset step",void 0,{left:!0}]])])):U("",!0),y(Ft,{group:B,loading:s(h)&&B.id==s(d)[s(d).length-1].id},null,8,["group","loading"])]))),128)),u("div",{style:re({height:A.value+"px"})},null,4)],4)],512)}}}),Kt=Fe(Yt,[["__scopeId","data-v-9729a5b9"]]),Jt={key:0,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},Qt={key:1},Xt={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},Zt={class:"text-lg font-bold flex items-center gap-2"},es={key:"incorrect",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-red-100"},ts={key:"no-submit",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},ss={key:"try-again",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-gray-50"},ns={class:"text-lg font-bold flex items-center gap-2"},os={key:2},as={key:"correct",class:"flex justify-center items-center w-full min-h-24 px-8 gap-8 bg-green-100"},ls={class:"text-lg font-bold flex items-center gap-2"},is={key:1,class:"flex justify-center items-center w-full min-h-24 px-8 gap-8"},rs=ne({__name:"NavigationBar",setup(E){const e=he(),{isSubmitLoading:d,groupStatus:h,isGroupLoading:a,submitExist:T,correct:$,submitEnabled:D}=ue(e),{submitGroup:o,nextGroup:l,tryAgain:i,finishLesson:A}=e;return(x,w)=>{const g=Ae;return n(),c(se,null,[s(h)=="check"?(n(),c("div",Jt,[y(g,{label:x.$t("check").toUpperCase(),icon:"pi pi-check","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(o),loading:s(d),disabled:s(d)||!s(D)},null,8,["label","onClick","loading","disabled"])])):U("",!0),s(h)=="continue"?(n(),c("div",Qt,[y(Te,{name:"pop",appear:"",mode:"out-in"},{default:q(()=>[s(T)&&s($)?(n(),c("div",Xt,[u("div",Zt,[w[0]||(w[0]=u("span",{class:"text-3xl"},"üéâ",-1)),xe(" "+Q(x.$t("correct"))+"! ",1)]),y(g,{label:x.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(l),loading:s(a),disabled:s(a)},null,8,["label","onClick","loading","disabled"])])):s(T)&&!s($)?(n(),c("div",es,[y(g,{label:x.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(l),loading:s(a),disabled:s(a)},null,8,["label","onClick","loading","disabled"])])):(n(),c("div",ts,[y(g,{label:x.$t("continue").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(l),loading:s(a),disabled:s(a)},null,8,["label","onClick","loading","disabled"])]))]),_:1})])):U("",!0),y(Te,{name:"shake",appear:""},{default:q(()=>[s(h)=="try-again"?(n(),c("div",ss,[u("div",ns,[w[1]||(w[1]=u("span",{class:"text-3xl"},"‚ö†Ô∏è",-1)),xe(" "+Q(x.$t("incorrect"))+"! ",1)]),y(g,{label:x.$t("tryAgain").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",severity:"contrast",class:"w-56 rounded-3xl",onClick:s(i)},null,8,["label","onClick"])])):U("",!0)]),_:1}),s(h)=="finish"?(n(),c("div",os,[s(T)&&s($)?(n(),c("div",as,[u("div",ls,[w[2]||(w[2]=u("span",{class:"text-3xl"},"üéâ",-1)),xe(" "+Q(x.$t("correct"))+"!",1)]),y(g,{label:x.$t("finish").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(A),loading:s(a),disabled:s(a)},null,8,["label","onClick","loading","disabled"])])):(n(),c("div",is,[y(g,{label:x.$t("finish").toUpperCase(),icon:"pi pi-arrow-right","icon-pos":"right",size:"large",class:"w-56 rounded-3xl",onClick:s(A)},null,8,["label","onClick"])]))])):U("",!0)],64)}}}),us=Fe(rs,[["__scopeId","data-v-4f5f4e6c"]]),cs={key:0,class:"h-screen bg-white flex flex-col items-center overflow-hidden relative"},ds={class:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 max-w-[1920px] mx-auto"},ps={class:"flex justify-between items-center w-full min-h-16 px-8 gap-8"},vs={class:"flex items-center gap-4"},fs={key:0,class:"flex flex-grow max-w-screen-lg items-center gap-4"},gs={class:"flex-1 overflow-y-auto mt-16 mb-24 w-full"},hs={key:1,class:"flex justify-center"},ms={key:2},ys={key:3,class:"fixed top-32 right-0 pl-2 pr-4 py-2 bg-white rounded-tl-lg rounded-bl-lg shadow-md z-[1000] border border-gray-200 flex flex-col items-center gap-4"},ws={key:4,class:"fixed top-20 right-4 bg-white rounded-lg shadow-md z-50 border border-gray-200 p-4 min-w-64"},bs={class:"flex items-center gap-3 mb-2"},_s={class:"fixed bottom-0 left-0 right-0 z-50 bg-transparent shadow-md max-w-[1920px] mx-auto"},xs={key:0,class:"absolute left-0 top-1/2 -translate-y-1/2"},ks={class:"relative h-full"},Cs={class:"absolute -right-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},$s={key:1,class:"absolute right-0 top-1/2 -translate-y-1/2"},Ss={class:"relative h-full"},Ts={class:"absolute -left-0 top-1/2 -translate-y-1/2 w-5 h-10 z-10"},Ls={key:0,class:"absolute right-0 top-0 z-10 h-[38px] p-[1px]"},Es={key:0,class:"h-screen flex flex-col items-center justify-center overflow-hidden gap-10"},As={class:"flex flex-col items-center"},Bs={class:"text-4xl font-bold mb-8"},Is={class:"text-md text-gray-500"},cn=ne({__name:"LessonPage",setup(E){const e=Ge(),d=ut(),h=Ee(),a=He(),{lang:T}=ue(a);ce(T,async(S,r)=>{S!==r&&o.value&&await m(Number(e.params.id),(e.query.route_id??"").toString())});const $=he(),{isLessonLoading:D,selectedLesson:o,pageProgress:l,groupStatus:i,emulatorID:A,neededModules:x,slots:w,pibodyDrawerVisible:g,codeDrawerVisible:M,showPibody:k,showCode:N,isPreloadingUnits:R,preloadingProgress:H,answersCache:P,startingCodeExist:F}=ue($),{loadLessonById:m,runCodePressed:b,saveStudentIdeState:L,pageBack:z,resetEmulator:B}=$;function X(S){var j;const r=((j=o.value)==null?void 0:j.pages.reduce((K,J)=>K+J.groups.length,0))||1;return S/r*100}function de(){var S;((S=o.value)==null?void 0:S.lessonType)=="module"?d.push("/v2/docs"):e.query.route_id&&e.query.route_id!=""?d.push("/v2/route/"+e.query.route_id):h.userRole=="editor"?d.push("/v2/routes"):d.push("/v2/home")}ce(w,()=>{O({slots:w.value})});const O=Ve(S=>{L(S)},1e3,{maxWait:5e3});function me(S){O({slots:w.value})}const Z=v(window.innerWidth),Y=v(16);function ee(){if(Z.value=window.innerWidth,Z.value<=1300){Y.value=16;return}const r=452-(Z.value-1024)/2;Y.value=r>16?r:16}Me(async()=>{var S,r;i.value="continue",ee(),await m(Number(e.params.id),(e.query.route_id??"").toString()),((S=o.value)==null?void 0:S.lessonType)=="project"&&d.push({path:e.path.replace("/lesson/","/project/"),query:e.query}),((r=o.value)==null?void 0:r.studentProgress)==100&&h.userRole!="editor"&&d.push({path:`${e.path}/revise`,query:e.query}),window.addEventListener("resize",ee),window.addEventListener("beforeunload",pe)}),it(()=>{window.removeEventListener("resize",ee)});const oe=V(()=>Z.value<=1920?{}:"calc((-100vw + 1920px) / 2)"),ye=()=>{d.push(`${e.path}/edit`)};Re(()=>{window.removeEventListener("beforeunload",pe)});function pe(S){if(i.value!="completed"&&P.value.size>0)return S.preventDefault(),!0}return(S,r)=>{const j=Ae,K=tt,J=Le,ve=et,we=De;return n(),c(se,null,[s(i)!="completed"?(n(),c("div",cs,[u("div",ds,[u("div",ps,[u("div",vs,[y(j,{icon:"pi pi-times",variant:"text",severity:"contrast",onClick:de})]),s(o)?(n(),c("div",fs,[(n(!0),c(se,null,ge(s(o).pages,(I,fe)=>(n(),c("div",{key:fe,class:"h-full",style:re({width:X(I.groups.length)+"%"})},[y(K,{value:s(l)[fe]/I.groups.length*100,"show-value":!1,class:"w-full rounded-full h-3"},null,8,["value"])],4))),128))])):U("",!0),r[9]||(r[9]=u("div",{class:"w-10"},null,-1))])]),u("div",gs,[u("div",{class:"w-full h-full max-w-screen-lg mx-auto",style:re({paddingLeft:Y.value+"px",paddingRight:Y.value+"px"})},[s(D)?(n(),G(J,{key:0,class:"flex justify-center"})):s(o)?(n(),c("div",ms,[y(Kt,{pages:s(o).pages},null,8,["pages"])])):(n(),c("div",hs,"No lesson found")),s(h).userRole=="editor"?(n(),c("div",ys,[y(s(vt)),y(j,{icon:"pi pi-pencil",variant:"text",severity:"contrast",onClick:ye}),y(j,{variant:"text",severity:"contrast",onClick:s(z)},{default:q(()=>r[10]||(r[10]=[u("span",{class:"material-icons"},"swipe_left_alt",-1)])),_:1},8,["onClick"])])):U("",!0),s(R)?(n(),c("div",ws,[u("div",bs,[y(J,{style:{width:"20px",height:"20px"}}),r[11]||(r[11]=u("span",{class:"text-sm font-medium"},"Preloading units...",-1))]),y(K,{value:s(H),"show-value":!0,class:"h-2"},null,8,["value"])])):U("",!0)],4)]),u("div",_s,[y(us)]),s(k)?(n(),c("div",xs,[y(j,{icon:"pi pi-microchip",severity:"secondary",onClick:r[0]||(r[0]=I=>g.value=!0),class:"w-8 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg mt-16"}),y(ve,{visible:s(g),"onUpdate:visible":r[4]||(r[4]=I=>le(g)?g.value=I:null),modal:!1,dismissable:!1,closeOnEscape:!1,class:"h-[calc(100vh-64px)] w-fit mt-16",pt:{root:{style:`right: ${oe.value}`}}},{header:q(()=>r[12]||(r[12]=[u("div",null,null,-1)])),container:q(()=>[u("div",ks,[u("div",Cs,[y(j,{icon:"pi pi-chevron-left",severity:"secondary",onClick:r[1]||(r[1]=I=>g.value=!1),class:"w-5 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none"})]),(n(),G(s(ct),{id:s(A),key:s(A),slots:s(w),"onUpdate:slots":r[2]||(r[2]=I=>le(w)?w.value=I:null),neededModules:s(x),"onUpdate:neededModules":r[3]||(r[3]=I=>le(x)?x.value=I:null),class:"w-full",horizontal:!1,autoPut:!0},null,8,["id","slots","neededModules"]))])]),_:1},8,["visible","pt"])])):U("",!0),s(N)?(n(),c("div",$s,[y(j,{icon:"pi pi-code",severity:"secondary",onClick:r[5]||(r[5]=I=>M.value=!0),class:"w-8 rounded-tl-lg rounded-bl-lg rounded-tr-none rounded-br-none mt-16"}),y(ve,{visible:s(M),"onUpdate:visible":r[8]||(r[8]=I=>le(M)?M.value=I:null),header:"Drawer",modal:!1,dismissable:!1,closeOnEscape:!1,position:"right",class:"h-[calc(100vh-64px)] w-[452px] mt-16",pt:{root:{style:`left: ${oe.value}`}}},{header:q(()=>r[13]||(r[13]=[u("div",null,null,-1)])),container:q(()=>[u("div",Ss,[u("div",Ts,[y(j,{icon:"pi pi-chevron-right",severity:"secondary",onClick:r[6]||(r[6]=I=>M.value=!1),class:"w-5 rounded-tl-none rounded-bl-none rounded-tr-lg rounded-br-lg"})]),s(F)?(n(),c("div",Ls,[Se(y(j,{icon:"pi pi-replay",variant:"link",onClick:s(B),class:"h-[36px] rounded-lg text-sm"},null,8,["onClick"]),[[we,S.$t("revertToStartingCode")]])])):U("",!0),(n(),G(rt,null,[(n(),G(s(pt),{id:s(A),key:s(A),connectbuttons:s(k),"onUpdate:connectbuttons":r[7]||(r[7]=I=>le(k)?k.value=I:null),onRun:s(b),onSaveAnswer:me},null,8,["id","connectbuttons","onRun"]))],1024))])]),_:1},8,["visible","pt"])])):U("",!0)])):U("",!0),y(Te,{"enter-active-class":"transition duration-500 ease-out","enter-from-class":"opacity-0 scale-90","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-300 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-90"},{default:q(()=>[s(i)=="completed"?(n(),c("div",Es,[r[14]||(r[14]=u("div",{class:"text-5xl"},"‚ö°Ô∏è",-1)),u("div",As,[u("div",Bs,Q(S.$t("goodWork")),1),u("div",Is,Q(S.$t("keepLearning")),1)]),u("div",null,[y(j,{label:S.$t("continue"),class:"rounded-full w-56 text-xl",onClick:de},null,8,["label"])])])):U("",!0)]),_:1})],64)}}});export{cn as default};
