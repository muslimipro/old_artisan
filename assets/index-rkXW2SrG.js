import{s as Le,a as Ne}from"./index-BHK97OKv.js";import{d as Pe,r as g,b as J,o as l,c as n,i as e,j as a,t as s,H as u,x as ve,F as A,k as D,q as N,l as ee,p as O,D as q,n as Z,h as b,w as Ie,u as De,Q as Oe,e as ge,g as Ae,E as be,I as Ge,C as je}from"./index-BNOYZ_6B.js";import{_ as ze}from"./MainHeader.vue_vue_type_script_setup_true_lang-BuEgZxiR.js";import{_ as We}from"./PibodyViewer.vue_vue_type_script_setup_true_lang-hgkByV1x.js";import{l as Xe,O as T,v as oe,a as He,I as m,b as H,f as Je,u as Ke,d as Te,g as ye,h as he,i as Qe,j as Ye,e as ne,k as Ze,m as et,n as V,o as tt,p as st,q as ke,R as ce,r as we}from"./CodeEditorView.vue_vue_type_script_setup_true_lang-DPho1RON.js";import{o as W,v as qe,b as X,M as ie,m as $e,P as ue,p as Ce,c as de,i as $,a as at,u as lt}from"./store-DTC7bVf7.js";import{s as xe}from"./index-fTHW6IpW.js";import{s as ot}from"./index-AewrWF-b.js";import{s as nt}from"./index-nGXgVu-X.js";import{s as ct}from"./index-C_e8lvdO.js";import{U as pe}from"./unitApi-CO-UTFqE.js";import{m as dt}from"./mapUnitFromDto-DJ2zlrQL.js";import{C as re}from"./cloudStorageApi-DS2KYLed.js";import{u as rt}from"./index-fSFpeyui.js";import"./index-CoDkBE5V.js";import"./index-DlyffbqJ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CNPyJFLZ.js";import"./logo-D1-3uCnC.js";import"./SimulationView-C13y6_Wx.js";import"./index-BjTXdGTl.js";import"./index-C4TRSEyf.js";import"./index-B1Mvx7RV.js";import"./index-DgBnIJKd.js";import"./index-SW19hvKn.js";import"./index-EmM3D-m5.js";import"./index-Ym3p4DeK.js";import"./index-BTepqiGI.js";const it=Pe("useMPDeviceStore",()=>{const t=g(localStorage.getItem("fileContent")||""),c=g(""),r=g(""),C=g(!1),o=g([]);async function y(x,h){o.value=[x],r.value=x,t.value=h}async function p(x){o.value=[x],r.value=x,t.value=await Xe(x)}function P(x){t.value=x}return{isProject:C,activeFiles:o,fileContent:t,fileName:c,filePath:r,openFile:y,loadFile:p,setCode:P}}),ut={key:0,class:"text-nowrap"},mt={key:0,class:"text-white"},vt={key:1,class:"text-white"},xt={key:2,class:"text-white"},ft={key:3,class:"text-white"},gt={key:4,class:"text-white"},bt={key:5,class:"text-black w-full"},yt={class:"text-center font-mono px-1 text-white bg-black"},ht={key:6,class:"text-black w-full"},kt={class:"text-center font-mono px-1 text-white bg-black"},wt={key:7,class:"text-black w-full p-3"},qt={key:8,class:"text-white"},$t={key:9,class:"text-black w-full"},Ct={class:"text-center font-mono px-1 text-white bg-black"},pt={key:10,class:"text-white w-full"},_t={key:11,class:"text-white w-full"},Mt={key:12,class:"text-white w-full"},Pt={key:13,class:"text-white w-full"},It={key:14,class:"text-black w-full"},Tt={class:"text-center font-mono px-1 text-white bg-black"},Et={key:15,class:"text-black w-full"},Rt={class:"text-center px-1"},St={class:"text-center font-mono px-1 text-white bg-black"},Ut={key:16,class:"text-black w-full"},Ft={class:"text-center px-1"},Bt={class:"text-center font-mono px-1 text-white bg-black"},Vt={key:17,class:"text-black w-full"},Lt={class:"text-center px-1"},Nt={class:"text-center font-mono px-1 text-white bg-black"},Dt={key:18,class:"text-black w-full"},Ot={class:"text-center font-mono px-1 text-white bg-black"},At={key:19,class:"text-black w-full"},Gt={class:"text-center px-1"},jt={class:"text-center font-mono px-1 text-white bg-black"},zt={key:20,class:"text-black w-full"},Wt={class:"text-center px-1"},Xt={class:"text-center font-mono px-1 text-white bg-black"},Ht={key:21,class:"text-black w-full"},Jt={class:"text-center px-1"},Kt={class:"text-center font-mono px-1 text-white bg-black"},Qt={key:22,class:"text-black w-full"},Yt={class:"text-center font-mono px-1 text-white bg-black"},Zt={key:23,class:"text-black w-full"},es={class:"text-center px-1"},ts={class:"text-center font-mono px-1 text-white bg-black"},ss={key:24,class:"text-black w-full"},as={class:"text-center font-mono px-1 text-white bg-black"},ls={key:25,class:"text-black w-full"},os={class:"text-center px-1"},ns={class:"text-center font-mono px-1 text-white bg-black"},cs={key:26,class:"text-black w-full"},ds={class:"text-center font-mono px-1 text-white bg-black"},rs={key:27,class:"text-black w-full"},is={class:"text-center px-1"},us={class:"text-center font-mono px-1 text-white bg-black"},ms={key:28,class:"text-black w-full"},vs={class:"text-center px-1"},xs={class:"text-center font-mono px-1 text-white bg-black"},fs={key:29,class:"text-black w-full"},gs={key:1,class:"text-center p-3"},me=J({__name:"FeedbackNode",props:{message:{type:Object,required:!0},isExpected:{type:Boolean,required:!0}},setup(t){return(c,r)=>t.message?(l(),n("div",ut,[t.message.command===e(T).PinSetValue?(l(),n("div",mt,[a("div",{style:u({background:e(W)}),class:"text-center font-mono px-1"},s(e(oe)(t.message,t.isExpected))+" set value",5),a("div",{style:u(e(X)(t.message.request.value)),class:"text-center font-mono px-1"}," Value "+s(e(qe)(t.message.request.value)),5)])):t.message.command===e(T).PinSetMode?(l(),n("div",vt,[a("div",{style:u({background:e(W)}),class:"text-center font-mono px-1"},s(e(oe)(t.message,t.isExpected))+" set mode",5),a("div",{style:u({background:e($e)[t.message.request.mode]}),class:"text-center font-mono px-1"}," Mode "+s(e(ie)[t.message.request.mode]),5)])):t.message.command===e(T).PinSetPull?(l(),n("div",xt,[a("div",{style:u({background:e(W)}),class:"text-center font-mono px-1"},s(e(oe)(t.message,t.isExpected))+" set pull",5),a("div",{style:u({background:e(Ce)[t.message.request.pull]}),class:"text-center font-mono px-1"}," Pull "+s(e(ue)[t.message.request.pull]),5)])):t.message.command===e(T).PwmDutyU16?(l(),n("div",ft,[a("div",{style:u({background:e(W)}),class:"text-center font-mono px-1"},"PWM "+s(t.message.request.pin)+" set duty",5),a("div",{style:u(e(X)(t.message.request.duty_u16/e(de))),class:"text-center font-mono px-1"}," u16 "+s(t.message.request.duty_u16),5)])):t.message.command===e(T).PwmFreq?(l(),n("div",gt,[a("div",{style:u({background:e(W)}),class:"text-center font-mono px-1"},"PWM "+s(t.message.request.pin)+" set freq",5),a("div",{style:u(e(X)(t.message.request.freq/e(de))),class:"text-center font-mono px-1"}," Freq "+s(t.message.request.freq),5)])):t.message.command===e(T).Output?(l(),n("div",bt,[r[0]||(r[0]=a("div",{class:"text-center px-1"},"Print",-1)),a("div",yt,s(t.message.request.output),1)])):t.message.command===e(T).Sleep?(l(),n("div",ht,[r[1]||(r[1]=a("div",{class:"text-center px-1"},"Sleep",-1)),a("div",kt,s(t.message.request.time_ms)+" ms",1)])):t.message.command===e(He).Timeout?(l(),n("div",wt," Timeout ")):t.message.command===e(T).NeoPixelWrite?(l(),n("div",qt,[a("div",{style:u({background:e(W)}),class:"text-center font-mono px-1"},"NeoPixel "+s(t.message.request.pin)+" write pixels",5),a("div",{style:u(e(X)(0)),class:"text-center font-mono px-1"}," pixels("+s(t.message.request.pixels.length)+") ",5)])):t.message.command===e(T).DisplayText?(l(),n("div",$t,[r[2]||(r[2]=a("div",{class:"text-center px-1"},"Display print",-1)),a("div",Ct,s(t.message.request.text),1)])):t.message.command===e(m).PinGetValue?(l(),n("div",pt,[a("div",{style:u({background:e($)}),class:"text-center font-mono px-1"},s(e(H)(t.message.request,t.message.meta,t.isExpected))+" get value",5),a("div",{style:u(e(X)(t.message.result)),class:"text-center font-mono px-1"}," Value "+s(e(qe)(t.message.result)),5)])):t.message.command===e(m).PinGetMode?(l(),n("div",_t,[a("div",{style:u({background:e($)}),class:"text-center font-mono px-1"},s(e(H)(t.message.request,t.message.meta,t.isExpected))+" get mode",5),a("div",{style:u({background:e($e)[t.message.result]}),class:"text-center font-mono px-1"}," Mode "+s(e(ie)[t.message.result]),5)])):t.message.command===e(m).PinGetPull?(l(),n("div",Mt,[a("div",{style:u({background:e($)}),class:"text-center font-mono px-1"},s(e(H)(t.message.request,t.message.meta,t.isExpected))+" get pull",5),a("div",{style:u({background:e(Ce)[t.message.result]}),class:"text-center font-mono px-1"}," Pull "+s(e(ue)[t.message.result]),5)])):t.message.command===e(m).AdcReadU16?(l(),n("div",Pt,[a("div",{style:u({background:e($)}),class:"text-center font-mono px-1"},"ADC "+s(t.message.request.pin)+" read",5),a("div",{style:u(e(X)(t.message.result/e(de))),class:"text-center font-mono px-1"}," u16 "+s(t.message.result),5)])):t.message.command===e(m).Input?(l(),n("div",It,[r[3]||(r[3]=a("div",{class:"text-center px-1"},"Input",-1)),a("div",Tt,s(t.message.result),1)])):t.message.command===e(m).I2CScan?(l(),n("div",Et,[a("div",Rt,"I2CScan sda:"+s(t.message.request.sda)+" scl: "+s(t.message.request.scl),1),a("div",St,s(t.message.result),1)])):t.message.command===e(m).I2CReadFromMem?(l(),n("div",Ut,[a("div",Ft,"I2CReadFromMem sda:"+s(t.message.request.sda)+" scl: "+s(t.message.request.scl)+" addr:"+s(t.message.request.addr)+" memaddr:"+s(t.message.request.memaddr)+" nbytes:"+s(t.message.request.nbytes),1),a("div",Bt,s(t.message.result),1)])):t.message.command===e(T).I2CWriteToMem?(l(),n("div",Vt,[a("div",Lt,"I2CWriteToMem sda:"+s(t.message.request.sda)+" scl: "+s(t.message.request.scl)+" addr:"+s(t.message.request.addr)+" memaddr:"+s(t.message.request.memaddr),1),a("div",Nt,s(t.message.request.buf),1)])):t.message.command===e(T).BME280Init?(l(),n("div",Dt,[r[4]||(r[4]=a("div",{class:"text-center px-1"},"BME280 init",-1)),a("div",Ot," sda:"+s(t.message.request.sda)+" scl:"+s(t.message.request.scl),1)])):t.message.command===e(m).BME280ReadTemperature?(l(),n("div",At,[a("div",Gt,"BME280 "+s(t.message.request.sda)+" "+s(t.message.request.scl)+" read temperature",1),a("div",jt,s(t.message.result)+" °C ",1)])):t.message.command===e(m).BME280ReadPressure?(l(),n("div",zt,[a("div",Wt,"BME280 "+s(t.message.request.sda)+" "+s(t.message.request.scl)+" read pressure",1),a("div",Xt,s(t.message.result)+" Pa ",1)])):t.message.command===e(m).BME280ReadHumidity?(l(),n("div",Ht,[a("div",Jt,"BME280 "+s(t.message.request.sda)+" "+s(t.message.request.scl)+" read humidity",1),a("div",Kt,s(t.message.result)+" % ",1)])):t.message.command===e(T).VEML6040Init?(l(),n("div",Qt,[r[5]||(r[5]=a("div",{class:"text-center px-1"},"VEML6040 init",-1)),a("div",Yt," sda:"+s(t.message.request.sda)+" scl:"+s(t.message.request.scl),1)])):t.message.command===e(m).VEML6040ReadRGB?(l(),n("div",Zt,[a("div",es,"VEML6040 "+s(t.message.request.sda)+" "+s(t.message.request.scl)+" read rgb",1),a("div",ts," r:"+s(t.message.result[0])+" g:"+s(t.message.result[1])+" b:"+s(t.message.result[2]),1)])):t.message.command===e(T).VL53L0XInit?(l(),n("div",ss,[r[6]||(r[6]=a("div",{class:"text-center px-1"},"VL53L0X init",-1)),a("div",as," sda:"+s(t.message.request.sda)+" scl:"+s(t.message.request.scl),1)])):t.message.command===e(m).VL53L0XRead?(l(),n("div",ls,[a("div",os,"VL53L0X "+s(t.message.request.sda)+" "+s(t.message.request.scl)+" read",1),a("div",ns," distance:"+s(t.message.result)+" mm ",1)])):t.message.command===e(T).MPU6050Init?(l(),n("div",cs,[r[7]||(r[7]=a("div",{class:"text-center px-1"},"MPU6050 init",-1)),a("div",ds," sda:"+s(t.message.request.sda)+" scl:"+s(t.message.request.scl),1)])):t.message.command===e(m).MPU6050ReadAccel?(l(),n("div",rs,[a("div",is,"MPU6050 "+s(t.message.request.sda)+" "+s(t.message.request.scl)+" read accel",1),a("div",us," ax:"+s(t.message.result[0]/16384)+" ay:"+s(t.message.result[1]/16384)+" az:"+s(t.message.result[2]/16384),1)])):t.message.command===e(m).MPU6050ReadGyro?(l(),n("div",ms,[a("div",vs,"MPU6050 "+s(t.message.request.sda)+" "+s(t.message.request.scl)+" read gyro",1),a("div",xs," gx:"+s(t.message.result[0]/131)+" gy:"+s(t.message.result[1]/131)+" gz:"+s(t.message.result[2]/131),1)])):(l(),n("div",fs," Todo: "+s(t.message.command),1))])):(l(),n("div",gs," Nothing "))}}),bs={class:"flex-col overflow-auto"},ys={class:"flex"},hs={key:0,class:"flex text-white border-2 border-blue-500"},ks={class:"text-black text-nowrap"},ws={key:1,class:"flex text-white border-2 border-blue-500"},qs={class:"text-black text-nowrap"},$s={key:2,class:"flex text-white border-2 border-blue-500"},Cs={class:"text-black text-nowrap"},ps={key:3,class:"flex text-white border-2 border-blue-500"},_s={class:"text-black text-nowrap"},Ms={key:4,class:"flex text-white border-2 border-blue-500"},Ps={class:"text-black text-nowrap"},Is={key:5,class:"flex text-white border-2 border-blue-500"},Ts={class:"text-black text-nowrap"},Es={key:6,class:"flex text-white border-2 border-blue-500"},Rs={class:"text-black text-nowrap"},Ss={key:7,class:"flex text-white border-2 border-blue-500"},Us={class:"text-black text-nowrap"},Fs={key:8,class:"flex text-white border-2 border-blue-500"},Bs={class:"text-black text-nowrap"},Vs={key:9,class:"flex text-white border-2 border-blue-500"},Ls={class:"text-black text-nowrap"},Ns={key:10,class:"flex text-white border-2 border-blue-500"},Ds={class:"text-black text-nowrap"},Os={key:11,class:"flex text-white border-2 border-blue-500"},As={class:"text-black text-nowrap"},Gs={key:12,class:"flex text-white border-2 border-blue-500"},js={class:"text-black text-nowrap"},zs={key:13,class:"flex text-white border-2 border-blue-500"},Ws={class:"text-black text-nowrap"},Xs={key:14,class:"flex text-black border-2 border-blue-500"},Ee=J({__name:"Inputs",props:{inputs:{},isExpected:{type:Boolean}},setup(t){const c=ve(()=>{const r=[];for(const[C,o]of t.inputs){const y=Je(C);r.push({...y,result:o})}return r});return(r,C)=>(l(),n(A,null,[c.value.length===0?(l(),n(A,{key:0},[D("Nothing")],64)):N("",!0),a("div",bs,[(l(!0),n(A,null,ee(c.value,o=>(l(),n("div",ys,[o.command===e(m).PinGetValue?(l(),n("div",hs,[a("div",{style:u({background:e($)}),class:"text-center text-nowrap font-mono px-1"},s(e(H)(o.request,o.meta,r.isExpected))+" get value: ",5),a("div",ks,s(o.result),1)])):o.command===e(m).PinGetMode?(l(),n("div",ws,[a("div",{style:u({background:e($)}),class:"text-center text-nowrap font-mono px-1"},s(e(H)(o.request,o.meta,r.isExpected))+" get mode: ",5),a("div",qs,s(o.result.map(y=>e(ie)[y])),1)])):o.command===e(m).PinGetPull?(l(),n("div",$s,[a("div",{style:u({background:e($)}),class:"text-center text-nowrap font-mono px-1"},s(e(H)(o.request,o.meta,r.isExpected))+" get pull: ",5),a("div",Cs,s(o.result.map(y=>e(ue)[y])),1)])):o.command===e(m).AdcReadU16?(l(),n("div",ps,[a("div",{style:u({background:e($)}),class:"text-center text-nowrap font-mono px-1"},"ADC "+s(o.request.pin)+" read u16:",5),a("div",_s,s(o.result),1)])):o.command===e(m).Input?(l(),n("div",Ms,[a("div",{style:u({background:e($)}),class:"text-center text-nowrap font-mono px-1"},"Console input:",4),a("div",Ps,s(o.result),1)])):o.command===e(m).I2CScan?(l(),n("div",Is,[a("div",{style:u({background:e($)}),class:"text-center text-nowrap font-mono px-1"},"I2CScan:",4),a("div",Ts,s(o.result),1)])):o.command===e(m).I2CReadFromMem?(l(),n("div",Es,[a("div",{style:u({background:e($)}),class:"text-center text-nowrap font-mono px-1"},"I2CReadFromMem:",4),a("div",Rs,s(o.result),1)])):o.command===e(m).BME280ReadTemperature?(l(),n("div",Ss,[a("div",{style:u({background:e($)}),class:"text-center text-nowrap font-mono px-1"}," BME280 "+s(o.request.sda)+" "+s(o.request.scl)+" read_temperature: ",5),a("div",Us,s(o.result),1)])):o.command===e(m).BME280ReadPressure?(l(),n("div",Fs,[a("div",{style:u({background:e($)}),class:"text-center text-nowrap font-mono px-1"}," BME280 "+s(o.request.sda)+" "+s(o.request.scl)+" read_pressure: ",5),a("div",Bs,s(o.result),1)])):o.command===e(m).BME280ReadHumidity?(l(),n("div",Vs,[a("div",{style:u({background:e($)}),class:"text-center text-nowrap font-mono px-1"}," BME280 "+s(o.request.sda)+" "+s(o.request.scl)+" read_humidity: ",5),a("div",Ls,s(o.result),1)])):o.command===e(m).VEML6040ReadRGB?(l(),n("div",Ns,[a("div",{style:u({background:e($)}),class:"text-center text-nowrap font-mono px-1"}," VEML6040 "+s(o.request.sda)+" "+s(o.request.scl)+" readRGB: ",5),a("div",Ds,s(o.result),1)])):o.command===e(m).VL53L0XRead?(l(),n("div",Os,[a("div",{style:u({background:e($)}),class:"text-center text-nowrap font-mono px-1"}," VL53L0X "+s(o.request.sda)+" "+s(o.request.scl)+" read: ",5),a("div",As,s(o.result),1)])):o.command===e(m).MPU6050ReadAccel?(l(),n("div",Gs,[a("div",{style:u({background:e($)}),class:"text-center text-nowrap font-mono px-1"}," MPU6050 "+s(o.request.sda)+" "+s(o.request.scl)+" read accel: ",5),a("div",js,s(o.result),1)])):o.command===e(m).MPU6050ReadGyro?(l(),n("div",zs,[a("div",{style:u({background:e($)}),class:"text-center text-nowrap font-mono px-1"}," MPU6050 "+s(o.request.sda)+" "+s(o.request.scl)+" read gyro: ",5),a("div",Ws,s(o.result),1)])):(l(),n("div",Xs,"TODO: "+s(o),1))]))),256))])],64))}}),Hs={class:"flex items-center gap-2"},Js={class:"font-bold"},Ks={class:"flex"},Qs=["onClick"],Ys={class:"text-center"},Zs={key:0,class:"text-center"},ea={key:0,class:"flex items-center justify-center h-20"},ta=J({__name:"FeedbackTimeline",props:{id:{},result:{}},setup(t){const c=t,{selectNode:r,selectedIndex:C,firstError:o}=Ke(c.id,c.result),y=ve(()=>Te(c.result.replayed)),p=g(null),P=g([]);return(x,h)=>{const E=Ie,R=xe;return l(),O(R,null,{header:q(()=>[a("div",Hs,[a("div",Js,s(x.$t("result")),1),c.result.success===!1?(l(),O(E,{key:0,severity:"danger",onClick:h[0]||(h[0]=_=>e(o)(P.value))},{default:q(()=>[D(s(x.$t("first error")),1)]),_:1})):N("",!0)])]),default:q(()=>[a("div",{ref_key:"scrollContainer",ref:p,class:"flex overflow-auto mb-2"},[(l(!0),n(A,null,ee(c.result.feedback,(_,F)=>{var f,L;return l(),n("div",Ks,[a("button",{class:Z(["flex",e(C)===F?"border border-blue-500":""]),onClick:G=>e(r)(F),ref_for:!0,ref:G=>P.value[F]=G},[a("div",Ys,[D(s(_.correct?x.$t("correct"):x.$t("incorrect"))+" ",1),b(me,{message:(f=_.replayed)==null?void 0:f.content,isExpected:!1,class:Z(["border-4 rounded-md",_.correct?"border-green-500":"border-red-500"])},null,8,["message","class"])]),_.correct?N("",!0):(l(),n("div",Zs,[h[1]||(h[1]=D(s("Expected")+" ")),b(me,{message:(L=_.expected)==null?void 0:L.content,isExpected:!0,class:Z(["border-4 rounded-md",_.correct?"border-red-500":"border-green-500"])},null,8,["message","class"])]))],10,Qs),F+1<c.result.feedback.length?(l(),n("div",ea,"→")):N("",!0)])}),256))],512),h[2]||(h[2]=D(" Input used: ")),b(Ee,{inputs:y.value,isExpected:!1},null,8,["inputs"])]),_:1})}}}),sa={class:"flex overflow-auto mb-2"},aa={class:"text-center"},la={key:0,class:"flex items-center justify-center h-12"},_e=J({__name:"TestDataTimeline",props:{data:{}},setup(t){const c=ve(()=>Te(t.data));return(r,C)=>{const o=xe;return l(),O(o,{header:"Expected"},{default:q(()=>[a("div",sa,[(l(!0),n(A,null,ee(r.data,(y,p)=>(l(),n("div",{class:"flex",key:p},[a("div",aa,[b(e(me),{message:y.content,isExpected:!0,class:"border-4 border-blue-500"},null,8,["message"])]),p+1<r.data.length?(l(),n("div",la,"→")):N("",!0)]))),128))]),C[0]||(C[0]=D(" Inputs: ")),b(e(Ee),{inputs:c.value,isExpected:!0},null,8,["inputs"])]),_:1})}}}),oa=Pe("tester-store",()=>{const t=De(),c=g(null),r=g(!1),C=g(!1),o=g(!1),y=g(!1),p=g(!1),P=g(0),x=g(0),h=g(null),E=g(""),R=g([]),_=g(),F=g(),f=g();async function L(d,i,I){try{r.value=!0;const{data:v}=await pe.getUnitByIdandLessonId(d,i);c.value=dt(v)}catch(v){t.add({severity:"error",summary:v.response.data.error,life:2e3})}finally{r.value=!1}try{if(c.value==null)return;if(P.value=i,x.value=d,c.value.unitType=="checklist"){if(I==null)return;h.value=I;const v=c.value.data;if(f.value=v.checks.find(S=>S.id===h.value),f.value==null)return;E.value=f.value.solution,R.value=await ye(f.value.tests),_.value=f.value.includedCommandsForTests??[...he],p.value=!0,y.value=!0;return}c.value.content&&(E.value=c.value.content.answer),c.value.data.tests&&(R.value=await ye(c.value.data.tests)),c.value.data.neededModules&&(F.value=c.value.data.neededModules),_.value=c.value.data.includedCommandsForTests??[...he],y.value=!0}catch(v){t.add({severity:"error",summary:v,life:2e3})}finally{r.value=!1}}async function G(d){if(!(x.value==null||P.value==null))try{C.value=!0,await pe.updateUnitByIdandLessonId(x.value,P.value,d)}catch(i){t.add({severity:"error",summary:i.response.data.error,life:2e3})}finally{C.value=!1}}async function U(){if(c.value!=null){o.value=!0;try{p.value?f.value&&(f.value.solution=E.value,f.value.includedCommandsForTests=_.value):(c.value.content.answer=E.value,c.value.data.includedCommandsForTests=_.value),await G({content:c.value.content,data:c.value.data})}catch(d){let i="";d instanceof Error?i=d.message:i=String(d),t.add({severity:"error",summary:"Failed to save",detail:i,life:3e3})}finally{o.value=!1}}}async function j(d){const i=JSON.stringify(d),I=new Blob([i],{type:"application/json"}),v=new FormData;v.append("file",I,"default.test.json");const{data:S}=await re.uploadFile(v,"tests");return S.source_url}async function te(d){if(c.value!=null)try{const i=await j(d);if(i==""){t.add({severity:"error",summary:"not saved",life:2e3});return}if(p.value){if(!f.value)return;f.value.tests?f.value.tests.push({name:"",url:i}):(f.value.tests=[],f.value.tests.push({name:"",url:i}))}else c.value.data.tests?c.value.data.tests.push({name:"",url:i}):(c.value.data.tests=[],c.value.data.tests.push({name:"",url:i}));R.value.push({data:d,test:{name:"",url:i}})}catch(i){t.add({severity:"error",summary:i.response.data.error,life:2e3})}}async function z(d){var i,I,v;if(c.value!=null)try{const S=R.value[d].test.url;if(await re.deleteFile(S),p.value){const ae=c.value.data;f.value=ae.checks.find(le=>le.id===h.value),f.value&&((i=f.value.tests)==null||i.splice(d,1))}else(v=(I=c.value)==null?void 0:I.data.tests)==null||v.splice(d,1);R.value.splice(d,1)}catch(S){t.add({severity:"error",summary:S.response.data.error,life:2e3})}}async function se(d,i){if(!c.value)return;let I;const v=await j(i);if(v==""){t.add({severity:"error",summary:"not saved",life:2e3});return}if(p.value){if(!f.value||!f.value.tests)return;I=f.value.tests[d].url,f.value.tests[d].url=v}else{if(!c.value.data.tests)return;I=c.value.data.tests[d].url,c.value.data.tests[d].url=v}R.value[d].test.url=v,R.value[d].data=i;try{await re.deleteFile(I)}catch(S){t.add({severity:"error",summary:S.response.data.error,life:2e3})}}return{selectedUnit:c,isUnitLoading:r,isInited:y,code:E,testsData:R,includedCommandsForTests:_,neededModules:F,loadUnitData:L,saveUnit:U,createTest:te,deleteTest:z,updateTest:se}}),na={class:"h-full flex flex-col"},ca={class:"p-4"},da={class:"flex w-full gap-1"},ra={class:"material-icons"},ia={class:"material-icons"},ua={class:"material-icons"},ma={class:"material-icons"},va={class:"material-icons"},xa={class:"flex flex-col gap-2 m-2 h-full overflow-auto"},fa={class:"flex gap-2 w-full"},ga=["for"],ba={class:"material-icons"},ya={class:"material-icons"},ha=J({__name:"TesterControls",props:{id:{},lesson_id:{},unit_id:{},check_id:{}},setup(t){const c=t,r=Oe(),C=oa(),{selectedUnit:o,isInited:y,code:p,neededModules:P,testsData:x,includedCommandsForTests:h}=ge(C),{saveUnit:E,loadUnitData:R,createTest:_,deleteTest:F,updateTest:f}=C;Ae(async()=>{try{if(await R(c.unit_id,c.lesson_id,c.check_id),!y)return;if(U.value=p.value,z.setCode(U.value),P.value)for(const k of P.value)k.module&&k.slot&&j.newModuleToSlot(k.module,k.slot)}catch(k){console.log(k)}});const L=rt(async()=>{await E()},1e3,{maxWait:5e3});function G(k){r.require({message:"Are you sure you want to Delete?",header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:async()=>{await F(k),await E()}})}const{fileContent:U}=ge(it()),j=at(c.id),te=Qe(c.id),z=lt(c.id),se=Ye(c.id);ne.registerSimulation(c.id,{terminal:te,display:se,pibody:j});const d=ne.getSharedEmulator(),{isLoading:i,isRunning:I}=d;j.addNeededModules([]);const v=g(ke),S=g(ke);be(z.code,async k=>{typeof k=="string"&&k!==U.value&&(U.value=k,y.value&&(p.value=k,L()))});function ae(){d.recorder.start();const k=typeof z.code.value=="string"?z.code.value:"";ne.run(c.id,k);const w=be(d.recorder.state,()=>{(d.replayer.state.value==ce.Finish||d.replayer.state.value==ce.Timeout)&&(d.recorder.stop(),v.value=d.recorder.getRecords()),w.stop()})}function le(){d.replayer.state.value==ce.Continue?(d.recorder.stop(),d.replayer.stop(),S.value=d.recorder.getRecords()):(d.recorder.stop(),v.value=d.recorder.getRecords()),d.stop()}async function Re(){await _(v.value),await E(),v.value=[]}const Se=async()=>{V.value=!0;for(const[k,w]of x.value.entries()){const K=await we(d,U.value,w.data,h.value);await d.stopPromise(),await f(k,K)}await E(),V.value=!1},Ue=async(k,w)=>{V.value=!0;const K=await we(d,U.value,k.data,h.value);await d.stopPromise(),await f(w,K),await E(),V.value=!1};return(k,w)=>{const K=ct,B=Ie,Fe=nt,Be=ot,Ve=xe;return l(),n("div",na,[a("div",ca,[w[4]||(w[4]=D(" Include Commands: ")),e(y)?(l(),O(K,{key:0,onChange:e(L),modelValue:e(h),"onUpdate:modelValue":w[0]||(w[0]=M=>Ge(h)?h.value=M:null),options:Ze,filter:"",placeholder:"Select commands",class:"w-full md:w-80 mb-2 mt-1",maxSelectedLabels:3},null,8,["onChange","modelValue","options"])):N("",!0),a("div",da,[b(B,{type:"button",class:"w-9 h-9",severity:"success",rounded:"",onClick:ae,disabled:e(i)||e(I)},{default:q(()=>[a("span",ra,s(e(i)?"hourglass_top":"play_arrow"),1)]),_:1},8,["disabled"]),b(B,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:le,disabled:e(i)||!e(I)},{default:q(()=>[a("span",ia,s(e(i)?"hourglass_top":"stop"),1)]),_:1},8,["disabled"]),b(B,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:w[1]||(w[1]=M=>Re()),disabled:v.value.length<=0||e(o)==null},{default:q(()=>[a("span",ua,s(e(i)?"hourglass_top":"save"),1)]),_:1},8,["disabled"]),b(B,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:w[2]||(w[2]=M=>e(et)(e(d),e(U),e(x),e(h))),disabled:e(i)||e(V)},{default:q(()=>[a("span",ma,s(e(i)?"hourglass_top":"bug_report"),1)]),_:1},8,["disabled"]),b(B,{type:"button",class:"w-9 h-9",rounded:"",onClick:w[3]||(w[3]=M=>Se()),disabled:e(i)||!e(x)||e(V)},{default:q(()=>[a("span",va,s(e(i)?"hourglass_top":"restart_alt"),1)]),_:1},8,["disabled"])])]),v.value.length>0?(l(),O(_e,{key:0,data:v.value,class:"mt-2"},null,8,["data"])):N("",!0),a("div",xa,[(l(!0),n(A,null,ee(e(x),(M,Q)=>{var fe;return l(),O(Ve,{toggleable:"",key:M.test.url,class:Z(["border-4",e(st)((fe=M.result)==null?void 0:fe.success)])},{header:q(()=>[a("div",fa,[b(Be,{variant:"on",class:"w-full"},{default:q(()=>[a("label",{for:`name ${Q+1}`},"Test "+s(Q+1),9,ga),b(Fe,{id:`name ${Q+1}`,onInput:e(L),modelValue:M.test.name,"onUpdate:modelValue":Y=>M.test.name=Y,class:"w-full",size:"small"},null,8,["id","onInput","modelValue","onUpdate:modelValue"])]),_:2},1024),b(B,{type:"button",class:"w-9 h-9",severity:"info",rounded:"",onClick:Y=>e(tt)(e(d),e(U),M,e(h)),disabled:e(i)||e(V)},{default:q(()=>[a("span",ba,s(e(i)?"hourglass_top":"bug_report"),1)]),_:2},1032,["onClick","disabled"]),b(B,{type:"button",class:"w-9 h-9",severity:"danger",rounded:"",onClick:Y=>G(Q)},{default:q(()=>w[5]||(w[5]=[a("span",{class:"material-icons"},s("delete_forever"),-1)])),_:2},1032,["onClick"]),b(B,{type:"button",class:"w-9 h-9",rounded:"",onClick:Y=>Ue(M,Q),disabled:e(i)||!e(x)||e(V)},{default:q(()=>[a("span",ya,s(e(i)?"hourglass_top":"restart_alt"),1)]),_:2},1032,["onClick","disabled"]),b(B,{type:"button",class:"w-9 h-9",severity:"warn",rounded:"",onClick:Y=>M.result=void 0,disabled:!e(x)||e(V)},{default:q(()=>w[6]||(w[6]=[a("span",{class:"material-icons"}," cleaning_services ",-1)])),_:2},1032,["onClick","disabled"])])]),default:q(()=>[b(_e,{data:M.data,class:"mt-2"},null,8,["data"]),M.result?(l(),O(e(ta),{key:0,result:M.result,id:c.id},null,8,["result","id"])):N("",!0)]),_:2},1032,["class"])}),128))])])}}}),ka={class:"flex bg-surface-0",style:{height:"calc(100vh - 52px)"}},Me="tester",Ja=J({__name:"TesterView",setup(t){const c=je(),r=Number(c.params.lesson_id),C=Number(c.params.unit_id),o=String(c.query.check_id);return(y,p)=>{const P=Le,x=Ne;return l(),n(A,null,[b(e(ze)),a("div",ka,[b(x,{class:"w-full rounded-none"},{default:q(()=>[b(P,{size:33,minSize:10,class:"max-w-[767px] h-full"},{default:q(()=>[b(ha,{id:Me,lesson_id:e(r),unit_id:e(C),check_id:e(o)},null,8,["lesson_id","unit_id","check_id"])]),_:1}),b(P,{size:67,minSize:10,class:"w-full h-full"},{default:q(()=>[b(e(We),{id:Me,class:"w-full h-full",horizontal:!1})]),_:1})]),_:1})])],64)}}});export{Ja as default};
