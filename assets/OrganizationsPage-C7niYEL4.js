import{s as q,a as R}from"./index-C1z6HgTH.js";import{a as H,b as K}from"./index-BOxY141j.js";import{s as M}from"./index-DK1FbR08.js";import{b as N,aa as G,u as S,ab as J,r as p,E as Q,o as v,p as $,D as i,j as r,h as t,w as U,L as W,f as X,e as Y,g as Z,c as D,t as y,q as T,i as x,k as F,F as ee,v as ae,aH as te}from"./index-Dhd596fX.js";import{O as I}from"./organizationApi-DiL_JGVz.js";import{s as oe}from"./index-BygXRAOh.js";import"./index-B9x1KOKv.js";import"./index-DqDCjQGO.js";import"./index-YWwT92yc.js";import"./index-BWpdM_Rl.js";import"./index-CQ8jkLXU.js";import"./index-Dg4P14Ao.js";import"./index-DrSF3n2Z.js";import"./index-DY1tIRwy.js";import"./index-DQSFBBPC.js";const le={class:"flex flex-col gap-1"},ne={class:"flex flex-col gap-2"},se={class:"flex gap-2 justify-end"},ie=N({__name:"EditOrganizationDialog",props:G({selectedOrganization:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(O){const f=S(),m=J(O,"modelValue"),u=O,l=p("");Q(()=>u.selectedOrganization,a=>{l.value="",a&&(l.value=a.name)},{immediate:!0});const d=p(!1);async function V(){d.value=!0;try{const{data:a}=await I.createOrganization(l.value);f.add({severity:"success",summary:a.message,life:2e3}),window.location.reload(),m.value=!1}catch(a){f.add({severity:"error",summary:a.response.data.error,detail:a,life:2e3})}finally{d.value=!1}}async function C(){if(u.selectedOrganization!=null){d.value=!0;try{const{data:a}=await I.updateOrganizationById(u.selectedOrganization.id,l.value);f.add({severity:"success",summary:a.message,life:2e3}),window.location.reload(),m.value=!1}catch(a){f.add({severity:"error",summary:a.response.data.error,detail:a,life:2e3})}finally{d.value=!1}}}return(a,n)=>{const h=M,w=oe,c=U,_=W;return v(),$(_,{visible:m.value,"onUpdate:visible":n[2]||(n[2]=g=>m.value=g),modal:"",draggable:!1,class:"m-4 max-w-md",header:u.selectedOrganization?"Edit organization":"Add organization"},{default:i(()=>[r("div",le,[r("div",ne,[n[3]||(n[3]=r("div",{class:"font-bold text-sm"},"Organization name",-1)),t(h,{key:"name",type:"text",modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=g=>l.value=g)},null,8,["modelValue"])]),t(w),r("div",se,[t(c,{label:"Cancel",severity:"secondary",onClick:n[1]||(n[1]=g=>m.value=!1)}),u.selectedOrganization==null?(v(),$(c,{key:0,label:"Create",onClick:V,loading:d.value,disabled:d.value},null,8,["loading","disabled"])):(v(),$(c,{key:1,label:"Save",onClick:C,loading:d.value,disabled:d.value},null,8,["loading","disabled"]))])])]),_:1},8,["visible","header"])}}}),re={class:"flex-grow min-w-0 pb-4 mb-4 bg-white rounded-md border"},de={class:"flex items-center"},ue={class:"flex-grow flex gap-2 items-center"},ce={key:0,class:"text-2xl"},pe={class:"w-44"},me={class:"flex gap-2"},Te=N({__name:"OrganizationsPage",setup(O){const f=S(),m=ae(),u=p(),l=p();(()=>{l.value={global:{value:null,matchMode:te.CONTAINS}}})();const V=()=>{u.value.exportCSV()},C=X(),{userInfo:a}=Y(C),n=p(!1),h=p(null);function w(s){n.value=!0,h.value=s}const c=p([]),_=p(!1);async function g(){try{_.value=!0;const{data:s}=await I.getOrganizations();c.value=s??[]}catch(s){f.add({severity:"error",summary:s.response.data.error,life:2e3})}finally{_.value=!1}}return Z(()=>{g()}),(s,o)=>{const k=U,E=H,A=M,P=K,b=q,L=R;return v(),D(ee,null,[r("div",re,[t(L,{ref_key:"dt",ref:u,filters:l.value,"onUpdate:filters":o[2]||(o[2]=e=>l.value=e),value:c.value,dataKey:"id",loading:_.value,scrollable:"",globalFilterFields:["id","name","created_at"],class:"rounded-md overflow-hidden w-full",paginator:"",rows:10,rowsPerPageOptions:[5,10,25]},{header:i(()=>{var e;return[r("div",de,[r("div",ue,[c.value?(v(),D("div",ce,y(s.$t("organizations"))+" - "+y(c.value.length),1)):T("",!0)]),((e=x(a))==null?void 0:e.user_type)=="super_admin"?(v(),$(k,{key:0,label:"Add",icon:"pi pi-plus",severity:"success",variant:"outlined",class:"mr-2",onClick:o[0]||(o[0]=z=>w(null))})):T("",!0),t(k,{label:s.$t("export"),icon:"pi pi-upload",severity:"info",variant:"outlined",class:"mr-2",onClick:V},null,8,["label"]),t(P,null,{default:i(()=>[t(E,null,{default:i(()=>o[4]||(o[4]=[r("i",{class:"pi pi-search"},null,-1)])),_:1}),t(A,{modelValue:l.value.global.value,"onUpdate:modelValue":o[1]||(o[1]=z=>l.value.global.value=z),placeholder:s.$t("pages.teacher.search")},null,8,["modelValue","placeholder"])]),_:1})])]}),empty:i(()=>o[5]||(o[5]=[F(" No organizations found. ")])),loading:i(()=>o[6]||(o[6]=[F(" Loading organizations data. Please wait. ")])),default:i(()=>[t(b,{field:"id",header:"ID",sortable:""},{body:i(({data:e})=>[F(y(e.id),1)]),_:1}),t(b,{field:"name",header:s.$t("name"),sortable:""},{body:i(({data:e})=>[r("div",null,y(`${e.name}`),1)]),_:1},8,["header"]),t(b,{header:s.$t("schools"),sortable:""},{body:i(({data:e})=>[r("div",null,y(e.school_count),1)]),_:1},8,["header"]),t(b,{field:"created_at",header:s.$t("createdTime"),sortable:""},{body:i(({data:e})=>[r("div",pe,y(e.created_at.split("T")[0]+" "+e.created_at.split(".")[0].split("T")[1]),1)]),_:1},8,["header"]),t(b,{frozen:!0,alignFrozen:"right",exportable:!1},{body:i(({data:e})=>{var z;return[r("div",me,[((z=x(a))==null?void 0:z.user_type)=="super_admin"?(v(),$(k,{key:0,icon:"pi pi-pencil",outlined:"",rounded:"",severity:"warn",onClick:j=>w(e)},null,8,["onClick"])):T("",!0),t(k,{icon:"pi pi-angle-right",outlined:"",rounded:"",severity:"info",onClick:j=>{var B;return x(m).push({name:((B=x(a))==null?void 0:B.user_type)=="super_admin"?"admin-organization":"supervisor-organization",params:{id:e.id}})}},null,8,["onClick"])])]}),_:1})]),_:1},8,["filters","value","loading"])]),t(ie,{modelValue:n.value,"onUpdate:modelValue":o[3]||(o[3]=e=>n.value=e),"selected-organization":h.value},null,8,["modelValue","selected-organization"])],64)}}});export{Te as default};
